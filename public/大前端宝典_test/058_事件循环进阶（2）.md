# 事件循环进阶（2）

```javascript
const first = () => (new Promise((resolve, reject) => {  
console.log(3);  
let p = new Promise((resolve, reject) => {  
console.log(7);  
setTimeout(() => {  
console.log(5);  
resolve(6);  
console.log(p);  
}, 0);  
resolve(1);  
});  
resolve(2);  
p.then(arg => {  
console.log(arg);  
});  
}));  
  
first().then((arg) => {  
console.log(arg);  
})  
  
console.log(4);

```

```javascript
// 第一步  
  
输出：3, 7, 4  
  
微任务 = \[  
p.then((arg) => {  
console.log(arg);  
})  
  
first().then((arg) => {  
console.log(arg);  
})  
\]  
  
宏任务 = \[  
() => {  
console.log(5);  
resolve(6);  
console.log(p);  
}  
\]

```

```javascript
// 第二步  
  
执行：  
p.then((arg = 1) => {  
console.log(arg);  
})  
  
输出：3, 7, 4, 1  
  
微任务 = \[  
first().then((arg) => {  
console.log(arg);  
})  
\]  
  
宏任务 = \[  
() => {  
console.log(5);  
resolve(6);  
console.log(p);  
}  
\]

```

```javascript
// 第三步  
  
执行：  
first().then((arg = 2) => {  
console.log(arg);  
})  
  
输出：3, 7, 4, 1, 2  
  
微任务 = \[\]  
  
宏任务 = \[  
() => {  
console.log(5);  
resolve(6);  
console.log(p);  
}  
\]

```

```javascript
// 第三步  
  
执行：  
() => {  
console.log(5);  
resolve(6);  
console.log(p);  
}  
  
输出：3, 7, 4, 1, 2, 5, Promise{1}  
  
微任务 = \[\]  
  
宏任务 = \[\]

```
