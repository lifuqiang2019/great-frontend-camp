# 事件循环进阶（1）

```javascript
Promise.resolve().then(() => {  
console.log(0);  
return Promise.resolve(4);  
}).then((res) => {  
console.log(res)  
})Promise.resolve().then(() => {  
console.log(1);  
}).then(() => {  
console.log(2);  
}).then(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
});

根据上一个问题的思路，可逐步分析为拆分为以下步骤：

```

```javascript
// 第1步  
输出：  
  
微任务 = \[  
  
(() => {  
console.log(0);  
return Promise.resolve(4);  
}).then((res) => {  
console.log(res)  
}),  
  
(() => {  
console.log(1);  
}).then(() => {  
console.log(2);  
}).then(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
})  
  
\]  
  
宏任务 = \[\]

```

```javascript
// 第2步  
输出：0  
  
// 处理第一个微任务  
(() => {  
return Promise.resolve().then(() => {  
return 4;  
});  
}).then((res) => {  
console.log(res)  
}),  
  
微任务 = \[  
(() => {  
console.log(1);  
}).then(() => {  
console.log(2);  
}).then(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
})  
  
\]  
  
宏任务 = \[\]

```

```javascript
// 第3步  
输出：0  
  
// 处理第一个微任务  
Promise.resolve().then(() => {  
return 4;  
}).then((x) => {  
return x;  
}).then((res) => {  
console.log(res)  
}),  
  
微任务 = \[  
(() => {  
console.log(1);  
}).then(() => {  
console.log(2);  
}).then(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
})  
  
\]  
  
宏任务 = \[\]

```

```javascript
// 第4步  
输出：0  
  
微任务 = \[  
(() => {  
console.log(1);  
}).then(() => {  
console.log(2);  
}).then(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
}),  
  
(() => {  
return 4;  
}).then((x) => {  
return x;  
}).then((res) => {  
console.log(res)  
})  
  
\]  
  
宏任务 = \[\]

```

```javascript
// 第5步  
输出：0,1  
  
微任务 = \[  
(() => {  
return 4;  
}).then((x) => {  
return x;  
}).then((res) => {  
console.log(res)  
})  
  
(() => {  
console.log(2);  
}).then(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
})  
\]  
  
宏任务 = \[\]

```

```javascript
// 第6步  
输出：0,1  
  
微任务 = \[  
  
(() => {  
console.log(2);  
}).then(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
}),  
  
(() => {  
return 4;  
}).then((res) => {  
console.log(res)  
})  
  
\]  
  
宏任务 = \[\]

```

```javascript
// 第5步  
输出：0,1,2  
  
微任务 = \[  
  
(() => {  
return 4;  
}).then((res) => {  
console.log(res)  
})  
  
(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
})  
  
\]  
  
宏任务 = \[\]

```

```javascript
// 第6步  
输出：0,1,2  
  
微任务 = \[  
  
(() => {  
console.log(3);  
}).then(() => {  
console.log(5);  
})  
  
(() => {  
console.log(4)  
})  
  
\]  
  
宏任务 = \[\]

```

```javascript
// 第7步  
输出：0,1,2,3  
  
微任务 = \[  
(() => {  
console.log(4)  
})  
(() => {  
console.log(5);  
})  
\]  
  
宏任务 = \[\]

```

```javascript
// 第8步  
输出：0,1,2,3,4,5  
  
微任务 = \[\]  
  
宏任务 = \[\]

```
