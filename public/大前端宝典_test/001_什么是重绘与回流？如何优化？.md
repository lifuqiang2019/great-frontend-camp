# 什么是重绘与回流？如何优化？

## 1. 核心概念

### 重绘 (Repaint)
当元素的**外观样式**（如 `color`、`background-color`、`visibility`）发生改变，但**不影响布局**（即元素的位置、大小未变）时，浏览器会重新绘制该元素。
*   **特点**：开销相对较小。

### 回流 (Reflow)
当元素的**布局属性**（如 `width`、`height`、`position`、`display`）发生改变，导致浏览器需要**重新计算**页面中元素的位置和几何形状时，就会触发回流。
*   **特点**：开销较大，**回流一定会触发重绘**。

---

## 2. 常见触发场景

*   **触发回流**：
    *   改变窗口大小（Resize）。
    *   改变字体大小。
    *   添加或删除可见的 DOM 元素。
    *   盒模型属性改变：`width`, `height`, `padding`, `margin`, `border`。
    *   位置属性改变：`top`, `left`, `position`。
    *   获取某些布局信息：`offsetWidth`, `offsetHeight`, `scrollTop` 等（会强制刷新渲染队列）。

*   **触发重绘**：
    *   `color`, `background`, `box-shadow`, `border-radius` 等外观属性。

---

## 3. 性能优化策略（减少回流）

### CSS 层面
1.  **使用 `transform` 代替 `top/left`**：`transform` 可以在合成层（Compositor Layer）进行，不会触发回流，甚至不触发主线程重绘（GPU 加速）。
2.  **使用 `visibility: hidden` 替换 `display: none`**：前者只重绘，后者会触发回流。
3.  **避免使用 `table` 布局**：`table` 中任何一个单元格的改动都可能导致整个表格的回流。
4.  **动画优化**：将动画应用到 `position: absolute` 或 `fixed` 的元素上，使其脱离文档流，避免影响其他元素的布局。

### JavaScript 层面
1.  **批量修改 DOM**：
    *   使用 `class` 切换样式，而不是频繁操作 `style` 属性。
    *   使用 `documentFragment` 创建文档片段，一次性追加到 DOM 中。
2.  **避免频繁读取布局信息**：如果需要多次使用 `offsetLeft` 等属性，应将其缓存到变量中，避免在循环中重复读取导致强制回流。
3.  **使用 `requestAnimationFrame`**：在下一次重绘之前更新动画帧，保证动画流畅度。
