# 事件循环进阶（3）

```javascript
let a;  
let b = new Promise((resolve) => {  
console.log(1);  
setTimeout(() => {  
resolve();  
}, 1000);  
}).then(() => {  
console.log(2);  
})  
  
a = new Promise(async (resolve) => {  
console.log(a);  
await b;  
console.log(a);  
console.log(3);  
await a;  
resolve(true);  
console.log(4);  
});  
  
console.log(5);

```

```javascript
// 关于这种涉及 await 的题目，可以简单先做一下形式转化，统一转换为 promise，这样便于理解  
let a;  
let b = new Promise((resolve) => {  
console.log(1);  
setTimeout(() => {  
resolve();  
}, 1000);  
}).then(() => {  
console.log(2);  
})  
  
a = new Promise((resolve) => {  
console.log(a);  
b.then(() => {  
console.log(a);  
console.log(3);  
a.then(() => {  
resolve(true);  
console.log(4);  
})  
});  
});  
  
console.log(5);

```

```javascript
// 第一步  
  
输出：1, a(undefined), 5  
  
微任务 = \[  
b.then(() => {  
console.log(2);  
}).then(() => {  
console.log(a);  
console.log(3);  
a.then(() => {  
resolve(true);  
console.log(4);  
})  
});  
\]  
  
宏任务 = \[  
() => {  
Promise{b}.resolve();  
}, 1000);  
\]

```

```javascript
// 第二步  
  
因为b.then在setTimeout中resolve，所以这里优先执行：  
() => {  
Promise{b}.resolve();  
}, 1000);  
  
输出：1, a(undefined), 5, "等待一秒"  
  
微任务 = \[  
() => {  
console.log(2);  
}).then(() => {  
console.log(a);  
console.log(3);  
a.then(() => {  
resolve(true);  
console.log(4);  
})  
};  
\]  
  
宏任务 = \[\]

```

```javascript
// 第三步  
  
执行：  
() => {  
console.log(2);  
}).then(() => {  
console.log(a);  
console.log(3);  
a.then(() => {  
resolve(true);  
console.log(4);  
})  
});  
  
输出：1, a(undefined), 5, "等待一秒", 2  
  
微任务 = \[  
() => {  
console.log(a);  
console.log(3);  
a.then(() => {  
resolve(true);  
console.log(4);  
})  
});  
\]  
  
宏任务 = \[\]

```

```javascript
// 第四步  
  
执行：  
() => {  
console.log(a);  
console.log(3);  
a.then(() => {  
resolve(true);  
console.log(4);  
})  
});  
  
输出：1, a(undefined), 5, "等待一秒", 2, Promise{<pendding>}, 3  
  
微任务 = \[  
a.then(() => {  
resolve(true);  
console.log(4);  
})  
\]  
  
宏任务 = \[\]  
  
结束：因为 a.then 需要被 resolve 才能被执行，而 resolve 又在 a.then 内，因此 a.then 无法执行。

```
