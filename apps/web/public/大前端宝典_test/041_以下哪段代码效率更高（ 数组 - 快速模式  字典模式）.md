# 以下哪段代码效率更高（ 数组 - 快速模式 / 字典模式）

```javascript
const arr1 = \[\];  
for (let i = 0; i < 10000000; ++i) {  
arr1\[i\] = 1;  
}

```

```javascript
const arr2 = \[\];  
arr2\[10000000 - 1\] = 1;  
for (let i = 0; i < 10000000; ++i) {  
arr2\[i\] = 1;  
}

```
- **左边的效率更高，利用了数组的 快速模式**

```javascript
// 测试代码  
console.time('a');  
const arr1 = \[\];  
for (let i = 0; i < 10000000; ++i) {  
arr1\[i\] = 1;  
}  
console.timeEnd('a');  
  
console.time('b');  
const arr2 = \[\];  
arr2\[10000000 - 1\] = 1;  
for (let i = 0; i < 10000000; ++i) {  
arr2\[i\] = 1;  
}  
console.timeEnd('b');

```
- JS 运行机制： 浏览器 -> 内核 -> JS 解析引擎

**浏览器**

**内核**

**JS 解析引擎**

chrome

早期 WebKit，现目前 Blink

V8

Mozilla Firefox

Gecko

SpiderMonkey

Edge

Chromium

Chakra / V8

Safari

Webkit

JavascriptCore

- 比较主流的 JS 引擎是 v8，这里假设是跑在 chrome 或 node 上，用的是 v8 引擎。
- V8 是一个 c++ 实现的 js 解析引擎，内部有多种方式存放 JS 数组。
- " 数组从 0 到 length-1 无空洞 " ，会进入快速模式，存放为 array。
- "数组中间有 空洞 "，会进入字典模式，存放为 HashMap。（ 这是 V8 的一个优化策略，保证用最合适的数据结构处理当下场景，如果遇到数据量过大或者是松散结构的话，就改变为 HashMap，牺牲遍历性能，换取访问性能。 ）
- **指导代码编写习惯：**
- 从0开始初始化数组，避免数组进入字典模式。
- 让数组保持紧凑，避免数组进入字典模式。

**相关文章：** https://itnext.io/v8-deep-dives-understanding-array-internals-5b17d7a28ecc

[数组模式.mov](https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/preview/OT7jbCbSrolZSDxXRT4cq2VBnRc?mount_point=docx_file&preview_type=16)
