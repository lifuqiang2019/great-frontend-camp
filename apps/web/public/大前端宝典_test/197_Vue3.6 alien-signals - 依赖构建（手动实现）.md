# Vue3.6 alien-signals - 依赖构建（手动实现）

```javascript
_function link(dep, sub) {  
const newLink = {  
dep,  
sub,  
prevDep: undefined,  
nextDep: undefined,  
prevSub: undefined,  
nextSub: undefined,  
}  
  
dep.subs = newLink;  
dep.subsTail = newLink;  
  
sub.deps = newLink;  
sub.depsTail = newLink;  
  
console.log(\`${dep.constructor.name} -> Link:{ dep: ${newLink.dep.constructor.name}, sub: ${newLink.sub.constructor.name} } -> ${sub.constructor.name}\`);  
  
return newLink;  
}  
  
let activeSub = null;  
  
function startTracking(sub) {  
try {  
return activeSub;  
} finally {  
activeSub = sub;  
}  
}  
  
function endTracking(prevSub) {  
activeSub = prevSub;  
}  
  
class RefImpl {  
constructor(val) {  
this.\_value = val;  
}  
get value() {  
console.log('-------- ref visit start');  
try {  
link(this, activeSub);  
return this.\_value;  
} finally {  
console.log('-------- ref visit end');  
}  
}  
}  
  
class ComputedImpl {  
constructor(fn) {  
this.\_fn = fn;  
}  
get value() {  
const prevSub = startTracking(this);  
const res = this.\_fn();  
endTracking(prevSub);  
link(this, activeSub);  
return res;  
}  
}  
  
class EffectImpl {  
constructor(fn) {  
this.\_fn = fn;  
}  
run() {  
const prevSub = startTracking(this);  
this.\_fn();  
endTracking(prevSub);  
}  
}  
  
const Vue = {  
ref(val) {  
return new RefImpl(val);  
},  
  
computed(fn) {  
return new ComputedImpl(fn);  
},  
  
effect(fn) {  
const effectImpl = new EffectImpl(fn);  
effectImpl.run();  
}  
}  
  
const { ref, computed, effect } = Vue;  
  
const num = ref(100);  
const double = computed(() => {  
console.log('---- computed change start');  
const result = num.value \* 2 // computed -> link -> num  
console.log('---- computed change end');  
return result;  
});  
effect(() => {  
console.log('---- effect change start');  
double.value; // effect -> link -> double  
console.log('---- effect change end');  
});_

```
