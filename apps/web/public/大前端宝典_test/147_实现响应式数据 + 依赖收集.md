# 实现响应式数据 + 依赖收集

```javascript
class Component {  
data = { name: '' };  
constructor() {}  
render() {  
console.log(\`render - name:${this.\_data.name}\`);  
}  
}  
  
// 要求以下代码需要触发render，且同步变更需要合并。  
const com = new Component();  
com.data.name = 'a';  
com.data.name = 'b';  
com.data.name = '哲玄';  
// 第一次触发 render  
  
setTimeout(() => {  
com.data.name = '哲玄前端';  
});  
// 第二次触发 render

**答案：** 通过 Proxy 触发响应式，加上 promise 实现依赖收集。

[数据收集渲染.mov](https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/preview/QTyFbQ3lZos3q9xXfqMcS8Cpn5d?mount_point=docx_file&preview_type=16)

```

```javascript
class Component {  
\_data = { name: '' };  
pending = false;  
constructor() {  
this.data = new Proxy(this.\_data, {  
set: (target, key, value) => {  
this.\_data\[key\] = value;  
if (!this.pending) {  
this.pending = true;  
Promise.resolve().then(() => {  
this.pending = false;  
this.render();  
});  
}  
}  
});  
}  
render() {  
console.log(\`render - name:${this.data.name}\`);  
}  
}  
  
// 要求以下代码需要触发render，且同步变更需要合并。  
const com = new Component();  
com.data.name = 'a';  
com.data.name = 'b';  
com.data.name = '哲玄';  
// 第一次触发 render  
  
setTimeout(() => {  
com.data.name = '哲玄前端';  
}, 0);  
// 第二次触发 render

```
