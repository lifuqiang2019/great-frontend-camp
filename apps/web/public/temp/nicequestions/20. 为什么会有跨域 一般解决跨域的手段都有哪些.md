# 为什么会有跨域? 一般解决跨域的手段都有哪些?

## 简短回答

跨域是浏览器的**“安保机制”**（同源策略），不是服务器的问题。
解决它的核心思路就两种：
1.  **正规军**：后端给浏览器发“通行证” (CORS Headers)，告诉浏览器“我允许这个域名访问”。
2.  **找中介**：前端不直接找后端，而是找个同源的**代理服务器** (Proxy)，让代理服务器去转发请求。因为服务器之间通信是不受同源策略限制的。

---

## 1. 开发环境：Proxy 代理 (中介模式)

在本地开发时，我们通常用 Vite/Webpack 的 Dev Server 做代理。

```javascript
// vite.config.ts
export default {
  server: {
    proxy: {
      // 匹配 /api 开头的请求
      '/api': {
        target: 'http://backend-api.com', // 真实后端地址
        changeOrigin: true, // 修改 Host 头，欺骗后端
        // 路径重写：把 /api/user 变成 /user
        rewrite: (path) => path.replace(/^/api/, '')
      }
    }
  }
}
```

## 2. 生产环境：Nginx 反向代理

上线后，通常没有 Dev Server 了，我们用 Nginx 做反向代理，原理一样。

```nginx
server {
  listen 80;
  server_name my-site.com;

  # 前端静态资源
  location / {
    root /app/dist;
  }

  # 接口转发
  location /api/ {
    proxy_pass http://backend-server:3000/;
  }
}
```

## 3. 后端开启 CORS (Node.js Express)

如果你的 API 是开放给第三方使用的，或者前后端部署在不同域名下，就必须在后端配置 CORS。

```javascript
const cors = require('cors');
const app = express();

app.use(cors({
  origin: 'https://my-site.com', // 白名单：只允许这个域名访问
  methods: ['GET', 'POST'],
  credentials: true // 允许携带 Cookie
}));
```
