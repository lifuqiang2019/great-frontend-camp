# 简述HTTPS密钥交换原理.

## 简短回答

HTTPS 其实就是两个陌生人（客户端和服务器）在不安全的网络里，通过一道复杂的数学题（**非对称加密**）交换了一个暗号（**对称密钥**），确认了对方身份（**数字证书**），然后用这个暗号进行高效的加密通话。

---

## 1. 核心流程 (TLS 1.2 握手)

1.  **打招呼 (Client Hello)**：客户端发个随机数 A，说“支持这些加密算法”。
2.  **亮身份证 (Server Hello)**：服务器发个随机数 B，并把 **证书 (包含公钥)** 甩给客户端。
3.  **验真伪**：客户端找 CA 机构验证证书是不是真的（防中间人攻击）。
4.  **传暗号 (Key Exchange)**：
    *   客户端生成随机数 C (Pre-master)。
    *   用服务器的 **公钥** 把 C 加密，发回去。
    *   服务器用自己的 **私钥** 解开，拿到 C。
    *   *注意：只有服务器能解开 C，黑客截获了也没用。*
5.  **生成会话密钥**：现在双方都有了 A, B, C，用同样的算法生成最终的 **Session Key**。
6.  **加密通话**：之后的数据传输都用 Session Key 进行 **对称加密** (AES)，因为对称加密快。

## 2. 证书包含什么？

证书就是服务器的身份证，里面有：
*   **公钥 (Public Key)**：用来加密随机数 C 的。
*   **持有者信息**：域名 (google.com)、公司名。
*   **颁发者签名**：CA 机构用自己的私钥签的名，浏览器内置了 CA 的公钥来解密验证。

## 3. TLS 1.3 的进化

TLS 1.3 废弃了 RSA 握手，强制使用 **ECDHE** (椭圆曲线) 算法。
*   **更快**：握手只需 1 个来回 (1-RTT)，甚至 0-RTT (重连时)。
*   **更安全**：具备**前向安全性**。即使将来私钥被偷了，黑客也解不开以前截获的历史消息（因为每次会话的密钥都是临时生成的，和私钥无关）。
