// File: apps\web\src\app\camp\page.tsx
import MainPage from '@/components/MainPage';
import { getGreetingConfig } from '@/lib/server-utils';
export default async function CampPage() {
const greetingConfig = await getGreetingConfig();
return <MainPage initialTab="åŒå­¦è¥æ´»åŠ¨" serverGreetingConfig={greetingConfig} />;
}
// File: apps\web\src\app\favorites\page.tsx
"use client";
import React, { useState, useRef, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import CodingCommunity from '@/components/CodingCommunity';
import LoginModal from '@/components/LoginModal';
import { UserAvatar } from '@/components/UserAvatar';
import { useSession, signOut } from '@/lib/auth-client';
export default function FavoritesPage() {
const router = useRouter();
const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
const [isUserMenuOpen, setIsUserMenuOpen] = useState(false);
const [isLoggingOut, setIsLoggingOut] = useState(false);
const { data: session } = useSession();
const userMenuRef = useRef<HTMLDivElement>(null);
useEffect(() => {
function handleClickOutside(event: MouseEvent) {
if (userMenuRef.current && !userMenuRef.current.contains(event.target as Node)) {
setIsUserMenuOpen(false);
}
}
document.addEventListener("mousedown", handleClickOutside);
return () => {
document.removeEventListener("mousedown", handleClickOutside);
};
}, []);
const handleAvatarClick = () => {
if (session) {
setIsUserMenuOpen(!isUserMenuOpen);
} else {
setIsLoginModalOpen(true);
}
};
const handleLogout = async () => {
setIsLoggingOut(true);
try {
await signOut();
setIsUserMenuOpen(false);
router.push('/');
} catch (error) {
console.error(error);
setIsLoggingOut(false);
}
};
const navItems = [
{ name: 'å‰ç«¯é¢è¯•é¢˜åº“', path: '/' },
{ name: 'åŒå­¦è¥æ´»åŠ¨', hot: true, path: '/' }
];
return (
<div className="h-screen flex flex-col overflow-hidden">
{}
<nav className="bg-primary-900 shadow-subtle py-[0.8rem] flex-shrink-0 border-b border-primary-800">
<div className="max-w-full m-0 px-10 flex items-center justify-between">
<div className="flex items-center min-w-[100px] mr-10">
<div
className="flex items-center gap-3 cursor-pointer group"
onClick={() => router.push('/')}
>
<div className="w-9 h-9 rounded-xl bg-gradient-to-br from-accent-gold via-[#eac14d] to-[#b8860b] flex items-center justify-center shadow-lg shadow-black/20 border border-white/10 transition-transform duration-300 group-hover:scale-105 group-hover:rotate-3">
<svg xmlns="http:
<path d="M16 18l6-6-6-6" />
<path d="M8 6l-6 6 6 6" />
</svg>
</div>
<div className="flex flex-col justify-center -space-y-1">
<span className="text-[13px] font-bold text-accent-gold tracking-wide ml-[1px] group-hover:text-white transition-colors duration-300">
å¤§å‰ç«¯
</span>
<span className="text-[20px] font-black text-neutral-white tracking-wider group-hover:text-accent-gold transition-colors duration-300">
åŒå­¦è¥
</span>
</div>
</div>
</div>
<ul className="flex justify-start list-none gap-[15px] m-0 p-0 flex-1">
{navItems.map((item) => (
<li key={item.name} className="relative">
<button
onClick={() => router.push(item.path)}
className={`no-underline text-primary-100/80 text-[15px] font-medium transition-all duration-300 px-5 py-[8px] rounded-md hover:text-neutral-white hover:bg-primary-800`}
>
{item.name}
</button>
{item.hot && (
<span className="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full animate-pulse">
HOT
</span>
)}
</li>
))}
</ul>
<div className="flex items-center min-w-[100px] justify-end relative" ref={userMenuRef}>
<UserAvatar
user={session?.user}
size="md"
onClick={handleAvatarClick}
className="cursor-pointer hover:ring-2 ring-primary-200 transition-all"
/>
{}
{isUserMenuOpen && session && (
<div className="absolute top-full -right-4 mt-2 w-40 bg-white rounded-xl shadow-lg border border-primary-100 overflow-hidden z-50">
<div className="p-4 border-b border-gray-100 bg-primary-50/50">
<div className="font-bold text-primary-900 truncate">
{session.user.name || 'User'}
</div>
<div className="text-xs text-primary-500 truncate mt-0.5">
{session.user.email}
</div>
</div>
<div className="py-2">
<button
onClick={() => router.push('/')}
className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3"
>
<svg xmlns="http:
<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
<circle cx="12" cy="7" r="4"></circle>
</svg>
ä¸ªäººä¿¡æ¯
</button>
<button
onClick={() => router.push('/')}
className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3"
>
<svg xmlns="http:
<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
<line x1="16" y1="2" x2="16" y2="6"></line>
<line x1="8" y1="2" x2="8" y2="6"></line>
<line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
æ¨¡æ‹Ÿé¢„çº¦
</button>
<button
onClick={() => router.push('/')}
className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3"
>
<svg xmlns="http:
<path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
<path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
</svg>
æˆ‘çš„è¯¾ç¨‹
</button>
<button
className="w-full text-left px-4 py-2 text-sm text-primary-900 bg-primary-50 font-medium flex items-center gap-3"
>
<svg xmlns="http:
<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
</svg>
é¢˜ç›®æ”¶è—
</button>
</div>
<div className="border-t border-gray-100 py-2">
<button
onClick={handleLogout}
disabled={isLoggingOut}
className="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed"
>
{isLoggingOut ? (
<svg className="animate-spin h-4 w-4 text-red-500" xmlns="http:
<circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
<path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
) : (
<svg xmlns="http:
<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
<polyline points="16 17 21 12 16 7"></polyline>
<line x1="21" y1="12" x2="9" y2="12"></line>
</svg>
)}
{isLoggingOut ? 'æ­£åœ¨é€€å‡º...' : 'é€€å‡ºç™»å½•'}
</button>
</div>
</div>
)}
</div>
</div>
</nav>
{}
<main className="flex-1 w-full m-0 p-0 overflow-hidden flex flex-col">
<CodingCommunity
onLoginRequest={() => setIsLoginModalOpen(true)}
viewMode="favorites-only"
/>
</main>
<LoginModal isOpen={isLoginModalOpen} onClose={() => setIsLoginModalOpen(false)} />
</div>
);
}
// File: apps\web\src\app\layout.tsx
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import BaiduAnalytics from "@/components/BaiduAnalytics";
import "./globals.css";
const geistSans = Geist({
variable: "--font-geist-sans",
subsets: ["latin"],
});
const geistMono = Geist_Mono({
variable: "--font-geist-mono",
subsets: ["latin"],
});
export const metadata: Metadata = {
title: "å¤§å‰ç«¯ - æ²™åŒ…é‚£ä¹ˆå¤§ï¼Œä¹Ÿå¯ä»¥è£…ä¸‹ä¸€ä¸ªäºº",
description: "å¤§å‰ç«¯ - æ²™åŒ…é‚£ä¹ˆå¤§ï¼Œä¹Ÿå¯ä»¥è£…ä¸‹ä¸€ä¸ªäºº",
};
export default function RootLayout({
children,
}: Readonly<{
children: React.ReactNode;
}>) {
return (
<html lang="en">
<body
className={`${geistSans.variable} ${geistMono.variable} antialiased`}
>
<BaiduAnalytics />
{children}
</body>
</html>
);
}
// File: apps\web\src\app\page.tsx
import MainPage from '@/components/MainPage';
import { getGreetingConfig } from '@/lib/server-utils';
export default async function HomePage() {
const greetingConfig = await getGreetingConfig();
return <MainPage serverGreetingConfig={greetingConfig} />;
}
// File: apps\web\src\app\questions\page.tsx
import MainPage from '@/components/MainPage';
import { getGreetingConfig } from '@/lib/server-utils';
export default async function QuestionsPage() {
const greetingConfig = await getGreetingConfig();
return <MainPage initialTab="é¢è¯•é¢˜åº“" serverGreetingConfig={greetingConfig} />;
}
// File: apps\web\src\app\questions\[id]\page.tsx
import MainPage from '@/components/MainPage';
import { getGreetingConfig } from '@/lib/server-utils';
export default async function QuestionPage({ params }: { params: Promise<{ id: string }> }) {
const { id } = await params;
const greetingConfig = await getGreetingConfig();
return <MainPage initialTab="é¢è¯•é¢˜åº“" initialQuestionId={id} serverGreetingConfig={greetingConfig} />;
}
// File: apps\web\src\components\BaiduAnalytics.tsx
'use client';
import Script from 'next/script';
export default function BaiduAnalytics() {
const baiduTongjiId = process.env.NEXT_PUBLIC_BAIDU_TONGJI_ID;
if (!baiduTongjiId) {
return null;
}
return (
<Script
id="baidu-tongji"
strategy="afterInteractive"
dangerouslySetInnerHTML={{
__html: `
var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https:
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();
`,
}}
/>
);
}
// File: apps\web\src\components\CodingCommunity.tsx
"use client";
import React, { useState, useMemo, useEffect, useRef, useCallback } from 'react';
import { Marked } from 'marked';
import { markedHighlight } from 'marked-highlight';
import hljs from 'highlight.js';
import 'highlight.js/styles/github.css';
import mermaid from 'mermaid';
import { api } from '../lib/request';
import { useSession } from '../lib/auth-client';
import NotePadModal from './NotePadModal';
import { UserAvatar } from './UserAvatar';
const MermaidContent = React.memo(({ html, className }: { html: string; className?: string }) => {
const containerRef = useRef<HTMLDivElement>(null);
useEffect(() => {
if (!html || !containerRef.current) return;
const timer = setTimeout(async () => {
const attachListener = (selector: string, handler: (e: Event) => void) => {
containerRef.current?.querySelectorAll(selector).forEach(btn => {
const newBtn = btn.cloneNode(true);
if (btn.parentNode) {
btn.parentNode.replaceChild(newBtn, btn);
newBtn.addEventListener('click', handler);
}
});
};
const handleCopy = async (e: Event) => {
const btn = e.currentTarget as HTMLElement;
const container = btn.closest('.code-block-wrapper');
if (!container) return;
const codeEl = container.querySelector('code');
if (!codeEl) return;
const text = codeEl.textContent || '';
try {
await navigator.clipboard.writeText(text);
const originalIcon = btn.innerHTML;
btn.innerHTML = `
<svg class="w-3.5 h-3.5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>
`;
setTimeout(() => {
btn.innerHTML = originalIcon;
}, 2000);
} catch (err) {
console.error('Failed to copy:', err);
}
};
attachListener('.copy-code-btn', handleCopy);
const mermaidNodes = containerRef.current?.querySelectorAll('.mermaid');
if (mermaidNodes && mermaidNodes.length > 0) {
try {
await mermaid.run({
nodes: mermaidNodes as unknown as ArrayLike<HTMLElement>,
});
const containers = containerRef.current?.querySelectorAll('.mermaid-container');
containers?.forEach(container => {
const loading = container.querySelector('.mermaid-loading');
const toolbar = container.querySelector('.mermaid-toolbar');
const content = container.querySelector('.mermaid');
if (loading) {
loading.classList.add('opacity-0', 'pointer-events-none');
}
if (toolbar) {
toolbar.classList.remove('opacity-0');
}
if (content) {
content.classList.remove('opacity-0');
}
});
} catch (error) {
console.error('Mermaid rendering failed:', error);
const containers = containerRef.current?.querySelectorAll('.mermaid-container');
containers?.forEach(container => {
const loading = container.querySelector('.mermaid-loading');
const content = container.querySelector('.mermaid');
if (loading) loading.classList.add('hidden');
if (content) content.classList.remove('opacity-0');
});
}
const handleZoom = (e: Event, delta: number) => {
const btn = e.currentTarget as HTMLElement;
const targetId = btn.getAttribute('data-target');
if (!targetId) return;
const el = document.getElementById(targetId);
const levelEl = document.querySelector(`.zoom-level[data-target="${targetId}"]`);
if (el) {
let scale = parseFloat(el.getAttribute('data-scale') || '1');
scale = Math.max(0.5, Math.min(3, scale + delta));
el.style.transform = `scale(${scale})`;
el.setAttribute('data-scale', scale.toString());
if (levelEl) levelEl.textContent = `${Math.round(scale * 100)}%`;
}
};
const handleReset = (e: Event) => {
const btn = e.currentTarget as HTMLElement;
const targetId = btn.getAttribute('data-target');
if (!targetId) return;
const el = document.getElementById(targetId);
const levelEl = document.querySelector(`.zoom-level[data-target="${targetId}"]`);
if (el) {
el.style.transform = `scale(1)`;
el.setAttribute('data-scale', '1');
if (levelEl) levelEl.textContent = `100%`;
}
};
attachListener('.zoom-in-btn', (e) => handleZoom(e, 0.1));
attachListener('.zoom-out-btn', (e) => handleZoom(e, -0.1));
attachListener('.zoom-reset-btn', handleReset);
}
}, 100);
return () => clearTimeout(timer);
}, [html]);
return <div ref={containerRef} className={className} dangerouslySetInnerHTML={{ __html: html }} />;
});
MermaidContent.displayName = 'MermaidContent';
export interface Category {
id: string;
name: string;
}
export interface QuestionItem {
id: string;
title: string;
content?: string;
solution?: string;
transcript?: string;
interviewerQuestion?: string;
categoryId: string;
category?: Category;
hotScore?: number;
videoUrl?: string;
}
interface CodingCommunityProps {
onLoginRequest?: () => void;
viewMode?: 'default' | 'favorites' | 'favorites-only';
onCloseFavorites?: () => void;
initialQuestionId?: string;
onQuestionSelect?: (id: string | null) => void;
searchQuery?: string;
onSearchChange?: (query: string) => void;
searchPlaceholder?: string;
questions?: QuestionItem[];
categories?: Category[];
}
const QuestionListItem = ({
item,
index,
isSelected,
onSelect,
isHot = false
}: {
item: QuestionItem;
index: number;
isSelected: boolean;
onSelect: (item: QuestionItem) => void;
isHot?: boolean;
}) => {
return (
<div className="relative">
<div
onClick={() => onSelect(item)}
className={`group w-full py-1.5 pl-2 pr-1 rounded-md cursor-pointer text-sm transition-colors duration-200 ease-in-out overflow-hidden flex items-start gap-2 ${
isSelected
? 'text-primary-900 bg-primary-100 font-medium'
: 'text-primary-500 hover:text-primary-900 hover:bg-primary-50 bg-transparent'
}`}
>
<span className={`text-xs font-mono min-w-[1.2rem] shrink-0 pt-[3px] text-left ${
isHot && index === 0 ? 'text-[#FF2D55] font-black italic text-sm scale-110 drop-shadow-sm' :
isHot && index === 1 ? 'text-[#FF9500] font-extrabold italic' :
isHot && index === 2 ? 'text-[#FFCC00] font-bold italic' :
'text-primary-300'
}`}>
{index + 1}.
</span>
<div className="flex-1 leading-relaxed truncate min-w-0">
{item.title}
</div>
</div>
</div>
);
};
export default function CodingCommunity({
onLoginRequest,
viewMode = 'default',
onCloseFavorites,
initialQuestionId,
onQuestionSelect,
searchQuery: externalSearchQuery,
onSearchChange,
searchPlaceholder,
questions: propQuestions,
categories: propCategories
}: CodingCommunityProps) {
const { data: session } = useSession();
const [hotLimit, setHotLimit] = useState(10);
const [hotExpandedLimit, setHotExpandedLimit] = useState(20);
const [isSearchFocused, setIsSearchFocused] = useState(false);
const searchContainerRef = useRef<HTMLDivElement>(null);
useEffect(() => {
const fetchConfig = async () => {
try {
const [limitRes, expandedLimitRes] = await Promise.all([
api.get('/system/config/hot_questions_limit'),
api.get('/system/config/hot_questions_expanded_limit')
]);
if (limitRes) setHotLimit(Number(limitRes));
if (expandedLimitRes) setHotExpandedLimit(Number(expandedLimitRes));
} catch (e) {
console.error("Failed to fetch config", e);
}
};
fetchConfig();
}, []);
const [internalQuestions, setInternalQuestions] = useState<QuestionItem[]>([]);
const [internalCategories, setInternalCategories] = useState<Category[]>([]);
const questions = propQuestions || internalQuestions;
const categories = propCategories || internalCategories;
const [expandedCategoryIds, setExpandedCategoryIds] = useState<string[]>(['hot']);
const [internalSearchQuery, setInternalSearchQuery] = useState('');
const searchQuery = externalSearchQuery !== undefined ? externalSearchQuery : internalSearchQuery;
const setSearchQuery = onSearchChange || setInternalSearchQuery;
const filteredSearchResults = useMemo(() => {
if (!searchQuery) return [];
return questions.filter(q => q.title.toLowerCase().includes(searchQuery.toLowerCase()));
}, [questions, searchQuery]);
useEffect(() => {
function handleClickOutsideSearch(event: MouseEvent) {
if (searchContainerRef.current && !searchContainerRef.current.contains(event.target as Node)) {
setIsSearchFocused(false);
}
}
document.addEventListener("mousedown", handleClickOutsideSearch);
return () => {
document.removeEventListener("mousedown", handleClickOutsideSearch);
};
}, []);
const [selectedQuestion, setSelectedQuestion] = useState<QuestionItem | null>(null);
const [solutionHtml, setSolutionHtml] = useState('');
const [toc, setToc] = useState<{ id: string; text: string; level: number }[]>([]);
const [transcriptHtml, setTranscriptHtml] = useState('');
const [activeTab, setActiveTab] = useState('solution');
const [isLoading, setIsLoading] = useState(!(propQuestions && propCategories));
const [showSkeleton, setShowSkeleton] = useState(true);
const mountTimeRef = useRef(Date.now());
useEffect(() => {
if (!isLoading) {
const timer = setTimeout(() => {
setShowSkeleton(false);
}, 500);
return () => clearTimeout(timer);
} else {
setShowSkeleton(true);
}
}, [isLoading]);
const [hoveredQuestionId, setHoveredQuestionId] = useState<string | null>(null);
const [favoriteIds, setFavoriteIds] = useState<Set<string>>(new Set());
const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);
const [isHotExpanded, setIsHotExpanded] = useState(false);
const contentScrollRef = useRef<HTMLDivElement>(null);
const [showNoteIcon, setShowNoteIcon] = useState(true);
const [isNoteModalOpen, setIsNoteModalOpen] = useState(false);
useEffect(() => {
const savedVisibility = localStorage.getItem('noteIconVisible');
if (savedVisibility === 'false') {
setShowNoteIcon(false);
}
const handleShowIcon = () => {
setShowNoteIcon(true);
localStorage.setItem('noteIconVisible', 'true');
};
window.addEventListener('SHOW_NOTE_ICON', handleShowIcon);
return () => {
window.removeEventListener('SHOW_NOTE_ICON', handleShowIcon);
};
}, []);
const [sidebarWidth, setSidebarWidth] = useState(390);
const [isResizing, setIsResizing] = useState(false);
const sidebarRef = useRef<HTMLDivElement>(null);
const startResizing = useCallback((e: React.MouseEvent) => {
e.preventDefault();
setIsResizing(true);
}, []);
const stopResizing = useCallback(() => {
setIsResizing(false);
}, []);
const resize = useCallback(
(mouseMoveEvent: MouseEvent) => {
if (isResizing && sidebarRef.current) {
const sidebarLeft = sidebarRef.current.getBoundingClientRect().left;
const newWidth = mouseMoveEvent.clientX - sidebarLeft;
if (newWidth >= 240 && newWidth <= 600) {
setSidebarWidth(newWidth);
}
}
},
[isResizing]
);
useEffect(() => {
if (isResizing) {
window.addEventListener("mousemove", resize);
window.addEventListener("mouseup", stopResizing);
document.body.style.cursor = "col-resize";
document.body.style.userSelect = "none";
} else {
window.removeEventListener("mousemove", resize);
window.removeEventListener("mouseup", stopResizing);
document.body.style.cursor = "";
document.body.style.userSelect = "";
}
return () => {
window.removeEventListener("mousemove", resize);
window.removeEventListener("mouseup", stopResizing);
document.body.style.cursor = "";
document.body.style.userSelect = "";
};
}, [isResizing, resize, stopResizing]);
const isFavorite = useMemo(() => {
return selectedQuestion ? favoriteIds.has(selectedQuestion.id) : false;
}, [selectedQuestion, favoriteIds]);
const showToast = (message: string, type: 'success' | 'error' = 'success') => {
setToast({ message, type });
setTimeout(() => setToast(null), 2000);
};
useEffect(() => {
if (contentScrollRef.current) {
contentScrollRef.current.scrollTop = 0;
}
}, [selectedQuestion?.id, activeTab]);
useEffect(() => {
if (session?.user) {
api.get<any[]>('/favorites').then(res => {
setFavoriteIds(new Set(res.map((item: any) => item.questionId)));
}).catch(console.error);
} else {
setFavoriteIds(new Set());
}
}, [session]);
const toggleFavorite = async () => {
if (!session?.user) {
onLoginRequest?.();
return;
}
if (!selectedQuestion) return;
try {
const newStatus = !isFavorite;
showToast(newStatus ? 'å·²æ·»åŠ åˆ°æ”¶è—' : 'å·²å–æ¶ˆæ”¶è—');
setFavoriteIds(prev => {
const next = new Set(prev);
if (newStatus) {
next.add(selectedQuestion.id);
} else {
next.delete(selectedQuestion.id);
}
return next;
});
const res = await api.post<{ isFavorite: boolean }>(`/favorites/${selectedQuestion.id}`, {});
if (res.isFavorite !== newStatus) {
setFavoriteIds(prev => {
const next = new Set(prev);
if (res.isFavorite) {
next.add(selectedQuestion.id);
} else {
next.delete(selectedQuestion.id);
}
return next;
});
}
} catch (error) {
console.error('Failed to toggle favorite:', error);
showToast('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
setFavoriteIds(prev => {
const next = new Set(prev);
if (!isFavorite) {
next.delete(selectedQuestion.id);
} else {
next.add(selectedQuestion.id);
}
return next;
});
}
};
const marked = useMemo(() => {
const renderer = {
html(token: any) {
const text = typeof token === 'string' ? token : token.text;
return text.replace(/&/g, '&amp;')
.replace(/</g, '&lt;')
.replace(/>/g, '&gt;')
.replace(/"/g, '&quot;')
.replace(/'/g, '&#039;');
},
heading({ text, depth }: any) {
const cleanText = text.replace(/<[^>]*>?/gm, '');
const id = cleanText.trim().replace(/\s+/g, '-').toLowerCase().replace(/[^\w\u4e00-\u9fa5-]/g, '');
return `<h${depth} id="${id}">${text}</h${depth}>`;
},
code({ text, lang }: any) {
if (lang === 'mermaid') {
const id = `mermaid-${Math.random().toString(36).substr(2, 9)}`;
return `
<div class="mermaid-container my-8 border border-primary-200 rounded-xl bg-white shadow-sm overflow-hidden group/mermaid print:border-none print:shadow-none relative">
<div class="mermaid-loading absolute inset-0 flex flex-col items-center justify-center bg-white z-10 transition-opacity duration-300">
<svg class="animate-spin h-6 w-6 text-primary-500 mb-2" xmlns="http:
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
<span class="text-xs text-primary-400 font-medium">æ¸²æŸ“æµç¨‹å›¾...</span>
</div>
<div class="mermaid-toolbar flex items-center justify-between px-4 py-2 bg-primary-50 border-b border-primary-100 print:hidden opacity-0 transition-opacity duration-300">
<span class="text-xs font-medium text-primary-500 flex items-center gap-1.5 select-none">
<svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
</svg>
æµç¨‹å›¾
</span>
<div class="flex items-center gap-1">
<button class="p-1.5 hover:bg-white rounded-md text-primary-500 hover:text-primary-700 transition-colors zoom-out-btn" data-target="${id}" title="ç¼©å°">
<svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
</svg>
</button>
<span class="text-xs font-mono text-primary-400 w-9 text-center zoom-level select-none" data-target="${id}">100%</span>
<button class="p-1.5 hover:bg-white rounded-md text-primary-500 hover:text-primary-700 transition-colors zoom-in-btn" data-target="${id}" title="æ”¾å¤§">
<svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
</svg>
</button>
<div class="w-px h-3 bg-primary-200 mx-1"></div>
<button class="p-1.5 hover:bg-white rounded-md text-primary-500 hover:text-primary-700 transition-colors zoom-reset-btn" data-target="${id}" title="é‡ç½®">
<svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
</svg>
</button>
</div>
</div>
<div class="overflow-auto p-6 bg-white flex justify-center items-center min-h-[120px] relative">
<div id="${id}" class="mermaid transition-opacity duration-300 opacity-0 ease-out origin-center" data-scale="1">${text}</div>
</div>
</div>
`;
}
const language = lang || 'plaintext';
return `
<div class="code-block-wrapper group/code relative my-6 rounded-xl overflow-hidden border border-primary-200 shadow-[0_2px_8px_rgba(0,0,0,0.04)] bg-neutral-white transition-all hover:shadow-[0_4px_12px_rgba(0,0,0,0.08)]">
<div class="flex items-center justify-between px-4 py-3 bg-primary-50/30 border-b border-primary-100/50 backdrop-blur-sm rounded-t-xl">
<div class="flex items-center gap-2">
<div class="w-3 h-3 rounded-full bg-[#ff5f57] shadow-[inset_0_0_2px_rgba(0,0,0,0.1)] border border-black/5 hover:scale-110 transition-transform duration-200"></div>
<div class="w-3 h-3 rounded-full bg-[#febc2e] shadow-[inset_0_0_2px_rgba(0,0,0,0.1)] border border-black/5 hover:scale-110 transition-transform duration-200"></div>
<div class="w-3 h-3 rounded-full bg-[#28c840] shadow-[inset_0_0_2px_rgba(0,0,0,0.1)] border border-black/5 hover:scale-110 transition-transform duration-200"></div>
</div>
<div class="flex items-center gap-3">
<div class="text-[10px] font-mono font-medium text-primary-400 uppercase tracking-wider select-none opacity-0 group-hover/code:opacity-100 transition-opacity">
${language}
</div>
<button class="copy-code-btn opacity-0 group-hover/code:opacity-100 transition-opacity p-1.5 hover:bg-primary-100 rounded-md text-primary-400 hover:text-primary-600" title="å¤åˆ¶/Copy">
<svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
</svg>
</button>
</div>
</div>
<pre class="!my-0 !border-none !rounded-none !bg-transparent !shadow-none overflow-x-auto custom-scrollbar"><code class="hljs language-${language} !bg-transparent font-mono text-[13px] leading-relaxed">${text}</code></pre>
</div>
`;
}
};
return new Marked(
markedHighlight({
langPrefix: 'hljs language-',
highlight(code, lang) {
if (lang === 'mermaid') return code;
const language = hljs.getLanguage(lang) ? lang : 'plaintext';
return hljs.highlight(code, { language }).value;
}
}),
{ renderer }
);
}, []);
useEffect(() => {
mermaid.initialize({
startOnLoad: false,
theme: 'default',
securityLevel: 'loose',
});
}, []);
useEffect(() => {
if (!solutionHtml) {
setToc([]);
return;
}
const div = document.createElement('div');
div.innerHTML = solutionHtml;
const headings = Array.from(div.querySelectorAll('h1, h2, h3'));
const newToc = headings.map((h, index) => {
let id = h.id;
if (!id) {
id = `heading-${index}`;
}
return {
id,
text: h.textContent || '',
level: parseInt(h.tagName.substring(1))
};
});
setToc(newToc);
}, [solutionHtml]);
useEffect(() => {
if (propQuestions && propCategories) {
if (isLoading) {
const elapsedTime = Date.now() - mountTimeRef.current;
const minLoadingTime = 800;
if (elapsedTime < minLoadingTime) {
const timer = setTimeout(() => {
setIsLoading(false);
}, minLoadingTime - elapsedTime);
return () => clearTimeout(timer);
} else {
setIsLoading(false);
}
} else {
setIsLoading(false);
}
return;
}
const fetchData = async () => {
const fetchStartTime = Date.now();
try {
const [questionsData, categoriesData] = await Promise.all([
api.get<QuestionItem[]>('/questions'),
api.get<Category[]>('/questions/categories')
]);
setInternalQuestions(questionsData);
setInternalCategories(categoriesData);
setExpandedCategoryIds(['hot', ...categoriesData.map(c => c.id)]);
} catch (error) {
console.error('Failed to fetch data:', error);
} finally {
const elapsedTime = Date.now() - fetchStartTime;
const minLoadingTime = 800;
if (elapsedTime < minLoadingTime) {
setTimeout(() => {
setIsLoading(false);
}, minLoadingTime - elapsedTime);
} else {
setIsLoading(false);
}
}
};
fetchData();
}, [propQuestions, propCategories]);
useEffect(() => {
if (propCategories && propCategories.length > 0 && expandedCategoryIds.length === 1 && expandedCategoryIds[0] === 'hot') {
setExpandedCategoryIds(['hot', ...propCategories.map(c => c.id)]);
}
}, [propCategories]);
const toggleCategory = (categoryId: string) => {
setExpandedCategoryIds(prev =>
prev.includes(categoryId)
? prev.filter(id => id !== categoryId)
: [...prev, categoryId]
);
};
const groupedQuestions = useMemo(() => {
const groups: Record<string, QuestionItem[]> = {};
categories.forEach(cat => {
groups[cat.id] = [];
});
questions.forEach(q => {
if (groups[q.categoryId]) {
groups[q.categoryId].push(q);
} else {
if (!groups['uncategorized']) groups['uncategorized'] = [];
groups['uncategorized'].push(q);
}
});
return groups;
}, [questions, categories]);
const filteredQuestions = useMemo(() => {
let result = questions;
if (viewMode === 'favorites-only') {
result = result.filter(q => favoriteIds.has(q.id));
}
if (searchQuery) {
result = result.filter(q =>
q.title.toLowerCase().includes(searchQuery.toLowerCase())
);
}
return result;
}, [questions, searchQuery, viewMode, favoriteIds]);
const [hotQuestionsOffset, setHotQuestionsOffset] = useState(0);
const [isRefreshingHot, setIsRefreshingHot] = useState(false);
const allHotQuestions = useMemo(() => {
return [...questions]
.sort((a, b) => (b.hotScore || 0) - (a.hotScore || 0))
.slice(0, 50);
}, [questions]);
const hotQuestions = useMemo(() => {
const start = hotQuestionsOffset % Math.max(1, allHotQuestions.length);
const end = start + 10;
let result = allHotQuestions.slice(start, end);
if (result.length < 10 && allHotQuestions.length > 10) {
result = [...result, ...allHotQuestions.slice(0, 10 - result.length)];
}
return result;
}, [allHotQuestions, hotQuestionsOffset]);
const handleRefreshHot = () => {
setIsRefreshingHot(true);
setTimeout(() => setIsRefreshingHot(false), 500);
setHotQuestionsOffset(prev => (prev + 10) % Math.max(10, allHotQuestions.length));
};
const VideoPreview = ({ url, title }: { url: string; title: string }) => {
return (
<div className="absolute left-1/2 -translate-x-1/2 bottom-full mb-3 w-64 bg-white rounded-lg shadow-xl border border-primary-200 p-2 z-50 animate-in fade-in zoom-in-95 duration-200 pointer-events-none">
<div className="relative aspect-video bg-black rounded overflow-hidden mb-2">
<video
src={url}
className="w-full h-full object-cover"
autoPlay
muted
loop
playsInline
/>
</div>
<div className="text-xs text-primary-600 font-medium truncate px-1">
{title}
</div>
<div className="text-[10px] text-primary-400 px-1 mt-0.5">
æ­£åœ¨æ’­æ”¾è§†é¢‘è®²è§£
</div>
{}
<div className="absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-b border-r border-primary-200 transform rotate-45"></div>
</div>
);
};
const favoriteQuestions = useMemo(() => {
return questions.filter(q => favoriteIds.has(q.id));
}, [questions, favoriteIds]);
const selectQuestion = useCallback(async (item: QuestionItem, updateUrl = true) => {
setSelectedQuestion(item);
if (onQuestionSelect) onQuestionSelect(item.id);
setActiveTab('solution');
if (updateUrl) {
window.history.pushState({}, '', `/questions/${item.id}`);
}
try {
if (item.solution) {
const html = await marked.parse(item.solution);
setSolutionHtml(html);
} else {
setSolutionHtml('<p>æš‚æ— é¢˜è§£</p>');
}
if (item.transcript) {
const html = await marked.parse(item.transcript);
setTranscriptHtml(html);
} else {
setTranscriptHtml('');
}
} catch (error) {
console.error('Failed to parse content:', error);
setSolutionHtml('<p>åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>');
}
}, [marked]);
useEffect(() => {
if (questions.length > 0) {
if (initialQuestionId) {
const q = questions.find(q => q.id === initialQuestionId);
if (q) {
if (selectedQuestion?.id !== q.id) {
selectQuestion(q, false);
}
}
} else {
if (selectedQuestion) {
setSelectedQuestion(null);
if (onQuestionSelect) onQuestionSelect(null);
}
}
}
}, [questions, initialQuestionId, selectQuestion]);
useEffect(() => {
const handlePopState = () => {
const path = window.location.pathname;
const match = path.match(/\/questions\/([^\/]+)/);
if (match) {
const id = match[1];
if (questions.length > 0) {
const q = questions.find(q => q.id === id);
if (q && q.id !== selectedQuestion?.id) {
selectQuestion(q, false);
}
}
} else if (path === '/' || path === '') {
if (selectedQuestion) {
setSelectedQuestion(null);
if (onQuestionSelect) onQuestionSelect(null);
}
}
};
window.addEventListener('popstate', handlePopState);
return () => window.removeEventListener('popstate', handlePopState);
}, [questions, selectedQuestion, selectQuestion]);
const markdownStyles = `
[&>h1]:text-2xl [&>h1]:pb-3 [&>h1]:border-b [&>h1]:border-primary-200 [&>h1]:mt-0 [&>h1]:mb-5 [&>h1]:font-bold [&>h1]:text-primary-900 [&>h1]:relative [&>h1]:after:content-[''] [&>h1]:after:absolute [&>h1]:after:bottom-[-1px] [&>h1]:after:left-0 [&>h1]:after:w-[50px] [&>h1]:after:h-[3px] [&>h1]:after:bg-accent-copper [&>h1]:after:rounded-[2px]
[&>h2]:text-xl [&>h2]:mt-[30px] [&>h2]:mb-4 [&>h2]:font-semibold [&>h2]:text-primary-900 [&>h2]:pl-[10px] [&>h2]:border-l-4 [&>h2]:border-accent-copper [&>h2]:leading-[1.4]
[&>h3]:text-[17px] [&>h3]:mt-6 [&>h3]:mb-[14px] [&>h3]:font-semibold [&>h3]:text-primary-800
[&>p]:mt-0 [&>p]:mb-4 [&>p]:text-justify
[&_pre]:p-4 [&_pre]:overflow-auto [&_pre]:text-[13px] [&_pre]:leading-[1.5] [&_pre]:bg-white [&_pre]:rounded-lg [&_pre]:mb-5 [&_pre]:text-primary-800 [&_pre]:shadow-sm [&_pre]:border [&_pre]:border-primary-200
[&_pre_code.hljs]:bg-transparent [&_pre_code.hljs]:p-0
[&_code]:font-mono
[&_:not(pre)>code]:p-[3px_6px] [&_:not(pre)>code]:mx-[2px] [&_:not(pre)>code]:text-[0.9em] [&_:not(pre)>code]:bg-accent-copper/10 [&_:not(pre)>code]:text-accent-copper [&_:not(pre)>code]:rounded
[&_blockquote]:p-[16px_20px] [&_blockquote]:text-primary-600 [&_blockquote]:bg-primary-50 [&_blockquote]:border-l-4 [&_blockquote]:border-accent-copper [&_blockquote]:my-6 [&_blockquote]:rounded-r
[&_ul]:pl-6 [&_ul]:mb-5 [&_ol]:pl-6 [&_ol]:mb-5
[&_li]:mb-2
[&_a]:text-accent-copper [&_a]:no-underline [&_a]:font-medium [&_a]:border-b [&_a]:border-dashed [&_a]:border-accent-copper [&_a]:transition-all [&_a]:hover:border-solid [&_a]:hover:opacity-80
`;
return (
<div className="flex h-full bg-primary-50 p-5 gap-5 box-border relative">
{}
{toast && (
<div className={`absolute top-6 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg text-sm font-medium animate-in fade-in slide-in-from-top-4 duration-200 ${
toast.type === 'success' ? 'bg-white text-green-600 border border-green-100' : 'bg-white text-red-600 border border-red-100'
}`}>
<div className="flex items-center gap-2">
{toast.type === 'success' ? (
<svg xmlns="http:
<path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
</svg>
) : (
<svg xmlns="http:
<path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
</svg>
)}
{toast.message}
</div>
</div>
)}
{}
<div
ref={sidebarRef}
style={{ width: sidebarWidth }}
className="relative flex flex-col h-full shrink-0"
>
{}
<div
onMouseDown={startResizing}
className={`absolute -right-[15px] top-0 bottom-0 w-[10px] cursor-col-resize z-50 flex justify-center items-center hover:bg-primary-200/30 transition-colors rounded-full my-2 ${isResizing ? 'bg-primary-200/50' : ''}`}
title="æ‹–åŠ¨è°ƒæ•´å®½åº¦"
>
<div className="w-[2px] h-8 bg-primary-300 rounded-full" />
</div>
<div className="flex-1 overflow-y-auto pl-[10px] pr-0.5 pb-[10px] m-0 pt-3 [&::-webkit-scrollbar]:w-1.5 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-transparent hover:[&::-webkit-scrollbar-thumb]:bg-primary-200 [&::-webkit-scrollbar-thumb]:rounded-full">
{isLoading ? (
<div className="px-3 pb-2 pt-2 animate-pulse select-none">
{[1, 2, 3, 4, 5, 6].map((i) => (
<div key={i} className="mb-4">
{}
<div className="flex items-center py-1 px-2 gap-3 mb-2">
<div className="w-3 h-3 rounded bg-primary-200/50 shrink-0" />
<div className="h-4 bg-primary-200/50 rounded w-24" />
<div className="ml-auto w-8 h-4 bg-primary-100/50 rounded-full" />
</div>
{}
{i <= 2 && (
<div className="pl-6 space-y-3">
<div className="flex items-center gap-2">
<div className="w-4 h-3 bg-primary-100/50 rounded shrink-0" />
<div className="h-3 bg-primary-100/50 rounded w-3/4" />
</div>
<div className="flex items-center gap-2">
<div className="w-4 h-3 bg-primary-100/50 rounded shrink-0" />
<div className="h-3 bg-primary-100/50 rounded w-1/2" />
</div>
<div className="flex items-center gap-2">
<div className="w-4 h-3 bg-primary-100/50 rounded shrink-0" />
<div className="h-3 bg-primary-100/50 rounded w-2/3" />
</div>
</div>
)}
</div>
))}
</div>
) : (viewMode === 'favorites-only') ? (
<ul className="list-none m-0 p-0">
{filteredQuestions.length === 0 ? (
<div className="p-4 text-center text-primary-400 text-sm">
{viewMode === 'favorites-only' ? 'æš‚æ— æ”¶è—é¢˜ç›®' : 'æ— åŒ¹é…é¢˜ç›®'}
</div>
) : (
filteredQuestions.map((item) => (
<li
key={item.id}
onClick={() => selectQuestion(item)}
className={`group p-[10px_14px] mb-1 cursor-pointer rounded-lg transition-all duration-200 flex items-start gap-3 text-sm text-primary-700 leading-relaxed hover:bg-primary-100 hover:text-primary-900 ${selectedQuestion?.id === item.id ? 'bg-primary-200 text-primary-900 font-medium' : ''}`}
>
<span className="flex-1 truncate" title={item.title}>
{item.title}
</span>
<span className="text-xs text-primary-400 bg-primary-50 px-2 py-0.5 rounded border border-primary-100">
{categories.find(c => c.id === item.categoryId)?.name || 'æœªåˆ†ç±»'}
</span>
</li>
))
)}
</ul>
) : (
<div className="flex flex-col">
<div className="px-3 pb-2 pt-0">
{}
{categories.map((category) => {
const categoryQuestions = groupedQuestions[category.id] || [];
const isExpanded = expandedCategoryIds.includes(category.id);
const isActiveCategory = selectedQuestion?.categoryId === category.id;
if (categoryQuestions.length === 0) return null;
return (
<div key={category.id} className="mb-0.5">
<div
onClick={() => toggleCategory(category.id)}
className={`
flex items-center py-2 px-2 cursor-pointer rounded-lg transition-all duration-200 group select-none
${isExpanded
? 'text-primary-900 font-medium'
: 'text-primary-600 hover:text-primary-900 hover:bg-primary-50'
}
`}
>
<div className="flex items-center gap-2 min-w-0 w-full">
<svg
className={`w-4 h-4 transition-transform duration-200 shrink-0 ${isExpanded ? 'rotate-90 text-primary-500' : 'text-primary-400 group-hover:text-primary-600'}`}
fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}
>
<path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7" />
</svg>
<span className="text-[14px] tracking-tight truncate min-w-0">
{category.name}
</span>
<span className="ml-auto text-[11px] text-primary-400 bg-primary-50 px-1.5 py-0.5 rounded-full group-hover:bg-primary-100 transition-colors">
{categoryQuestions.length}
</span>
</div>
</div>
{isExpanded && (
<div className="pl-6 space-y-0.5 animate-in slide-in-from-top-1 fade-in duration-200">
{categoryQuestions.map((item, index) => (
<QuestionListItem
key={item.id}
item={item}
index={index}
isSelected={selectedQuestion?.id === item.id}
onSelect={selectQuestion}
/>
))}
</div>
)}
</div>
);
})}
</div>
</div>
)}
</div>
</div>
{}
<div className="flex-1 p-0 bg-neutral-white rounded-xl shadow-[0_4px_12px_rgba(45,31,31,0.03)] flex flex-col overflow-hidden border border-primary-100 relative">
{selectedQuestion ? (
<>
<div className="flex items-center justify-between px-8 py-4 border-b border-primary-100 bg-neutral-white">
<div className="flex items-center gap-4">
<button
onClick={() => {
setSelectedQuestion(null);
if (onQuestionSelect) onQuestionSelect(null);
window.history.pushState({}, '', '/');
}}
className="w-10 h-10 flex items-center justify-center rounded-xl text-primary-400 hover:text-accent-copper hover:bg-primary-50 transition-all duration-200 group border border-transparent hover:border-primary-100"
title="è¿”å›åˆ—è¡¨"
>
<svg xmlns="http:
</button>
<div className="flex p-1.5 bg-primary-50 rounded-xl">
<button
onClick={() => setActiveTab('solution')}
className={`px-6 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${
activeTab === 'solution'
? 'bg-neutral-white text-accent-copper shadow-[0_2px_8px_rgba(0,0,0,0.04)]'
: 'text-primary-500 hover:text-primary-700'
}`}
>
é¢˜è§£
</button>
<button
onClick={() => setActiveTab('answer')}
className={`px-6 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${
activeTab === 'answer'
? 'bg-neutral-white text-accent-copper shadow-[0_2px_8px_rgba(0,0,0,0.04)]'
: 'text-primary-500 hover:text-primary-700'
}`}
>
æ¨¡æ‹Ÿå›ç­”
</button>
<button
onClick={() => setActiveTab('explanation')}
className={`px-6 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${
activeTab === 'explanation'
? 'bg-neutral-white text-accent-copper shadow-[0_2px_8px_rgba(0,0,0,0.04)]'
: 'text-primary-500 hover:text-primary-700'
}`}
>
å¥½é¢˜ç²¾è®²
</button>
</div>
</div>
{}
<div
onClick={toggleFavorite}
className={`flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg cursor-pointer transition-colors duration-200 border select-none min-w-[92px] ${
isFavorite
? 'bg-red-50 text-red-500 border-red-200 hover:bg-red-100'
: 'bg-white text-gray-400 border-gray-200 hover:text-gray-600 hover:border-gray-300'
}`}
title={isFavorite ? "å–æ¶ˆæ”¶è—" : "æ”¶è—é¢˜ç›®"}
>
<svg
xmlns="http:
viewBox="0 0 24 24"
fill={isFavorite ? "currentColor" : "none"}
stroke="currentColor"
strokeWidth="2"
strokeLinecap="round"
strokeLinejoin="round"
className={`w-5 h-5 transition-transform duration-200 ${isFavorite ? 'scale-110' : ''}`}
>
<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
</svg>
<span className="text-sm font-medium">{isFavorite ? "å·²æ”¶è—" : "æ”¶è—"}</span>
</div>
</div>
{activeTab === 'solution' ? (
<div
ref={contentScrollRef}
className={`markdown-body p-6 sm:p-[30px] overflow-y-auto flex-1 text-[15px] leading-relaxed text-primary-800 custom-scrollbar ${markdownStyles}`}
>
<div className="max-w-4xl mx-auto min-h-full flex flex-col">
<MermaidContent html={solutionHtml} className="flex-1" />
{}
<div className="mt-12 pt-8 border-t border-primary-100 flex justify-between items-center text-sm">
<button className="group flex items-center gap-2 px-4 py-2 rounded-lg text-primary-500 hover:text-primary-900 hover:bg-primary-50 transition-all cursor-not-allowed opacity-50" disabled>
<svg className="w-4 h-4 transition-transform group-hover:-translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
</svg>
<span>ä¸Šä¸€é¢˜</span>
</button>
<button className="group flex items-center gap-2 px-4 py-2 rounded-lg text-primary-500 hover:text-primary-900 hover:bg-primary-50 transition-all cursor-not-allowed opacity-50" disabled>
<span>ä¸‹ä¸€é¢˜</span>
<svg className="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
</svg>
</button>
</div>
</div>
</div>
) : activeTab === 'answer' ? (
<div
ref={contentScrollRef}
className="flex-1 p-6 sm:p-[30px] overflow-y-auto custom-scrollbar bg-neutral-white/50"
>
<div className="flex flex-col gap-8 max-w-3xl mx-auto">
{}
<div className="flex items-start gap-3">
<div className="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center shrink-0 text-xl border border-primary-200">
ğŸ¤–
</div>
<div className="flex-1 min-w-0 flex flex-col items-start max-w-[85%]">
<div className="bg-white border border-primary-200 p-4 rounded-2xl rounded-tl-none shadow-[0_2px_8px_rgba(0,0,0,0.04)] relative">
<div className="text-primary-800 leading-relaxed whitespace-pre-wrap">
{selectedQuestion.interviewerQuestion || 'è¯·ç®€è¿°ä¸€ä¸‹è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚'}
</div>
</div>
</div>
</div>
{}
<div className="flex items-start gap-3 flex-row-reverse">
<div className="shrink-0">
<UserAvatar user={session?.user} size="md" />
</div>
<div className="flex-1 min-w-0 flex flex-col items-end max-w-[85%]">
<div className="bg-primary-50 border border-primary-100 p-4 rounded-2xl rounded-tr-none shadow-sm relative overflow-hidden text-left">
{transcriptHtml ? (
<MermaidContent
html={transcriptHtml}
className={`markdown-body text-primary-800 leading-relaxed [&>p]:mb-2 [&>p:last-child]:mb-0 ${markdownStyles}`}
/>
) : (
<p className="text-primary-400 italic">æš‚æ— å›ç­”è®°å½•</p>
)}
</div>
</div>
</div>
</div>
</div>
) : (
<div className="flex-1 p-6 sm:p-[30px] overflow-y-auto custom-scrollbar bg-neutral-white/50 flex flex-col items-center justify-center">
<div className="w-16 h-16 bg-primary-50 rounded-full flex items-center justify-center mb-4 text-3xl">
ğŸ¥
</div>
<h3 className="text-lg font-bold text-primary-800 mb-2">å¥½é¢˜ç²¾è®²</h3>
<p className="text-primary-500 text-sm">è¯¥é¢˜ç›®çš„æ·±åº¦è§£æè§†é¢‘/æ–‡ç« å³å°†ä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
</div>
)}
</>
) : (initialQuestionId && questions.length === 0) ? (
<div className="flex flex-col h-full w-full items-center justify-center p-6 bg-neutral-white/30 text-primary-400">
<div className="w-8 h-8 border-4 border-primary-200 border-t-accent-gold rounded-full animate-spin mb-4"></div>
<p>æ­£åœ¨åŠ è½½é¢˜ç›®...</p>
</div>
) : (initialQuestionId && !selectedQuestion) ? (
<div className="flex flex-col h-full w-full items-center justify-center p-6 bg-neutral-white/30 text-primary-400">
<div className="w-16 h-16 bg-primary-50 rounded-full flex items-center justify-center mb-4 text-2xl">?</div>
<p className="mb-4">æœªæ‰¾åˆ°è¯¥é¢˜ç›®</p>
<button
onClick={() => {
onQuestionSelect?.(null);
window.history.pushState({}, '', '/');
}}
className="px-4 py-2 bg-primary-100 text-primary-700 rounded-lg hover:bg-primary-200 transition-colors text-sm"
>
è¿”å›é¢˜ç›®åˆ—è¡¨
</button>
</div>
) : (
<div className="flex flex-col h-full w-full p-6 overflow-hidden bg-neutral-white/30">
<div className="flex-1 min-h-0 w-full max-w-full mx-auto flex flex-col overflow-y-auto scrollbar-hide px-4">
<div className="hidden">
<div className="w-20 h-20 bg-primary-50 rounded-full flex items-center justify-center mb-6 text-4xl shadow-inner">
ï¿½
</div>
{}
</div>
<div className="flex flex-col items-center justify-start h-full w-full max-w-3xl mx-auto px-4 pt-[15vh]">
<div className="w-full relative group" ref={searchContainerRef}>
<div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none z-10">
<svg
className={`h-6 w-6 text-primary-400 group-focus-within:text-accent-gold transition-all duration-300`}
xmlns="http:
fill="none"
viewBox="0 0 24 24"
stroke="currentColor"
strokeWidth={2}
>
<path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
</svg>
</div>
<input
type="text"
className="block w-full pl-12 pr-12 py-4 border border-primary-200 rounded-2xl leading-5 bg-white text-primary-900 font-medium tracking-wide placeholder-primary-400 focus:outline-none focus:bg-white focus:ring-2 focus:ring-accent-gold/30 focus:border-accent-gold/50 text-lg transition-all duration-300 shadow-lg hover:shadow-xl"
placeholder={searchPlaceholder || "æœç´¢é¢è¯•é¢˜..."}
value={searchQuery}
onChange={(e) => {
setSearchQuery(e.target.value);
setIsSearchFocused(true);
}}
onFocus={() => setIsSearchFocused(true)}
/>
{searchQuery && isSearchFocused && (
<>
<div
className="absolute inset-y-0 right-0 pr-4 flex items-center cursor-pointer"
onClick={() => {
setSearchQuery('');
setIsSearchFocused(true);
}}
>
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
</svg>
</div>
{}
<div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-primary-100 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200 py-2">
<div className="max-h-[400px] overflow-y-auto custom-scrollbar">
{filteredSearchResults.length > 0 ? (
<ul className="">
{filteredSearchResults.map(q => (
<li
key={q.id}
className="px-6 py-3 hover:bg-primary-50 cursor-pointer border-b border-primary-50 last:border-none transition-colors group/item"
onClick={() => {
setSearchQuery('');
setIsSearchFocused(false);
if (onQuestionSelect) onQuestionSelect(q.id);
}}
>
<div className="flex items-center justify-between">
<div className="text-sm font-medium text-primary-900 truncate group-hover/item:text-accent-copper transition-colors">
{q.title.split(new RegExp(`(${searchQuery})`, 'gi')).map((part, i) =>
part.toLowerCase() === searchQuery.toLowerCase() ?
<span key={i} className="text-accent-copper font-bold">{part}</span> :
part
)}
</div>
<span className="text-xs text-primary-500 bg-primary-100/50 px-2 py-1 rounded border border-primary-100 whitespace-nowrap ml-3">
{categories.find(c => c.id === q.categoryId)?.name || 'æœªåˆ†ç±»'}
</span>
</div>
</li>
))}
</ul>
) : (
<div className="p-8 text-center flex flex-col items-center justify-center text-primary-400">
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
</svg>
<span className="text-sm">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</span>
</div>
)}
</div>
</div>
</>
)}
</div>
{}
<div className={`mt-8 flex flex-wrap justify-center gap-3 opacity-60 hover:opacity-100 transition-all duration-300 visible opacity-60 h-auto`}>
{['React', 'Vue', 'Next.js', 'æ€§èƒ½ä¼˜åŒ–', 'ç®—æ³•'].map(tag => (
<button
key={tag}
onClick={() => {
setSearchQuery(tag);
setIsSearchFocused(true);
}}
className="px-4 py-1.5 rounded-full bg-white border border-primary-100 text-sm text-primary-600 hover:border-accent-copper hover:text-accent-copper transition-colors shadow-sm"
>
{tag}
</button>
))}
</div>
{}
<div className={`w-full flex justify-center transition-all duration-300 visible opacity-100 translate-y-0`}>
<div className="mt-8 w-full max-w-2xl bg-white/50 backdrop-blur-sm rounded-2xl border border-white/50 shadow-sm p-6">
<div className="flex items-center justify-between mb-4">
<span className="text-sm font-bold text-primary-800 flex items-center gap-2">
<div className="p-1 rounded-md bg-gradient-to-br from-orange-400 to-red-500 shadow-sm text-white">
<svg xmlns="http:
<path fillRule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.45-.412-1.725a1 1 0 00-2 0c.001.046.002.092.003.139.002.096.005.196.008.3.006.216.015.45.029.7.027.498.07.994.137 1.487.135.986.417 1.948.835 2.857A9.97 9.97 0 0010 18a9.97 9.97 0 005.323-2.637 1 1 0 00-.323-1.637c-.34-.145-.69-.264-1.048-.354-.647-.164-1.306-.272-1.968-.323a1.106 1.106 0 01-.977-1.332c.118-.617.29-1.228.513-1.828.225-.602.502-1.19.829-1.758.324-.564.693-1.107 1.104-1.623.398-.5.842-.96 1.328-1.372a1 1 0 00-.395-1.734z" clipRule="evenodd" />
</svg>
</div>
ç¤¾åŒºçƒ­æ¦œ
</span>
<button
onClick={handleRefreshHot}
className="text-xs text-primary-500 hover:text-primary-800 transition-colors flex items-center gap-1 group/refresh px-2 py-1 rounded-md hover:bg-primary-50"
>
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
</svg>
æ¢ä¸€æ‰¹
</button>
</div>
<div className="relative grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-3">
{}
<div className={`col-span-1 md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-3 transition-opacity duration-500 ${isLoading ? 'opacity-0' : 'opacity-100'}`}>
{hotQuestions.length > 0 ? (
hotQuestions.map((q, index) => {
const rank = hotQuestionsOffset + index + 1;
return (
<div
key={q.id}
className="flex items-center gap-3 group cursor-pointer p-2 rounded-lg hover:bg-white/60 transition-all duration-200"
onClick={() => {
if (onQuestionSelect) onQuestionSelect(q.id);
}}
>
<span className={`text-sm font-black italic w-6 text-center shrink-0 font-mono ${
rank === 1 ? 'text-amber-500' :
rank === 2 ? 'text-slate-500' :
rank === 3 ? 'text-orange-700' :
'text-primary-300 font-medium not-italic'
}`}>
{rank}
</span>
<span className="text-sm text-primary-700 group-hover:text-primary-900 truncate flex-1 transition-colors font-medium">
{q.title}
</span>
{rank <= 3 && (
<span className={`text-[10px] px-1.5 py-0.5 rounded-full font-medium shrink-0 scale-90 ${
rank === 1 ? 'bg-amber-100 text-amber-700' :
'bg-orange-50 text-orange-600'
}`}>
Hot
</span>
)}
</div>
);
})
) : (
<div className="col-span-1 md:col-span-2 flex flex-col items-center justify-center py-12 text-primary-400 min-h-[300px]">
<svg className="w-12 h-12 mb-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
<span className="text-sm">æš‚æ— çƒ­é—¨é—®é¢˜</span>
</div>
)}
</div>
{}
{showSkeleton && (
<div className={`absolute inset-0 w-full bg-white/50 backdrop-blur-sm z-10 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-3 transition-opacity duration-500 ${!isLoading ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
{Array.from({ length: 10 }).map((_, i) => (
<div key={i} className="flex items-center gap-3 p-2 rounded-lg animate-pulse">
<div className="w-6 h-4 rounded bg-primary-200/50 shrink-0" />
<div className="h-4 bg-primary-200/50 rounded flex-1" />
</div>
))}
</div>
)}
</div>
</div>
</div>
</div>
</div>
</div>
)}
</div>
{}
{selectedQuestion && (
<div className="w-[240px] hidden xl:flex flex-col shrink-0 h-full transition-all duration-300">
{}
{activeTab === 'solution' && toc.length > 0 && (
<div className="flex flex-col bg-neutral-white rounded-xl border border-primary-100 shadow-[0_4px_12px_rgba(45,31,31,0.03)] overflow-hidden max-h-full min-h-[200px]">
<div className="p-4 border-b border-primary-100/50 bg-primary-50/30">
<h3 className="font-bold text-primary-900 text-sm flex items-center gap-2">
<svg className="w-4 h-4 text-primary-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h7" />
</svg>
ç›®å½•
</h3>
</div>
<div className="overflow-y-auto p-4 custom-scrollbar">
<ul className="space-y-2 text-sm relative">
{toc.map((item, idx) => (
<li key={idx} className="relative">
<a
href={`#${item.id}`}
onClick={(e) => {
e.preventDefault();
const el = document.getElementById(item.id);
if (el && contentScrollRef.current) {
el.scrollIntoView({ behavior: 'smooth' });
}
}}
className={`block text-primary-500 hover:text-accent-copper transition-colors truncate py-1 ${item.level > 1 ? 'ml-2 text-xs' : 'font-medium'}`}
title={item.text}
>
{item.text}
</a>
</li>
))}
</ul>
</div>
</div>
)}
{}
{activeTab === 'answer' && (
<div className="flex flex-col gap-4">
{}
<div className="bg-neutral-white rounded-xl border border-primary-100 shadow-[0_4px_12px_rgba(45,31,31,0.03)] overflow-hidden">
<div className="p-4 border-b border-primary-100/50 bg-amber-50/50">
<h3 className="font-bold text-amber-800 text-sm flex items-center gap-2">
<span className="text-lg">ğŸ’¡</span>
é¢è¯•é”¦å›Š
</h3>
</div>
<div className="p-4">
<ul className="space-y-3">
<li className="text-xs text-primary-600 flex items-start gap-2">
<span className="w-1.5 h-1.5 rounded-full bg-amber-400 mt-1.5 shrink-0"></span>
<span className="leading-relaxed">ä½¿ç”¨ <strong>STAR æ³•åˆ™</strong> (æƒ…å¢ƒã€ä»»åŠ¡ã€è¡ŒåŠ¨ã€ç»“æœ) ç»„ç»‡ä½ çš„å›ç­”ï¼Œé€»è¾‘æ›´æ¸…æ™°ã€‚</span>
</li>
<li className="text-xs text-primary-600 flex items-start gap-2">
<span className="w-1.5 h-1.5 rounded-full bg-amber-400 mt-1.5 shrink-0"></span>
<span className="leading-relaxed">å…ˆè¯´<strong>æ ¸å¿ƒç»“è®º</strong>ï¼Œå†å±•å¼€æŠ€æœ¯ç»†èŠ‚ï¼Œé¿å…æ¼«æ— è¾¹é™…çš„é“ºå«ã€‚</span>
</li>
<li className="text-xs text-primary-600 flex items-start gap-2">
<span className="w-1.5 h-1.5 rounded-full bg-amber-400 mt-1.5 shrink-0"></span>
<span className="leading-relaxed">é‡åˆ°ä¸ä¼šçš„é—®é¢˜ï¼Œå¯ä»¥å°è¯•è”ç³»ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œæˆ–è¯šå®è¡¨è¾¾å¹¶å±•ç°å­¦ä¹ æ€åº¦ã€‚</span>
</li>
</ul>
</div>
</div>
{}
<div className="bg-neutral-white rounded-xl border border-primary-100 shadow-[0_4px_12px_rgba(45,31,31,0.03)] overflow-hidden min-h-[150px]">
<div className="p-4 border-b border-primary-100/50 bg-blue-50/50">
<h3 className="font-bold text-blue-800 text-sm flex items-center gap-2">
<span className="text-lg">ğŸ”‘</span>
æ ¸å¿ƒå…³é”®è¯
</h3>
</div>
<div className="p-4">
<div className="flex flex-wrap gap-2">
{['åŸç†åˆ†æ', 'æºç è§£è¯»', 'æ€§èƒ½ä¼˜åŒ–', 'æœ€ä½³å®è·µ', 'å¸¸è§å‘ç‚¹', 'å¯¹æ¯”åˆ†æ'].map((tag, i) => (
<span key={i} className="px-2 py-1 bg-primary-50 text-primary-600 text-xs rounded border border-primary-100">
{tag}
</span>
))}
{}
<span className="px-2 py-1 bg-accent-copper/10 text-accent-copper text-xs rounded border border-accent-copper/20">
{categories.find(c => c.id === selectedQuestion.categoryId)?.name || 'é€šç”¨'}
</span>
</div>
<p className="text-[10px] text-primary-400 mt-4 text-center">
å›ç­”æ—¶è¦†ç›–è¿™äº›è¦ç‚¹ï¼Œé€šè¿‡ç‡æ›´é«˜å“¦
</p>
</div>
</div>
</div>
)}
{}
{activeTab === 'explanation' && (
<div className="flex flex-col gap-4">
<div className="bg-neutral-white rounded-xl border border-primary-100 shadow-[0_4px_12px_rgba(45,31,31,0.03)] overflow-hidden min-h-[200px]">
<div className="p-4 border-b border-primary-100/50 bg-indigo-50/50">
<h3 className="font-bold text-indigo-800 text-sm flex items-center gap-2">
<span className="text-lg">ğŸ“š</span>
ç›¸å…³æ¨è
</h3>
</div>
<div className="p-2">
{questions
.filter(q => q.categoryId === selectedQuestion.categoryId && q.id !== selectedQuestion.id)
.slice(0, 5)
.map((item) => (
<div
key={item.id}
onClick={() => selectQuestion(item)}
className="p-3 mb-1 rounded-lg hover:bg-primary-50 cursor-pointer transition-colors group"
>
<div className="text-xs font-medium text-primary-800 line-clamp-2 group-hover:text-accent-copper mb-1">
{item.title}
</div>
<div className="flex items-center gap-2 text-[10px] text-primary-400">
<span>çƒ­åº¦ {item.hotScore || 0}</span>
<span>â€¢</span>
<span>{categories.find(c => c.id === item.categoryId)?.name}</span>
</div>
</div>
))}
{questions.filter(q => q.categoryId === selectedQuestion.categoryId && q.id !== selectedQuestion.id).length === 0 && (
<div className="p-4 text-center text-primary-400 text-xs">
æš‚æ— åŒç±»æ¨è
</div>
)}
</div>
</div>
</div>
)}
{}
{((activeTab === 'solution' && toc.length === 0)) && (
<div className="w-full h-full"></div>
)}
</div>
)}
{}
{viewMode === 'favorites' && (
<div className="absolute right-5 top-5 bottom-5 w-[260px] bg-white/95 backdrop-blur-md shadow-2xl border border-primary-100 flex flex-col z-20 overflow-hidden rounded-xl animate-in fade-in slide-in-from-right-10 duration-500 ease-out">
<div className="p-4 border-b border-primary-100/50 bg-gradient-to-r from-primary-50/80 to-white flex items-center justify-between backdrop-blur-sm">
<div className="flex items-center gap-2">
<div className="w-6 h-6 rounded-md bg-accent-gold/10 flex items-center justify-center text-accent-gold">
<svg xmlns="http:
<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
</svg>
</div>
<div>
<h3 className="text-sm font-bold text-primary-900 leading-tight">æˆ‘çš„æ”¶è—</h3>
<p className="text-[10px] text-primary-500 mt-0.5">å…± {favoriteQuestions.length} é¢˜</p>
</div>
</div>
<button
onClick={onCloseFavorites}
className="w-6 h-6 flex items-center justify-center text-primary-400 hover:text-primary-800 hover:bg-primary-100 rounded-full transition-all duration-200"
title="å…³é—­é¢æ¿"
>
<svg xmlns="http:
<line x1="18" y1="6" x2="6" y2="18"></line>
<line x1="6" y1="6" x2="18" y2="18"></line>
</svg>
</button>
</div>
<div className="flex-1 overflow-y-auto custom-scrollbar p-3 bg-primary-50/30">
{favoriteQuestions.length > 0 ? (
<div className="flex flex-col gap-2">
{favoriteQuestions.map((item, index) => (
<div
key={`fav-list-${item.id}`}
onClick={() => selectQuestion(item)}
className={`p-3 rounded-lg border transition-all duration-200 cursor-pointer group relative overflow-hidden ${
selectedQuestion?.id === item.id
? 'bg-white border-accent-copper shadow-sm ring-1 ring-accent-copper/20'
: 'bg-white border-primary-100/60 hover:border-accent-copper/40 hover:shadow-md hover:shadow-accent-copper/5 hover:-translate-y-0.5'
}`}
>
{selectedQuestion?.id === item.id && (
<div className="absolute left-0 top-0 bottom-0 w-1 bg-accent-copper"></div>
)}
<div className="flex items-start gap-2">
<span className={`text-[10px] font-bold px-1 py-0.5 rounded border mt-0.5 shrink-0 ${
selectedQuestion?.id === item.id
? 'bg-accent-copper/10 text-accent-copper border-accent-copper/20'
: 'bg-primary-50 text-primary-400 border-primary-100 group-hover:border-accent-copper/20 group-hover:text-accent-copper/80'
}`}>
#{index + 1}
</span>
<h4 className={`text-xs font-medium leading-snug line-clamp-2 transition-colors ${
selectedQuestion?.id === item.id ? 'text-primary-900' : 'text-primary-700 group-hover:text-primary-900'
}`}>
{item.title}
</h4>
</div>
<div className="mt-2 flex items-center justify-between">
<div className="flex items-center gap-1">
<span className="text-[10px] text-primary-400 bg-primary-50 px-1.5 py-0.5 rounded-full border border-primary-100/50 scale-90 origin-left">
{categories.find(c => c.id === item.categoryId)?.name || 'æœªåˆ†ç±»'}
</span>
</div>
<div className={`text-accent-copper opacity-0 group-hover:opacity-100 transition-opacity transform translate-x-2 group-hover:translate-x-0 duration-300 ${selectedQuestion?.id === item.id ? '!opacity-100 !translate-x-0' : ''}`}>
<svg xmlns="http:
<path d="M5 12h14"></path>
<path d="M12 5l7 7-7 7"></path>
</svg>
</div>
</div>
</div>
))}
</div>
) : (
<div className="flex flex-col items-center justify-center h-full text-center p-6">
<div className="w-16 h-16 bg-primary-50 rounded-full flex items-center justify-center mb-3 text-3xl shadow-inner border border-primary-100">
ğŸ“­
</div>
<h4 className="text-primary-800 font-bold mb-1 text-sm">æš‚æ— æ”¶è—</h4>
<p className="text-xs text-primary-400 max-w-[150px] leading-relaxed">
ç‚¹å‡»é¢˜ç›®å³ä¸Šè§’çš„â€œæ”¶è—â€æŒ‰é’®æ·»åŠ 
</p>
</div>
)}
</div>
</div>
)}
{}
{}
{}
{session?.user && showNoteIcon && (
<button
className="absolute bottom-8 right-8 w-14 h-14 bg-accent-gold text-white rounded-full shadow-lg hover:bg-accent-gold/90 transition-all duration-300 flex items-center justify-center z-50 hover:scale-110 active:scale-95 group"
title="æˆ‘çš„ç¬”è®° (å³é”®å…³é—­)"
onClick={() => {
setIsNoteModalOpen(true);
}}
onContextMenu={(e) => {
e.preventDefault();
setShowNoteIcon(false);
localStorage.setItem('noteIconVisible', 'false');
showToast('ç¬”è®°å›¾æ ‡å·²éšè—ï¼Œå¯åœ¨â€œæˆ‘çš„ç¬”è®°â€ä¸­é‡æ–°å¼€å¯');
}}
>
<svg xmlns="http:
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
<line x1="16" y1="13" x2="8" y2="13"></line>
<line x1="16" y1="17" x2="8" y2="17"></line>
<polyline points="10 9 9 9 8 9"></polyline>
</svg>
</button>
)}
{}
<NotePadModal
isOpen={isNoteModalOpen}
onClose={() => setIsNoteModalOpen(false)}
/>
</div>
);
}
// File: apps\web\src\components\Home.tsx
import React, { useState, useEffect } from 'react';
interface HomeProps {
onChangeTab: (tab: string) => void;
}
const BannerCarousel = ({ onChangeTab }: { onChangeTab: (tab: string) => void }) => {
const slides = [
{ id: 1, title: "2025 å‰ç«¯é¢è¯•çªå‡»", desc: "å¤§å‚é¢è¯•çœŸé¢˜ï¼Œæ¶µç›– React, Vue, Node.js å…¨æ ˆæŠ€æœ¯ä½“ç³»", bg: "bg-gradient-to-r from-blue-600 to-indigo-700", cta: "å¼€å§‹åˆ·é¢˜", link: "coding" },
{ id: 2, title: "å¤§å‰ç«¯åŒå­¦è¥", desc: "å¯»æ‰¾å¿—åŒé“åˆçš„ä¼™ä¼´ï¼Œä¸€èµ·å¼€æºï¼Œä¸€èµ·æˆé•¿", bg: "bg-gradient-to-r from-orange-500 to-red-600", cta: "åŠ å…¥ç¤¾ç¾¤", link: "camp" },
{ id: 3, title: "æ¯æ—¥ç®—æ³•æŒ‘æˆ˜", desc: "ä¿æŒæ‰‹æ„Ÿï¼Œæ‹’ç»ç”Ÿç–ï¼Œæ¯å¤©ä¸€é“ç²¾é€‰ç®—æ³•é¢˜", bg: "bg-gradient-to-r from-emerald-500 to-teal-600", cta: "ç«‹å³æŒ‘æˆ˜", link: "coding" }
];
const [currentSlide, setCurrentSlide] = useState(0);
useEffect(() => {
const timer = setInterval(() => {
setCurrentSlide((prev) => (prev + 1) % slides.length);
}, 5000);
return () => clearInterval(timer);
}, [slides.length]);
return (
<div className="relative w-full h-[360px] rounded-2xl overflow-hidden shadow-lg mb-10 group border border-primary-100">
{}
<div
className="absolute inset-0 flex transition-transform duration-700 ease-in-out h-full"
style={{ transform: `translateX(-${currentSlide * 100}%)` }}
>
{slides.map((slide) => (
<div key={slide.id} className={`w-full flex-shrink-0 h-full bg-primary-900 flex items-center justify-center p-10 relative overflow-hidden`}>
{}
<div className="absolute inset-0 opacity-20">
<div className="absolute top-0 right-0 w-96 h-96 bg-accent-gold rounded-full -translate-y-1/2 translate-x-1/3 blur-[100px]"></div>
<div className="absolute bottom-0 left-0 w-96 h-96 bg-primary-700 rounded-full translate-y-1/2 -translate-x-1/4 blur-[100px]"></div>
{}
<div className="absolute inset-0 opacity-10" style={{ backgroundImage: 'radial-gradient(circle at 2px 2px, rgba(255,255,255,0.15) 1px, transparent 0)', backgroundSize: '24px 24px' }}></div>
</div>
<div className="relative z-10 text-center max-w-2xl">
<h2 className="text-4xl md:text-5xl font-bold mb-6 tracking-tight text-white">
{slide.title}
</h2>
<p className="text-xl md:text-2xl text-primary-100 mb-8 font-light">
{slide.desc}
</p>
<button
onClick={() => {
if (slide.link === 'coding') onChangeTab('é¢è¯•é¢˜åº“');
if (slide.link === 'camp') onChangeTab('åŒå­¦è¥æ´»åŠ¨');
}}
className="bg-accent-gold text-primary-900 px-8 py-3 rounded-xl font-bold hover:bg-[#eac14d] transition-all shadow-lg transform hover:-translate-y-1"
>
{slide.cta}
</button>
</div>
</div>
))}
</div>
{}
<div className="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-3 z-20">
{slides.map((_, idx) => (
<button
key={idx}
onClick={() => setCurrentSlide(idx)}
className={`h-1.5 rounded-full transition-all duration-300 ${
currentSlide === idx ? 'bg-accent-gold w-8' : 'bg-white/20 hover:bg-white/40 w-2'
}`}
/>
))}
</div>
{}
<button
className="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 backdrop-blur-sm flex items-center justify-center text-white/70 hover:text-white transition-all opacity-0 group-hover:opacity-100 border border-white/10"
onClick={() => setCurrentSlide((prev) => (prev - 1 + slides.length) % slides.length)}
>
<svg xmlns="http:
</button>
<button
className="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 backdrop-blur-sm flex items-center justify-center text-white/70 hover:text-white transition-all opacity-0 group-hover:opacity-100 border border-white/10"
onClick={() => setCurrentSlide((prev) => (prev + 1) % slides.length)}
>
<svg xmlns="http:
</button>
</div>
);
};
export default function Home({ onChangeTab }: HomeProps) {
return (
<div className="h-full overflow-y-auto bg-primary-50 p-6 md:p-10 custom-scrollbar">
<div className="max-w-7xl mx-auto">
<BannerCarousel onChangeTab={onChangeTab} />
{}
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
{[
{
title: "å‰ç«¯é¢˜åº“",
icon: (
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
</svg>
),
desc: "ç²¾é€‰ 1000+ é“å¤§å‚é¢è¯•çœŸé¢˜",
bg: "bg-blue-50",
color: "text-blue-600",
action: () => onChangeTab('é¢è¯•é¢˜åº“')
},
{
title: "æ¨¡æ‹Ÿé¢è¯•",
icon: (
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
</svg>
),
desc: "AI è¾…åŠ©æ¨¡æ‹Ÿé¢è¯•ï¼Œå®æ—¶åé¦ˆ",
bg: "bg-purple-50",
color: "text-purple-600",
action: () => {}
},
{
title: "åŒå­¦è¥",
icon: (
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0z" />
</svg>
),
desc: "åŠ å…¥å¼€æºç¤¾åŒºï¼Œå…±å»ºé¡¹ç›®",
bg: "bg-orange-50",
color: "text-orange-600",
action: () => onChangeTab('åŒå­¦è¥æ´»åŠ¨')
},
{
title: "çŸ¥è¯†å›¾è°±",
icon: (
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
</svg>
),
desc: "ç³»ç»ŸåŒ–æ„å»ºå‰ç«¯çŸ¥è¯†ä½“ç³»",
bg: "bg-green-50",
color: "text-green-600",
action: () => {}
},
].map((item, idx) => (
<div
key={idx}
onClick={item.action}
className="bg-white p-6 rounded-2xl shadow-sm hover:shadow-md transition-all cursor-pointer border border-primary-100 group relative overflow-hidden"
>
<div className="absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity transform group-hover:scale-110 duration-500">
{}
<div className={`text-9xl ${item.color}`}>
{item.icon}
</div>
</div>
<div className={`w-12 h-12 rounded-xl ${item.bg} ${item.color} flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-sm`}>
{item.icon}
</div>
<h3 className="text-lg font-bold text-primary-900 mb-2">{item.title}</h3>
<p className="text-sm text-primary-500">{item.desc}</p>
</div>
))}
</div>
<div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
{}
<div className="lg:col-span-2">
<div className="flex items-center justify-between mb-6">
<h2 className="text-xl font-bold text-primary-900 flex items-center gap-2">
<span className="w-1.5 h-6 bg-primary-800 rounded-full"></span>
æœ€æ–°åŠ¨æ€
</h2>
<button className="text-sm text-primary-600 hover:text-primary-800 font-medium transition-colors">æŸ¥çœ‹æ›´å¤š &rarr;</button>
</div>
<div className="bg-white rounded-2xl shadow-sm border border-primary-100 overflow-hidden">
{[
{ title: "React 19 Beta å‘å¸ƒï¼šæ–°ç‰¹æ€§é€Ÿè§ˆä¸å®æˆ˜è§£æ", tag: "React", date: "2å°æ—¶å‰", views: 2341 },
{ title: "2025 å‰ç«¯æ¶æ„å¸ˆæˆé•¿è·¯çº¿å›¾ V3.0", tag: "èŒä¸šå‘å±•", date: "5å°æ—¶å‰", views: 5120 },
{ title: "æ·±å…¥ç†è§£ TypeScript 5.0 è£…é¥°å™¨æ–°æ ‡å‡†", tag: "TypeScript", date: "1å¤©å‰", views: 1890 },
{ title: "Next.js App Router æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ", tag: "Next.js", date: "2å¤©å‰", views: 3456 },
{ title: "Vue3 + Vite5 å·¥ç¨‹åŒ–é…ç½®å®Œå…¨æŒ‡å—", tag: "Engineering", date: "3å¤©å‰", views: 2789 },
].map((item, idx) => (
<div key={idx} className="flex items-center justify-between p-5 border-b border-primary-50 last:border-none hover:bg-primary-50/50 transition-colors cursor-pointer group">
<div className="flex-1 min-w-0 pr-4">
<h3 className="text-base font-medium text-primary-800 mb-1 group-hover:text-accent-copper truncate transition-colors">{item.title}</h3>
<div className="flex items-center gap-3 text-xs text-primary-400">
<span className="bg-primary-50 text-primary-600 px-2 py-0.5 rounded border border-primary-100">{item.tag}</span>
<span>{item.date}</span>
</div>
</div>
<div className="text-xs text-primary-300 flex items-center gap-1 group-hover:text-primary-500 transition-colors">
<svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
</svg>
{item.views}
</div>
</div>
))}
</div>
</div>
{}
<div className="flex flex-col gap-6">
{}
<div
className="bg-gradient-to-br from-primary-900 to-primary-800 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden group cursor-pointer border border-primary-700"
onClick={() => onChangeTab('å‰ç«¯é¢è¯•é¢˜åº“')}
>
<div className="absolute top-0 right-0 w-32 h-32 bg-accent-gold/20 rounded-full blur-2xl -translate-y-1/2 translate-x-1/3 group-hover:bg-accent-gold/30 transition-colors duration-500"></div>
<div className="relative z-10">
<div className="flex items-center justify-between mb-4">
<span className="bg-white/10 px-2 py-1 rounded text-xs font-medium backdrop-blur-sm border border-white/10 text-accent-gold">æ¯æ—¥ä¸€é¢˜</span>
<span className="text-xs text-primary-200 font-mono">2025.01.20</span>
</div>
<h3 className="text-xl font-bold mb-3 leading-snug group-hover:text-accent-gold transition-colors">å®ç°ä¸€ä¸ªå¹¶å‘é™åˆ¶çš„å¼‚æ­¥è°ƒåº¦å™¨</h3>
<p className="text-primary-200 text-sm mb-6 line-clamp-2 font-light">è¦æ±‚ï¼šä¿è¯åŒæ—¶è¿è¡Œçš„ä»»åŠ¡æœ€å¤šä¸º N ä¸ªï¼Œå®Œå–„ Scheduler ç±»...</p>
<button className="w-full bg-accent-gold text-primary-900 py-2.5 rounded-lg font-bold text-sm hover:bg-[#eac14d] transition-colors shadow-md">
ç«‹å³æŒ‘æˆ˜
</button>
</div>
</div>
{}
<div className="bg-white rounded-2xl shadow-sm border border-primary-100 p-5 flex-1">
<div className="flex items-center justify-between mb-4">
<h3 className="text-lg font-bold text-primary-900 flex items-center gap-2">
<span className="text-xl">ğŸ†</span> ç§¯åˆ†æ¦œ
</h3>
<span className="text-xs text-primary-400">æœ¬å‘¨</span>
</div>
<div className="space-y-4">
{[
{ name: "Alex", score: 2840, color: "bg-red-500" },
{ name: "Sarah", score: 2720, color: "bg-orange-500" },
{ name: "Mike", score: 2650, color: "bg-yellow-500" },
{ name: "Emily", score: 2580, color: "bg-green-500" },
{ name: "David", score: 2430, color: "bg-blue-500" },
].map((user, idx) => (
<div key={idx} className="flex items-center gap-3 group cursor-default">
<div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${
idx === 0 ? 'bg-yellow-100 text-yellow-700' :
idx === 1 ? 'bg-gray-100 text-gray-600' :
idx === 2 ? 'bg-orange-100 text-orange-700' :
'text-primary-300'
}`}>
{idx + 1}
</div>
<div className={`w-8 h-8 rounded-full ${user.color} flex items-center justify-center text-white text-xs font-bold shadow-sm ring-2 ring-white`}>
{user.name[0]}
</div>
<div className="flex-1 min-w-0">
<div className="text-sm font-medium text-primary-800 truncate group-hover:text-primary-900">{user.name}</div>
</div>
<div className="text-sm font-bold text-accent-copper font-mono">{user.score}</div>
</div>
))}
</div>
</div>
</div>
</div>
</div>
</div>
);
}
// File: apps\web\src\components\LoginModal.tsx
import React, { useState } from 'react';
import { signIn, signUp, authClient } from '@/lib/auth-client';
import { Loader2, Check, X, Mail, Lock, User, Github, ArrowRight } from 'lucide-react';
interface LoginModalProps {
isOpen: boolean;
onClose: () => void;
}
export default function LoginModal({ isOpen, onClose }: LoginModalProps) {
const [isLogin, setIsLogin] = useState(true);
const [loadingType, setLoadingType] = useState<'email' | 'github' | null>(null);
const loading = loadingType !== null;
const [email, setEmail] = useState('');
const [password, setPassword] = useState('');
const [name, setName] = useState('');
const [otp, setOtp] = useState('');
const [otpSent, setOtpSent] = useState(false);
const [countdown, setCountdown] = useState(0);
const [emailSent, setEmailSent] = useState(false);
const [sendingOtp, setSendingOtp] = useState(false);
const [otpSuccess, setOtpSuccess] = useState(false);
const handleSendOtp = async () => {
if (!email) {
alert("è¯·å…ˆè¾“å…¥é‚®ç®±");
return;
}
if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
alert("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€");
return;
}
setSendingOtp(true);
try {
let baseUrl = process.env.NEXT_PUBLIC_BETTER_AUTH_URL || 'http:
if (baseUrl.endsWith('/')) {
baseUrl = baseUrl.slice(0, -1);
}
const res = await fetch(`${baseUrl}/send-otp`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ email })
});
const data = await res.json();
if (!res.ok) {
throw new Error(data.error || "å‘é€éªŒè¯ç å¤±è´¥");
}
setOtpSent(true);
setOtpSuccess(true);
setCountdown(60);
setTimeout(() => {
setOtpSuccess(false);
}, 2000);
const timer = setInterval(() => {
setCountdown((prev) => {
if (prev <= 1) {
clearInterval(timer);
return 0;
}
return prev - 1;
});
}, 1000);
} catch (error: any) {
console.error("Send OTP error:", error);
alert(error.message);
} finally {
setSendingOtp(false);
}
};
const handleSubmit = async (e: React.FormEvent) => {
e.preventDefault();
setLoadingType('email');
console.log("ğŸš€ Starting registration submission...");
console.log("   URL:", process.env.NEXT_PUBLIC_BETTER_AUTH_URL);
try {
if (isLogin) {
await signIn.email({
email,
password,
callbackURL: '/',
}, {
onSuccess: () => {
console.log("âœ… Login successful");
onClose();
},
onError: (ctx) => {
console.error("âŒ Login failed:", ctx);
alert(`ç™»å½•å¤±è´¥: ${ctx.error.message}`);
}
});
} else {
if (!otp) {
alert("è¯·è¾“å…¥éªŒè¯ç ");
setLoadingType(null);
return;
}
console.log("ğŸš€ Calling signUp.email...");
await signUp.email({
email,
password,
name,
otp,
callbackURL: '/',
} as any, {
onSuccess: async (ctx) => {
console.log("âœ… SignUp successful!", ctx);
onClose();
alert("æ³¨å†ŒæˆåŠŸï¼");
},
onError: (ctx) => {
console.error("âŒ SignUp failed:", ctx);
alert(`æ³¨å†Œå¤±è´¥: ${ctx.error.message}`);
}
});
}
} catch (error: any) {
console.error("âŒ Unexpected error in handleSubmit:", error);
alert(`å‘ç”Ÿæ„å¤–é”™è¯¯: ${error.message || error}`);
} finally {
setLoadingType(null);
}
};
const handleSocialLogin = async (provider: 'github') => {
setLoadingType(provider);
try {
await signIn.social({
provider,
callbackURL: typeof window !== 'undefined' ? window.location.origin : '/'
});
} catch (error) {
console.error(error);
setLoadingType(null);
}
};
if (!isOpen) return null;
return (
<div className="fixed inset-0 z-50 flex items-center justify-center p-4">
{}
<div
className="absolute inset-0 bg-primary-900/60 backdrop-blur-md transition-opacity duration-500"
onClick={onClose}
/>
{}
<div className="relative bg-white/95 backdrop-blur-2xl rounded-[28px] shadow-2xl w-full max-w-[440px] p-8 border border-white/50 overflow-hidden animate-modal-in transform transition-all ring-1 ring-black/5">
{}
<div className="absolute top-0 right-0 -mt-16 -mr-16 w-48 h-48 bg-accent-copper/10 rounded-full blur-3xl pointer-events-none mix-blend-multiply" />
<div className="absolute bottom-0 left-0 -mb-16 -ml-16 w-48 h-48 bg-primary-500/10 rounded-full blur-3xl pointer-events-none mix-blend-multiply" />
{}
<button
onClick={onClose}
className="absolute top-5 right-5 p-2 text-primary-400 hover:text-primary-800 hover:bg-primary-50 rounded-full transition-all duration-300 group z-10"
>
<X className="w-5 h-5 transition-transform duration-300 group-hover:rotate-90" />
</button>
<div className="flex flex-col items-center mb-8 mt-2 relative z-10">
<div className="w-14 h-14 bg-gradient-to-br from-white to-primary-50 rounded-2xl flex items-center justify-center mb-5 shadow-[0_4px_20px_-4px_rgba(0,0,0,0.1)] border border-white/60 text-primary-600 transform transition-transform duration-500 hover:scale-110 hover:rotate-3">
{isLogin ? <User className="w-7 h-7" /> : <Mail className="w-7 h-7" />}
</div>
<h2 className="text-2xl font-bold text-primary-900 tracking-tight">
{isLogin ? 'æ¬¢è¿å›æ¥' : (emailSent ? 'éªŒè¯é‚®ä»¶å·²å‘é€' : 'åŠ å…¥ç¤¾åŒº')}
</h2>
<p className="text-primary-500 text-sm mt-2 font-medium text-center max-w-[280px]">
{isLogin ? 'ç™»å½•ä»¥ç»§ç»­æ‚¨çš„å­¦ä¹ ä¹‹æ—…' : (emailSent ? `è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®± ${email} å¹¶ç‚¹å‡»é“¾æ¥æ¿€æ´»è´¦æˆ·` : 'åˆ›å»ºä¸€ä¸ªæ–°è´¦æˆ·å¼€å§‹å­¦ä¹ ')}
</p>
</div>
<form className="space-y-4 relative z-10" onSubmit={handleSubmit}>
{!emailSent ? (
<>
{!isLogin && (
<div className="relative group">
<div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-primary-400 group-focus-within:text-accent-copper transition-colors duration-300">
<User className="w-5 h-5" />
</div>
<input
type="text"
placeholder="ç”¨æˆ·å"
value={name}
disabled={loading}
onChange={(e) => setName(e.target.value)}
className="w-full pl-11 pr-4 py-3.5 bg-primary-50/50 border border-primary-100 rounded-xl outline-none text-primary-900 placeholder-primary-400 transition-all duration-300 focus:border-accent-copper/50 focus:bg-white focus:ring-4 focus:ring-accent-copper/10 disabled:opacity-60 disabled:cursor-not-allowed font-medium"
/>
</div>
)}
<div className="relative group">
<div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-primary-400 group-focus-within:text-accent-copper transition-colors duration-300">
<Mail className="w-5 h-5" />
</div>
<input
type="email"
placeholder="é‚®ç®±åœ°å€"
value={email}
disabled={loading}
onChange={(e) => setEmail(e.target.value)}
className="w-full pl-11 pr-4 py-3.5 bg-primary-50/50 border border-primary-100 rounded-xl outline-none text-primary-900 placeholder-primary-400 transition-all duration-300 focus:border-accent-copper/50 focus:bg-white focus:ring-4 focus:ring-accent-copper/10 disabled:opacity-60 disabled:cursor-not-allowed font-medium"
/>
</div>
{!isLogin && (
<div className="flex gap-3">
<div className="relative group flex-1">
<div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-primary-400 group-focus-within:text-accent-copper transition-colors duration-300">
<Lock className="w-5 h-5" />
</div>
<input
type="text"
placeholder="éªŒè¯ç "
value={otp}
disabled={loading}
onChange={(e) => setOtp(e.target.value)}
className="w-full pl-11 pr-4 py-3.5 bg-primary-50/50 border border-primary-100 rounded-xl outline-none text-primary-900 placeholder-primary-400 transition-all duration-300 focus:border-accent-copper/50 focus:bg-white focus:ring-4 focus:ring-accent-copper/10 disabled:opacity-60 disabled:cursor-not-allowed font-medium text-center tracking-widest"
maxLength={6}
/>
</div>
<button
type="button"
onClick={handleSendOtp}
disabled={loading || sendingOtp || countdown > 0}
className={`px-4 py-2 font-semibold rounded-xl transition-all duration-300 disabled:opacity-70 disabled:cursor-not-allowed whitespace-nowrap min-w-[110px] flex items-center justify-center text-sm shadow-sm
${otpSuccess
? 'bg-green-50 text-green-600 border border-green-200'
: 'bg-white text-primary-700 border border-primary-200 hover:bg-primary-50 hover:border-primary-300 hover:shadow-md'
}
`}
>
{sendingOtp ? (
<Loader2 className="w-4 h-4 animate-spin" />
) : otpSuccess ? (
<div className="flex items-center gap-1.5 animate-in zoom-in duration-300">
<Check className="w-4 h-4" />
<span>å·²å‘é€</span>
</div>
) : countdown > 0 ? (
<span className="font-mono">{countdown}s</span>
) : (
'è·å–éªŒè¯ç '
)}
</button>
</div>
)}
<div className="space-y-2">
<div className="relative group">
<div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-primary-400 group-focus-within:text-accent-copper transition-colors duration-300">
<Lock className="w-5 h-5" />
</div>
<input
type="password"
placeholder="å¯†ç "
value={password}
disabled={loading}
onChange={(e) => setPassword(e.target.value)}
className="w-full pl-11 pr-4 py-3.5 bg-primary-50/50 border border-primary-100 rounded-xl outline-none text-primary-900 placeholder-primary-400 transition-all duration-300 focus:border-accent-copper/50 focus:bg-white focus:ring-4 focus:ring-accent-copper/10 disabled:opacity-60 disabled:cursor-not-allowed font-medium"
/>
</div>
{isLogin && (
<div className="flex justify-end px-1">
<a href="#" className="text-xs text-primary-400 hover:text-accent-copper font-medium transition-colors duration-200">å¿˜è®°å¯†ç ï¼Ÿ</a>
</div>
)}
</div>
<button
type="submit"
disabled={loading}
className="w-full py-3.5 mt-6 bg-gradient-to-r from-primary-900 via-primary-800 to-primary-900 bg-[length:200%_100%] hover:bg-[100%_0] text-white font-bold rounded-xl transition-all duration-500 shadow-lg shadow-primary-900/20 hover:shadow-xl hover:shadow-primary-900/30 active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed flex justify-center items-center gap-2 group"
>
{loadingType === 'email' && (
<Loader2 className="w-5 h-5 animate-spin text-white/80" />
)}
<span>
{loadingType === 'email'
? (isLogin ? 'æ­£åœ¨ç™»å½•...' : 'æ­£åœ¨æ³¨å†Œ...')
: (isLogin ? 'ç«‹å³ç™»å½•' : 'åˆ›å»ºè´¦æˆ·')
}
</span>
{!loadingType && <ArrowRight className="w-4 h-4 transition-transform duration-300 group-hover:translate-x-1" />}
</button>
</>
) : (
<div className="space-y-8 py-8 animate-fade-in flex flex-col items-center">
<div className="relative">
<div className="absolute inset-0 bg-green-100 rounded-full animate-ping opacity-20 duration-1000"></div>
<div className="w-20 h-20 bg-gradient-to-br from-green-100 to-green-50 text-green-600 rounded-full flex items-center justify-center shadow-inner border border-green-100 relative z-10">
<Mail className="w-10 h-10" />
</div>
</div>
<div className="text-center space-y-3">
<h3 className="text-xl font-bold text-primary-900">è¯·æŸ¥æ”¶éªŒè¯é‚®ä»¶</h3>
<p className="text-primary-500 text-sm max-w-[280px] leading-relaxed">
æˆ‘ä»¬å·²å‘ <span className="font-semibold text-primary-900 bg-primary-50 px-2 py-0.5 rounded">{email}</span> å‘é€äº†ä¸€å°ç¡®è®¤é‚®ä»¶ã€‚<br/>è¯·ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥å®Œæˆæ³¨å†Œã€‚
</p>
</div>
<button
type="button"
onClick={onClose}
className="px-10 py-3 bg-primary-50 text-primary-900 font-bold rounded-xl hover:bg-primary-100 transition-colors duration-200"
>
æˆ‘çŸ¥é“äº†
</button>
</div>
)}
</form>
<div className="mt-8 pt-6 border-t border-primary-50 flex flex-col items-center gap-5 relative z-10">
<p className="text-sm text-primary-500 font-medium">
{isLogin ? 'è¿˜æ²¡æœ‰è´¦å·? ' : 'å·²æœ‰è´¦å·? '}
<button
onClick={() => {
setIsLogin(!isLogin);
}}
className="text-accent-copper font-bold hover:underline focus:outline-none hover:text-accent-copper/80 transition-colors ml-1"
>
{isLogin ? 'ç«‹å³æ³¨å†Œ' : 'ç«‹å³ç™»å½•'}
</button>
</p>
<div className="flex items-center gap-4 w-full">
<div className="h-px bg-gradient-to-r from-transparent via-primary-100 to-transparent flex-1"></div>
<span className="text-xs text-primary-300 font-medium uppercase tracking-wider">OR</span>
<div className="h-px bg-gradient-to-r from-transparent via-primary-100 to-transparent flex-1"></div>
</div>
<button
type="button"
disabled={loading}
onClick={() => handleSocialLogin('github')}
className="w-full py-3 rounded-xl border border-primary-200 bg-white text-primary-700 hover:bg-gray-50 hover:border-primary-300 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 font-semibold group shadow-sm hover:shadow-md"
>
{loadingType === 'github' ? (
<Loader2 className="w-5 h-5 animate-spin" />
) : (
<>
<Github className="w-5 h-5 text-primary-900 transition-transform duration-300 group-hover:scale-110" />
<span>ä½¿ç”¨ GitHub ç»§ç»­</span>
</>
)}
</button>
</div>
</div>
</div>
);
}
// File: apps\web\src\components\MainPage.tsx
"use client";
import React, { useState, useRef, useEffect, useMemo } from 'react';
import { useRouter } from 'next/navigation';
import CodingCommunity, { QuestionItem, Category } from '@/components/CodingCommunity';
import { api } from '@/lib/request';
import StudentCamp from '@/components/StudentCamp';
import Home from '@/components/Home';
import LoginModal from '@/components/LoginModal';
import { UserProfileModal } from '@/components/UserProfileModal';
import { UserAvatar } from '@/components/UserAvatar';
import { useSession, signOut } from '@/lib/auth-client';
interface MainPageProps {
initialTab?: string;
initialQuestionId?: string;
serverGreetingConfig?: Record<string, string>;
}
export default function MainPage({ initialTab = 'é¢è¯•é¢˜åº“', initialQuestionId, serverGreetingConfig }: MainPageProps) {
const router = useRouter();
const [activeTab, setActiveTab] = useState(initialTab);
const [visitedTabs, setVisitedTabs] = useState<Set<string>>(new Set([initialTab]));
useEffect(() => {
setActiveTab(initialTab);
setVisitedTabs(prev => new Set(prev).add(initialTab));
}, [initialTab]);
const [currentQuestionId, setCurrentQuestionId] = useState(initialQuestionId);
const [communityKey, setCommunityKey] = useState(0);
const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);
const [isUserMenuOpen, setIsUserMenuOpen] = useState(false);
const [isLoggingOut, setIsLoggingOut] = useState(false);
const [currentTime, setCurrentTime] = useState<Date | null>(null);
const [searchQuery, setSearchQuery] = useState('');
const { data: session } = useSession();
const [questions, setQuestions] = useState<QuestionItem[]>([]);
const [categories, setCategories] = useState<Category[]>([]);
useEffect(() => {
const fetchData = async () => {
try {
const [questionsData, categoriesData] = await Promise.all([
api.get<QuestionItem[]>('/questions'),
api.get<Category[]>('/questions/categories')
]);
setQuestions(questionsData);
setCategories(categoriesData);
} catch (error) {
console.error('Failed to fetch data:', error);
}
};
fetchData();
}, []);
const filteredSearchResults = useMemo(() => {
if (!searchQuery) return [];
return questions.filter(q => q.title.toLowerCase().includes(searchQuery.toLowerCase()));
}, [questions, searchQuery]);
const userMenuRef = useRef<HTMLDivElement>(null);
const searchContainerRef = useRef<HTMLDivElement>(null);
const [searchPlaceholder, setSearchPlaceholder] = useState('');
const [isSearchIconAnimating, setIsSearchIconAnimating] = useState(false);
const [isSearchFocused, setIsSearchFocused] = useState(false);
useEffect(() => {
const phrases = ["æœç´¢é¢è¯•é¢˜...", "æŸ¥æ‰¾çŸ¥è¯†ç‚¹...", "React", "Vue", "Next.js", "ç®—æ³•é¢˜"];
let currentPhraseIndex = 0;
let currentCharIndex = 0;
let isDeleting = false;
let typingSpeed = 100;
const type = () => {
const currentPhrase = phrases[currentPhraseIndex];
if (isDeleting) {
setSearchPlaceholder(currentPhrase.substring(0, currentCharIndex - 1));
currentCharIndex--;
typingSpeed = 50;
} else {
setSearchPlaceholder(currentPhrase.substring(0, currentCharIndex + 1));
currentCharIndex++;
typingSpeed = 150;
}
if (!isDeleting && currentCharIndex === currentPhrase.length) {
isDeleting = true;
typingSpeed = 2000;
} else if (isDeleting && currentCharIndex === 0) {
isDeleting = false;
currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
typingSpeed = 500;
}
};
const timer = setTimeout(type, typingSpeed);
const loop = () => {
type();
setTimeout(loop, typingSpeed);
}
let timeoutId: NodeJS.Timeout;
const runTyping = () => {
const currentPhrase = phrases[currentPhraseIndex];
if (isDeleting) {
setSearchPlaceholder(currentPhrase.substring(0, currentCharIndex));
currentCharIndex--;
typingSpeed = 50;
} else {
setSearchPlaceholder(currentPhrase.substring(0, currentCharIndex));
currentCharIndex++;
typingSpeed = 150;
}
let nextDelay = typingSpeed;
if (!isDeleting && currentCharIndex === currentPhrase.length + 1) {
isDeleting = true;
nextDelay = 2000;
} else if (isDeleting && currentCharIndex === -1) {
isDeleting = false;
currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
currentCharIndex = 0;
nextDelay = 500;
}
timeoutId = setTimeout(runTyping, nextDelay);
};
runTyping();
return () => clearTimeout(timeoutId);
}, []);
useEffect(() => {
const interval = setInterval(() => {
setIsSearchIconAnimating(true);
setTimeout(() => setIsSearchIconAnimating(false), 1000);
}, 10000);
return () => clearInterval(interval);
}, []);
useEffect(() => {
const handlePopState = () => {
const path = window.location.pathname;
if (path === '/camp') {
setActiveTab('åŒå­¦è¥æ´»åŠ¨');
setVisitedTabs(prev => new Set(prev).add('åŒå­¦è¥æ´»åŠ¨'));
} else if (path === '/' || path.startsWith('/questions') || path.startsWith('/question/')) {
setActiveTab('é¢è¯•é¢˜åº“');
setVisitedTabs(prev => new Set(prev).add('é¢è¯•é¢˜åº“'));
}
};
window.addEventListener('popstate', handlePopState);
return () => window.removeEventListener('popstate', handlePopState);
}, []);
useEffect(() => {
setCurrentQuestionId(initialQuestionId);
}, [initialQuestionId]);
const [greetingConfig, setGreetingConfig] = useState<Record<string, string>>(serverGreetingConfig || {});
useEffect(() => {
if (serverGreetingConfig && Object.keys(serverGreetingConfig).length > 0) {
}
const fetchConfig = async () => {
try {
const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/system/config`);
if (res.ok) {
const data = await res.json();
const configMap = data.reduce((acc: any, item: any) => {
acc[item.key] = item.value;
return acc;
}, {});
setGreetingConfig(configMap);
}
} catch (e) {
console.error("Failed to fetch system config", e);
}
};
fetchConfig();
}, []);
useEffect(() => {
setCurrentTime(new Date());
const timer = setInterval(() => {
setCurrentTime(new Date());
}, 60000);
return () => clearInterval(timer);
}, []);
const handleTabChange = (tab: string, url?: string) => {
setActiveTab(tab);
setVisitedTabs(prev => {
const newSet = new Set(prev);
newSet.add(tab);
return newSet;
});
if (url) {
window.history.pushState({}, '', url);
}
};
const getGreeting = (date: Date) => {
const hour = date.getHours();
let text = '';
if (hour >= 0 && hour < 7) text = greetingConfig['greeting_0_7'] || 'å¤œæ·±éœ²é‡ï¼Œæ„¿ä½ å¥½æ¢¦ç›¸ä¼´';
else if (hour >= 7 && hour < 9) text = greetingConfig['greeting_7_9'] || 'æœé˜³åˆå‡ï¼Œä»Šå¤©çš„ä½ ä¹Ÿå¾ˆæ£’';
else if (hour >= 9 && hour < 12) text = greetingConfig['greeting_9_12'] || 'é˜³å…‰æ­£å¥½ï¼Œç”¨ä»£ç ç¼–ç»‡æœªæ¥';
else if (hour >= 12 && hour < 14) text = greetingConfig['greeting_12_14'] || 'èŒ¶ä½™é¥­åï¼Œç»™è‡ªå·±ä¸€æ®µæ”¾ç©ºæ—¶å…‰';
else if (hour >= 14 && hour < 18) text = greetingConfig['greeting_14_18'] || 'åˆåé™è°§ï¼Œçµæ„Ÿåœ¨æŒ‡å°–æµæ·Œ';
else text = greetingConfig['greeting_18_24'] || 'å¸ä¸‹ç–²æƒ«ï¼Œäº«å—å±äºä½ çš„å®é™å¤œæ™š';
return { text };
};
useEffect(() => {
function handleClickOutside(event: MouseEvent) {
if (userMenuRef.current && !userMenuRef.current.contains(event.target as Node)) {
setIsUserMenuOpen(false);
}
}
document.addEventListener("mousedown", handleClickOutside);
return () => {
document.removeEventListener("mousedown", handleClickOutside);
};
}, []);
useEffect(() => {
function handleClickOutsideSearch(event: MouseEvent) {
if (searchContainerRef.current && !searchContainerRef.current.contains(event.target as Node)) {
setIsSearchFocused(false);
}
}
document.addEventListener("mousedown", handleClickOutsideSearch);
return () => {
document.removeEventListener("mousedown", handleClickOutsideSearch);
};
}, []);
const handleAvatarClick = () => {
if (session) {
setIsUserMenuOpen(!isUserMenuOpen);
} else {
setIsLoginModalOpen(true);
}
};
const handleLogout = async () => {
setIsLoggingOut(true);
try {
await signOut();
} finally {
setIsUserMenuOpen(false);
setIsLoggingOut(false);
}
};
const navItems = [
{ name: 'é¢è¯•é¢˜åº“' },
{ name: 'åŒå­¦è¥æ´»åŠ¨', hot: true }
];
const showNavSearch = activeTab !== 'é¢è¯•é¢˜åº“' || (!!currentQuestionId && currentQuestionId !== '');
return (
<div className="flex flex-col h-screen bg-neutral-white overflow-hidden font-sans text-primary-900 selection:bg-accent-gold/20">
{}
<nav className="bg-primary-900 shadow-subtle py-[0.8rem] flex-shrink-0 border-b border-primary-800 z-50 relative">
<div className="max-w-full m-0 px-10 flex items-center justify-between">
<div className="flex items-center min-w-[100px] mr-10">
<div
className="flex items-center gap-3 cursor-pointer group"
onClick={() => router.push('/')}
>
<div className="w-9 h-9 rounded-xl bg-gradient-to-br from-accent-gold via-[#eac14d] to-[#b8860b] flex items-center justify-center shadow-lg shadow-black/20 border border-white/10 transition-transform duration-300 group-hover:scale-105 group-hover:rotate-3">
<svg xmlns="http:
<path d="M16 18l6-6-6-6" />
<path d="M8 6l-6 6 6 6" />
</svg>
</div>
<div className="flex flex-col justify-center -space-y-1">
<span className="text-[13px] font-bold text-accent-gold tracking-wide ml-[1px] group-hover:text-white transition-colors duration-300">
å¤§å‰ç«¯
</span>
<span className="text-[20px] font-black text-neutral-white tracking-wider group-hover:text-accent-gold transition-colors duration-300">
åŒå­¦è¥
</span>
</div>
</div>
</div>
<ul className="flex justify-start list-none gap-[15px] m-0 p-0 mr-4">
{navItems.map((item) => (
<li key={item.name} className="relative">
<a
href="#"
className={`no-underline text-primary-100/80 text-[15px] font-medium transition-all duration-300 px-5 py-[8px] rounded-md hover:text-neutral-white hover:bg-primary-800 ${
activeTab === item.name ? '!text-neutral-white !bg-primary-800 !font-semibold shadow-inner ring-1 ring-primary-700' : ''
}`}
onClick={(e) => {
e.preventDefault();
if (item.name === 'é¢è¯•é¢˜åº“') {
if (activeTab === 'é¢è¯•é¢˜åº“') {
setCommunityKey(prev => prev + 1);
setCurrentQuestionId(undefined);
handleTabChange('é¢è¯•é¢˜åº“', '/');
} else {
const targetUrl = currentQuestionId ? `/questions/${currentQuestionId}` : '/';
handleTabChange('é¢è¯•é¢˜åº“', targetUrl);
}
} else if (item.name === 'åŒå­¦è¥æ´»åŠ¨') {
handleTabChange('åŒå­¦è¥æ´»åŠ¨', '/camp');
} else if (item.name === 'é¦–é¡µ') {
router.push('/');
}
}}
>
{item.name}
</a>
{item.hot && (
<span className="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full animate-pulse">
HOT
</span>
)}
</li>
))}
</ul>
{}
<div className={`flex-1 max-w-md mx-auto px-4 hidden md:block transition-all duration-300 ${showNavSearch ? 'opacity-100 visible translate-y-0' : 'opacity-0 invisible -translate-y-2'}`}>
<div className="relative group" ref={searchContainerRef}>
<div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none z-10">
<svg
className={`h-5 w-5 text-primary-400 group-focus-within:text-accent-gold transition-all duration-300 ${isSearchIconAnimating ? 'scale-125 text-accent-gold' : ''}`}
xmlns="http:
fill="none"
viewBox="0 0 24 24"
stroke="currentColor"
strokeWidth={2}
>
<path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
</svg>
</div>
<input
type="text"
className="block w-full pl-10 pr-10 py-2 border border-primary-700 rounded-xl leading-5 bg-primary-800/50 text-white font-medium tracking-wide placeholder-primary-300 focus:outline-none focus:bg-primary-800 focus:ring-2 focus:ring-accent-gold/30 focus:border-accent-gold/50 sm:text-sm transition-all duration-300 shadow-inner hover:bg-primary-800/80 hover:border-primary-600 backdrop-blur-sm"
placeholder={searchPlaceholder}
value={searchQuery}
onChange={(e) => {
setSearchQuery(e.target.value);
setIsSearchFocused(true);
}}
onFocus={() => setIsSearchFocused(true)}
/>
{searchQuery && isSearchFocused && (
<>
<div
className="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer"
onClick={() => {
setSearchQuery('');
setIsSearchFocused(true);
}}
>
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
</svg>
</div>
{}
<div className="absolute top-full left-0 right-0 mt-2 bg-neutral-white rounded-xl shadow-xl border border-primary-100 overflow-hidden z-50 animate-in fade-in zoom-in-95 duration-200 py-1">
<div className="max-h-96 overflow-y-auto [&::-webkit-scrollbar]:w-1.5 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-primary-200 [&::-webkit-scrollbar-thumb]:rounded-full hover:[&::-webkit-scrollbar-thumb]:bg-primary-300">
{filteredSearchResults.length > 0 ? (
<ul className="">
{filteredSearchResults.map(q => (
<li
key={q.id}
className="px-4 py-3 hover:bg-primary-50 cursor-pointer border-b border-primary-50 last:border-none transition-colors group/item"
onClick={() => {
setSearchQuery('');
setIsSearchFocused(false);
setCurrentQuestionId(q.id);
handleTabChange('é¢è¯•é¢˜åº“', `/questions/${q.id}`);
}}
>
<div className="flex items-center justify-between">
<div className="text-sm font-medium text-primary-900 truncate group-hover/item:text-accent-copper transition-colors">{q.title}</div>
<span className="text-[10px] text-primary-400 bg-primary-50 px-1.5 py-0.5 rounded border border-primary-100 whitespace-nowrap ml-2">
{categories.find(c => c.id === q.categoryId)?.name || 'æœªåˆ†ç±»'}
</span>
</div>
</li>
))}
</ul>
) : (
<div className="p-8 text-center flex flex-col items-center justify-center text-primary-400">
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
</svg>
<span className="text-sm">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</span>
</div>
)}
</div>
</div>
</>
)}
</div>
</div>
{}
{currentTime && (
<div className="mr-6 hidden md:flex items-center justify-center h-full animate-fade-in select-none">
<div className="flex items-center gap-2 text-[14px] text-primary-100 font-bold leading-none tracking-wide">
<span>{getGreeting(currentTime).text}</span>
</div>
</div>
)}
<div className="flex items-center min-w-[100px] justify-end relative" ref={userMenuRef}>
<div
className="flex items-center gap-3 cursor-pointer group"
onClick={handleAvatarClick}
title={session ? `å·²ç™»å½•: ${session.user.name || session.user.email}` : "ç‚¹å‡»ç™»å½•"}
>
<UserAvatar
user={session?.user}
size="md"
className="group-hover:ring-2 ring-primary-200 transition-all"
/>
{session?.user && (
<span className="text-[14px] font-medium text-primary-100 group-hover:text-white transition-colors hidden md:block max-w-[120px] truncate">
{session.user.name || session.user.email?.split('@')[0] || 'User'}
</span>
)}
</div>
{}
{isUserMenuOpen && session && (
<div className="absolute top-full -right-4 mt-2 w-40 bg-white rounded-xl shadow-lg border border-primary-100 overflow-hidden z-50">
{}
<div className="p-4 border-b border-gray-100 bg-primary-50/50">
<div className="font-bold text-primary-900 truncate">
{session.user.name || 'User'}
</div>
<div className="text-xs text-primary-500 truncate mt-0.5">
{session.user.email}
</div>
</div>
{}
<div className="py-2">
<button
onClick={() => {
setIsUserMenuOpen(false);
setIsProfileModalOpen(true);
}}
className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3"
>
<svg xmlns="http:
<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
<circle cx="12" cy="7" r="4"></circle>
</svg>
ä¸ªäººä¿¡æ¯
</button>
<button className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3">
<svg xmlns="http:
<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
<line x1="16" y1="2" x2="16" y2="6"></line>
<line x1="8" y1="2" x2="8" y2="6"></line>
<line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
æ¨¡æ‹Ÿé¢„çº¦
</button>
<button className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3">
<svg xmlns="http:
<path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
<path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
</svg>
æˆ‘çš„è¯¾ç¨‹
</button>
<button
onClick={() => {
localStorage.setItem('noteIconVisible', 'true');
window.dispatchEvent(new Event('SHOW_NOTE_ICON'));
setIsUserMenuOpen(false);
setActiveTab('é¢è¯•é¢˜åº“');
}}
className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3"
>
<svg xmlns="http:
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
<line x1="16" y1="13" x2="8" y2="13"></line>
<line x1="16" y1="17" x2="8" y2="17"></line>
<polyline points="10 9 9 9 8 9"></polyline>
</svg>
æˆ‘çš„ç¬”è®°
</button>
<button
onClick={() => {
window.open('/favorites', '_blank');
setIsUserMenuOpen(false);
}}
className="w-full text-left px-4 py-2 text-sm text-primary-700 hover:bg-primary-50 hover:text-primary-900 transition-colors flex items-center gap-3"
>
<svg xmlns="http:
<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
</svg>
é¢˜ç›®æ”¶è—
</button>
</div>
{}
<div className="border-t border-gray-100 py-2">
<button
onClick={handleLogout}
disabled={isLoggingOut}
className="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed"
>
{isLoggingOut ? (
<svg className="animate-spin h-4 w-4 text-red-500" xmlns="http:
<circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
<path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
) : (
<svg xmlns="http:
<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
<polyline points="16 17 21 12 16 7"></polyline>
<line x1="21" y1="12" x2="9" y2="12"></line>
</svg>
)}
{isLoggingOut ? 'æ­£åœ¨é€€å‡º...' : 'é€€å‡ºç™»å½•'}
</button>
</div>
</div>
)}
</div>
</div>
</nav>
{}
<main className="flex-1 w-full m-0 p-0 overflow-hidden flex flex-col">
<div className={`h-full w-full ${activeTab === 'é¢è¯•é¢˜åº“' ? 'block' : 'hidden'}`}>
<CodingCommunity
key={communityKey}
onLoginRequest={() => setIsLoginModalOpen(true)}
viewMode="default"
initialQuestionId={currentQuestionId}
onQuestionSelect={(id) => setCurrentQuestionId(id || undefined)}
questions={questions}
categories={categories}
searchPlaceholder={searchPlaceholder}
/>
</div>
<div className={`h-full w-full ${activeTab === 'åŒå­¦è¥æ´»åŠ¨' ? 'block' : 'hidden'}`}>
{(visitedTabs.has('åŒå­¦è¥æ´»åŠ¨') || activeTab === 'åŒå­¦è¥æ´»åŠ¨') && (
<StudentCamp />
)}
</div>
{activeTab === 'é¦–é¡µ' && <Home onChangeTab={setActiveTab} />}
</main>
{}
<LoginModal
isOpen={isLoginModalOpen}
onClose={() => setIsLoginModalOpen(false)}
/>
{}
{session?.user && (
<UserProfileModal
isOpen={isProfileModalOpen}
onClose={() => setIsProfileModalOpen(false)}
user={{
id: session.user.id,
name: session.user.name || undefined,
image: session.user.image || undefined,
email: session.user.email
}}
onUpdate={() => {
}}
/>
)}
</div>
);
}
// File: apps\web\src\components\NotePadModal.tsx
import React, { useState, useEffect, useRef } from 'react';
import { api } from '@/lib/request';
interface Note {
id: string;
content: string;
updatedAt: string;
}
interface NotePadModalProps {
isOpen: boolean;
onClose: () => void;
}
export default function NotePadModal({ isOpen, onClose }: NotePadModalProps) {
const [notes, setNotes] = useState<Note[]>([]);
const [activeNoteId, setActiveNoteId] = useState<string | null>(null);
const [content, setContent] = useState('');
const [isLoading, setIsLoading] = useState(false);
const [isSaving, setIsSaving] = useState(false);
const [lastSaved, setLastSaved] = useState<Date | null>(null);
const saveTimeoutRef = useRef<NodeJS.Timeout | null>(null);
const [isSidebarOpen, setIsSidebarOpen] = useState(false);
const modalRef = useRef<HTMLDivElement>(null);
const dragStartRef = useRef<{ x: number; y: number; left: number; top: number } | null>(null);
const resizeStartRef = useRef<{ x: number; y: number; width: number; height: number } | null>(null);
useEffect(() => {
if (isOpen && modalRef.current) {
const initialWidth = 600;
const initialHeight = 400;
const margin = 24;
const initialX = typeof window !== 'undefined' ? (window.innerWidth - initialWidth - margin) : 100;
const initialY = typeof window !== 'undefined' ? (window.innerHeight - initialHeight - margin) : 100;
modalRef.current.style.left = `${Math.max(0, initialX)}px`;
modalRef.current.style.top = `${Math.max(0, initialY)}px`;
modalRef.current.style.width = `${initialWidth}px`;
modalRef.current.style.height = `${initialHeight}px`;
fetchNotes();
}
}, [isOpen]);
useEffect(() => {
const handleMouseMove = (e: MouseEvent) => {
if (dragStartRef.current && modalRef.current) {
const dx = e.clientX - dragStartRef.current.x;
const dy = e.clientY - dragStartRef.current.y;
modalRef.current.style.left = `${dragStartRef.current.left + dx}px`;
modalRef.current.style.top = `${dragStartRef.current.top + dy}px`;
return;
}
if (resizeStartRef.current && modalRef.current) {
const dx = e.clientX - resizeStartRef.current.x;
const dy = e.clientY - resizeStartRef.current.y;
const newWidth = Math.max(600, resizeStartRef.current.width + dx);
const newHeight = Math.max(400, resizeStartRef.current.height + dy);
modalRef.current.style.width = `${newWidth}px`;
modalRef.current.style.height = `${newHeight}px`;
}
};
const handleMouseUp = () => {
dragStartRef.current = null;
resizeStartRef.current = null;
document.body.style.cursor = '';
document.body.style.userSelect = '';
};
window.addEventListener('mousemove', handleMouseMove);
window.addEventListener('mouseup', handleMouseUp);
return () => {
window.removeEventListener('mousemove', handleMouseMove);
window.removeEventListener('mouseup', handleMouseUp);
};
}, []);
const handleMouseDown = (e: React.MouseEvent) => {
if ((e.target as HTMLElement).closest('button') || (e.target as HTMLElement).closest('input') || (e.target as HTMLElement).closest('textarea')) {
return;
}
if (modalRef.current) {
const rect = modalRef.current.getBoundingClientRect();
dragStartRef.current = {
x: e.clientX,
y: e.clientY,
left: rect.left,
top: rect.top
};
document.body.style.userSelect = 'none';
}
};
const handleResizeMouseDown = (e: React.MouseEvent) => {
e.stopPropagation();
if (modalRef.current) {
const rect = modalRef.current.getBoundingClientRect();
resizeStartRef.current = {
x: e.clientX,
y: e.clientY,
width: rect.width,
height: rect.height
};
document.body.style.cursor = 'nwse-resize';
document.body.style.userSelect = 'none';
}
};
const fetchNotes = async () => {
setIsLoading(true);
try {
const data = await api.get<Note[]>('/notes');
setNotes(data);
if (data.length > 0) {
if (!activeNoteId) {
setActiveNoteId(data[0].id);
setContent(data[0].content);
}
} else {
createNote();
}
} catch (error) {
console.error('Failed to fetch notes:', error);
} finally {
setIsLoading(false);
}
};
const createNote = async () => {
try {
const newNote = await api.post<Note>('/notes', { content: '' });
setNotes(prev => [newNote, ...prev]);
setActiveNoteId(newNote.id);
setContent('');
} catch (error) {
console.error('Failed to create note:', error);
}
};
const deleteNote = async (e: React.MouseEvent, id: string) => {
e.stopPropagation();
if (!window.confirm('ç¡®å®šè¦åˆ é™¤è¿™é¡µç¬”è®°å—ï¼Ÿ')) return;
try {
await api.delete(`/notes/${id}`);
setNotes(prev => prev.filter(n => n.id !== id));
if (activeNoteId === id) {
const remaining = notes.filter(n => n.id !== id);
if (remaining.length > 0) {
setActiveNoteId(remaining[0].id);
setContent(remaining[0].content);
} else {
setActiveNoteId(null);
setContent('');
createNote();
}
}
} catch (error) {
console.error('Failed to delete note:', error);
}
};
const handleContentChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
const newContent = e.target.value;
setContent(newContent);
};
const saveNote = async (id: string | null, text: string) => {
if (!id) return;
setIsSaving(true);
try {
await api.patch(`/notes/${id}`, { content: text });
setNotes(prev => prev.map(n => n.id === id ? { ...n, content: text, updatedAt: new Date().toISOString() } : n));
setIsSaving(false);
setLastSaved(new Date());
} catch (error) {
console.error('Failed to save note:', error);
setIsSaving(false);
}
};
const handleNoteSelect = (note: Note) => {
if (saveTimeoutRef.current && activeNoteId) {
clearTimeout(saveTimeoutRef.current);
saveNote(activeNoteId, content);
}
setActiveNoteId(note.id);
setContent(note.content);
};
if (!isOpen) return null;
return (
<div
ref={modalRef}
className="fixed z-[100] bg-[#fdfbf7] rounded-xl shadow-2xl flex overflow-hidden border border-[#e0e0e0] animate-in fade-in duration-200"
style={{
visibility: 'visible'
}}
>
{}
<div
className="absolute top-0 left-1/2 -translate-x-1/2 w-48 h-6 z-50 cursor-grab active:cursor-grabbing hover:bg-black/5 transition-colors rounded-b-lg flex justify-center items-center"
onMouseDown={handleMouseDown}
title="æŒ‰ä½æ‹–åŠ¨"
>
<div className="w-12 h-1 bg-gray-300 rounded-full opacity-50"></div>
</div>
{}
<button
onClick={onClose}
className="absolute top-2 right-2 z-20 p-1 rounded-full hover:bg-gray-200 text-gray-400 hover:text-gray-600 transition-colors"
>
<svg xmlns="http:
<line x1="18" y1="6" x2="6" y2="18"></line>
<line x1="6" y1="6" x2="18" y2="18"></line>
</svg>
</button>
{}
{isSidebarOpen && (
<div className="w-48 bg-[#f0f0f0] border-r border-[#e0e0e0] flex flex-col">
<div className="p-4 border-b border-[#e0e0e0] flex items-center justify-between bg-[#eaeaea]">
<h3 className="font-bold text-gray-700 text-sm">ç¬”è®°æœ¬</h3>
<button
onClick={createNote}
className="p-1.5 bg-white border border-gray-300 rounded hover:bg-gray-50 text-gray-600 transition-colors shadow-sm"
title="æ–°å»ºé¡µé¢"
>
<svg xmlns="http:
<line x1="12" y1="5" x2="12" y2="19"></line>
<line x1="5" y1="12" x2="19" y2="12"></line>
</svg>
</button>
</div>
<div className="flex-1 overflow-y-auto p-2 space-y-2">
{isLoading && notes.length === 0 ? (
<div className="text-center py-4 text-gray-400 text-sm">åŠ è½½ä¸­...</div>
) : (
notes.map(note => (
<div
key={note.id}
onClick={() => handleNoteSelect(note)}
className={`group p-3 rounded-lg cursor-pointer transition-all border ${
activeNoteId === note.id
? 'bg-white border-primary-200 shadow-sm'
: 'hover:bg-white border-transparent hover:border-gray-200'
}`}
>
<div className="flex items-start justify-between">
<div className="text-sm font-medium text-gray-700 line-clamp-1 mb-1">
{note.content.trim().split('\n')[0] || 'æ— æ ‡é¢˜ç¬”è®°'}
</div>
<button
onClick={(e) => deleteNote(e, note.id)}
className="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 transition-opacity p-0.5"
>
<svg xmlns="http:
<polyline points="3 6 5 6 21 6"></polyline>
<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
</svg>
</button>
</div>
<div className="text-xs text-gray-400">
{new Date(note.updatedAt).toLocaleDateString()} {new Date(note.updatedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
</div>
</div>
))
)}
</div>
</div>
)}
{}
<div className="flex-1 flex flex-col bg-[#fdfbf7] relative">
{}
<div className="h-12 border-b border-[#f0f0f0] flex items-center justify-between px-6 bg-white/50">
<div className="text-xs text-gray-400 flex items-center gap-2">
<button
onClick={() => setIsSidebarOpen(!isSidebarOpen)}
className={`p-1.5 border border-gray-200 rounded-md text-gray-500 hover:text-primary-600 hover:border-primary-200 transition-colors shadow-sm ${isSidebarOpen ? 'bg-primary-50 border-primary-200 text-primary-600' : 'bg-white'}`}
title={isSidebarOpen ? "éšè—ä¾§è¾¹æ " : "æ˜¾ç¤ºä¾§è¾¹æ "}
>
<svg xmlns="http:
<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
<line x1="9" y1="3" x2="9" y2="21"></line>
</svg>
</button>
<div className="h-4 w-px bg-gray-200 mx-1"></div>
<button
onClick={() => saveNote(activeNoteId, content)}
className="px-3 py-1 bg-white border border-gray-200 rounded-md text-gray-600 hover:text-primary-600 hover:border-primary-200 transition-colors shadow-sm flex items-center gap-1.5"
>
<svg xmlns="http:
<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
<polyline points="17 21 17 13 7 13 7 21"></polyline>
<polyline points="7 3 7 8 15 8"></polyline>
</svg>
ä¿å­˜
</button>
<div className="h-4 w-px bg-gray-200 mx-1"></div>
{isSaving ? (
<span className="flex items-center gap-1 text-primary-500">
<svg className="animate-spin w-3 h-3" viewBox="0 0 24 24" fill="none" xmlns="http:
<circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
<path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
ä¿å­˜ä¸­...
</span>
) : lastSaved ? (
<span>å·²ä¿å­˜ {lastSaved.toLocaleTimeString()}</span>
) : (
<span>å‡†å¤‡å°±ç»ª</span>
)}
</div>
<div className="text-xs text-gray-400 flex items-center gap-1 mr-8">
<svg xmlns="http:
<rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
<path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
</svg>
å†…å®¹å·²åŠ å¯†
</div>
</div>
{}
<div className="flex-1 overflow-hidden relative">
<textarea
spellCheck={false}
value={content}
onChange={handleContentChange}
placeholder="å¼€å§‹å†™ä½œ..."
className="w-full h-full px-8 py-0 resize-none outline-none bg-transparent text-gray-800 text-lg leading-[2rem] font-serif custom-scrollbar"
style={{
backgroundImage: 'linear-gradient(transparent 96%, #e5e5e5 96%)',
backgroundSize: '100% 2rem',
backgroundAttachment: 'local',
marginTop: '0.1rem'
}}
/>
</div>
</div>
{}
<div
className="absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize z-20 hover:bg-black/5"
onMouseDown={handleResizeMouseDown}
title="è°ƒæ•´å¤§å°"
>
<svg xmlns="http:
<polyline points="22 17 17 22"></polyline>
<polyline points="22 12 12 22"></polyline>
</svg>
</div>
</div>
);
}
// File: apps\web\src\components\StudentCamp.tsx
import React, { useState, useRef, useEffect } from 'react';
import {
Zap, Workflow, Rocket, Shield,
ArrowRight, Briefcase, FileText,
Target, Calendar, Share2, MessageCircle,
Flame, Gem, BookOpen, ArrowUp, BrainCircuit,
Database, Cpu, Code2, Layers, Bot, GraduationCap
} from 'lucide-react';
const StudentCamp = () => {
const [showQRCode, setShowQRCode] = useState(false);
const [qrError, setQrError] = useState(false);
const [activePhase, setActivePhase] = useState(0);
const [showScrollTop, setShowScrollTop] = useState(false);
const containerRef = useRef<HTMLDivElement>(null);
useEffect(() => {
const container = containerRef.current;
if (!container) return;
const handleScroll = () => {
setShowScrollTop(container.scrollTop > 600);
};
container.addEventListener('scroll', handleScroll);
return () => container.removeEventListener('scroll', handleScroll);
}, []);
const AI_SYLLABUS = [
{
phase: "Phase 1: å¤¯å®åŸºç¡€",
color: "from-blue-500 to-cyan-500",
items: [
{
title: "å‰ç½®çŸ¥è¯†ä½“ç³»",
desc: "Python/Git/Docker å¿…å¤‡å·¥ç¨‹åŒ–åŸºçŸ³",
icon: <Code2 className="w-6 h-6" />,
submodules: [
{ name: "Python è¿›é˜¶", content: "è£…é¥°å™¨ / ç”Ÿæˆå™¨ / ä¸Šä¸‹æ–‡ç®¡ç†å™¨ / Pydantic ç±»å‹æ ¡éªŒ" },
{ name: "å·¥ç¨‹åŒ–åŸºçŸ³", content: "Git Flow å·¥ä½œæµ / Docker å®¹å™¨ç¼–æ’ / Linux å¸¸ç”¨æŒ‡ä»¤" },
{ name: "æ•°æ®ç§‘å­¦æ ˆ", content: "NumPy å‘é‡åŒ–è¿ç®— / Pandas æ•°æ®æ¸…æ´— / Matplotlib å¯è§†åŒ–" }
]
},
{
title: "å¤§æ¨¡å‹åº”ç”¨åŸºç¡€",
desc: "Prompt Engineering ä¸ API æ ¸å¿ƒ",
icon: <MessageCircle className="w-6 h-6" />,
submodules: [
{ name: "Prompt Engineering", content: "COT æ€ç»´é“¾ / TOT æ€ç»´æ ‘ / Few-shot Learning" },
{ name: "API å®æˆ˜", content: "OpenAI æ¥å£è§„èŒƒ / Stream æµå¼å“åº” / Function Calling" },
{ name: "æ ¸å¿ƒæ¦‚å¿µ", content: "Token è®¡ç®—ä¸æˆæœ¬ / Embedding å‘é‡è¡¨å¾ / æ¸©åº¦ç³»æ•°è°ƒä¼˜" }
]
},
{
title: "å¤§æ¨¡å‹å¼€å‘æ¡†æ¶å®æˆ˜",
desc: "LangChain ä¸ Semantic Kernel æ·±åº¦åº”ç”¨",
icon: <Layers className="w-6 h-6" />,
submodules: [
{ name: "LangChain æ ¸å¿ƒ", content: "Chains é“¾å¼è°ƒç”¨ / LCEL è¡¨è¾¾å¼ / Memory è®°å¿†ç»„ä»¶" },
{ name: "LlamaIndex", content: "Data Loaders / Indexing ç­–ç•¥ / Query Engines" },
{ name: "Semantic Kernel", content: "Plugins æ’ä»¶ä½“ç³» / Planners è§„åˆ’å™¨ / Skills" }
]
}
]
},
{
phase: "Phase 2: æ ¸å¿ƒè¿›é˜¶",
color: "from-amber-500 to-orange-500",
items: [
{
title: "RAG å¼€å‘å®æˆ˜",
desc: "ä¼ä¸šçº§çŸ¥è¯†åº“ä¸æ£€ç´¢å¢å¼ºç”Ÿæˆ",
icon: <Database className="w-6 h-6" />,
submodules: [
{ name: "æ•°æ®å¤„ç†", content: "PDF/Markdown è§£æ / Recursive Character Splitter åˆ‡åˆ†" },
{ name: "æ£€ç´¢å¢å¼º", content: "å‘é‡æ•°æ®åº“ (Milvus/Pinecone) / æ··åˆæ£€ç´¢ (Hybrid Search)" },
{ name: "é«˜çº§ä¼˜åŒ–", content: "Rerank é‡æ’åº / Parent Document Retriever / Multi-query" }
]
},
{
title: "Agent å¼€å‘å®æˆ˜",
desc: "æ„å»ºè‡ªä¸»å†³ç­–çš„æ™ºèƒ½ä½“ç³»ç»Ÿ",
icon: <Bot className="w-6 h-6" />,
submodules: [
{ name: "æ¨ç†æ¨¡å¼", content: "ReAct æ¡†æ¶ / Plan-and-Solve / Self-Reflection" },
{ name: "å·¥å…·è°ƒç”¨", content: "OpenAPI Spec / Tool Use é”™è¯¯å¤„ç† / Human-in-the-loop" },
{ name: "å¤šæ™ºèƒ½ä½“", content: "AutoGen åä½œæ¨¡å¼ / CrewAI è§’è‰²ç¼–æ’ / çŠ¶æ€å…±äº«" }
]
},
{
title: "å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜",
desc: "æ‰“é€ å‚ç›´é¢†åŸŸçš„ä¸“å±æ¨¡å‹",
icon: <Cpu className="w-6 h-6" />,
submodules: [
{ name: "å¾®è°ƒæ–¹æ³•", content: "SFT æŒ‡ä»¤å¾®è°ƒ / LoRA ä½ç§©é€‚åº” / QLoRA é‡åŒ–å¾®è°ƒ" },
{ name: "æ•°æ®å·¥ç¨‹", content: "Self-Instruct æ•°æ®ç”Ÿæˆ / æ•°æ®æ¸…æ´—ä¸å»é‡ / æ ¼å¼è½¬æ¢" },
{ name: "è®­ç»ƒå®æˆ˜", content: "HuggingFace Transformers / PEFT åº“ / Loss æ›²çº¿åˆ†æ" }
]
}
]
},
{
phase: "Phase 3: æ·±åº¦ä¸è½åœ°",
color: "from-purple-500 to-pink-500",
items: [
{
title: "å¤§æ¨¡å‹å®æˆ˜å·¥å…·",
desc: "éƒ¨ç½²ã€ç›‘æ§ä¸è¯„ä¼°å…¨é“¾è·¯",
icon: <Workflow className="w-6 h-6" />,
submodules: [
{ name: "éƒ¨ç½²è¿ç»´", content: "Ollama æœ¬åœ°éƒ¨ç½² / vLLM æ¨ç†åŠ é€Ÿ / TGI æœåŠ¡åŒ–" },
{ name: "ç›‘æ§è¯„ä¼°", content: "LangSmith é“¾è·¯è¿½è¸ª / LangFuse æˆæœ¬ç›‘æ§ / RAGAS è¯„åˆ†" },
{ name: "å·¥ç¨‹æ•ˆèƒ½", content: "Prompt Management / Dataset Versioning / A/B Testing" }
]
},
{
title: "é¡¹ç›®ç»¼åˆå®æˆ˜",
desc: "çœŸå®åœºæ™¯ä¸‹çš„å®Œæ•´åº”ç”¨å¼€å‘",
icon: <Briefcase className="w-6 h-6" />,
submodules: [
{ name: "å‚ç›´é¢†åŸŸ RAG", content: "æ³•å¾‹/åŒ»ç–—æ–‡æ¡£é—®ç­” / å¼•ç”¨æºæº¯æº / æ„å›¾è¯†åˆ«" },
{ name: "Code Agent", content: "æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ“ä½œ / ä»£ç ç”Ÿæˆä¸æ‰§è¡Œ / è‡ªåŠ¨åŒ–æµ‹è¯•" },
{ name: "å¤šæ¨¡æ€åŠ©æ‰‹", content: "è¯­éŸ³è¯†åˆ« (Whisper) / å›¾åƒç†è§£ (GPT-4V) / å®æ—¶äº¤äº’" }
]
},
{
title: "è¿›é˜¶ï¼šAI ç®—æ³•åŸºç¡€",
desc: "çŸ¥å…¶ç„¶ï¼Œæ›´çŸ¥å…¶æ‰€ä»¥ç„¶",
icon: <BrainCircuit className="w-6 h-6" />,
submodules: [
{ name: "Transformer", content: "Self-Attention æœºåˆ¶ / Multi-head Attention / FFN" },
{ name: "æ¶æ„æ¼”è¿›", content: "BERT (Encoder) / GPT (Decoder) / T5 (Enc-Dec)" },
{ name: "åº•å±‚åŸç†", content: "Backpropagation / Positional Encoding / LayerNorm" }
]
}
]
}
];
const scrollToTop = () => {
containerRef.current?.scrollTo({ top: 0, behavior: 'smooth' });
};
return (
<div ref={containerRef} className="flex flex-col h-full bg-neutral-white overflow-y-auto relative scroll-smooth custom-scrollbar">
{}
<div className="relative bg-primary-900 text-white py-24 px-6 sm:px-12 overflow-hidden shrink-0 isolate">
{}
<div className="absolute inset-0 bg-[linear-gradient(to_right,#4f4f4f2e_1px,transparent_1px),linear-gradient(to_bottom,#4f4f4f2e_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)]"></div>
{}
<div className="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[400px] bg-primary-500/20 rounded-[100%] blur-[100px] -z-10"></div>
<div className="absolute bottom-0 right-0 w-[800px] h-[400px] bg-accent-gold/10 rounded-[100%] blur-[100px] -z-10"></div>
<div className="relative z-10 max-w-5xl mx-auto text-center">
<div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-sm font-medium text-accent-gold mb-8 animate-fade-in-up">
<span className="relative flex h-2 w-2">
<span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-gold opacity-75"></span>
<span className="relative inline-flex rounded-full h-2 w-2 bg-accent-copper"></span>
</span>
å‰ç«¯äººçš„æŠ€æœ¯é¿é£æ¸¯
</div>
<h1 className="text-5xl md:text-7xl font-black tracking-tight mb-8 leading-tight drop-shadow-2xl">
å¤§å‰ç«¯<span className="text-transparent bg-clip-text bg-gradient-to-r from-accent-gold via-accent-copper to-primary-400">åŒå­¦è¥</span>
</h1>
<p className="text-xl md:text-2xl text-primary-200 mb-12 max-w-3xl mx-auto font-light leading-relaxed">
ä¸ä»…ä»…æ˜¯ Codingã€‚è¿™é‡Œæ˜¯<span className="text-white font-medium">æ‹’ç»ç„¦è™‘</span>çš„å¼€æºç¤¾åŒºï¼Œ<br className="hidden md:block" />
ä¸ <span className="text-accent-gold">500+</span> ä¼™ä¼´ä¸€èµ·ï¼Œæ„å»ºä½ çš„æŠ€æœ¯æŠ¤åŸæ²³ã€‚
</p>
<div className="flex flex-col sm:flex-row gap-5 justify-center items-center mb-16">
<button
onClick={() => setShowQRCode(true)}
className="group relative px-8 py-4 bg-white text-primary-900 font-bold rounded-full shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(255,255,255,0.5)] transition-all transform hover:-translate-y-1 text-lg flex items-center gap-3 overflow-hidden"
>
<span className="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/50 to-transparent -translate-x-full group-hover:animate-shimmer"></span>
<svg xmlns="http:
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0z" />
</svg>
ç«‹å³åŠ å…¥äº¤æµç¾¤
</button>
<button className="px-8 py-4 bg-white/5 hover:bg-white/10 text-white font-medium rounded-full border border-white/10 hover:border-white/30 transition-all text-lg backdrop-blur-sm flex items-center gap-2 group">
æ¢ç´¢æƒç›Š
<svg className="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
</button>
</div>
<div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto">
{[
{ label: "åœ¨çº¿æ´»è·ƒä¼™ä¼´", val: "500+", icon: <Flame className="w-6 h-6 text-accent-copper" />, color: "text-accent-copper" },
{ label: "å¤§å‚å¯¼å¸ˆåé•‡", val: "Top 5", icon: <Gem className="w-6 h-6 text-accent-blue" />, color: "text-accent-blue" },
{ label: "æ²‰æ·€æŠ€æœ¯èµ„æº", val: "100GB+", icon: <BookOpen className="w-6 h-6 text-accent-sage" />, color: "text-accent-sage" }
].map((stat, i) => (
<div key={i} className="bg-white/5 backdrop-blur-md border border-white/5 rounded-2xl p-4 flex items-center justify-center gap-4 hover:bg-white/10 transition-colors cursor-default">
<div className="p-2 bg-white/5 rounded-lg border border-white/5 shadow-inner">
{stat.icon}
</div>
<div className="text-left">
<div className={`text-xl font-bold ${stat.color} font-mono`}>{stat.val}</div>
<div className="text-xs text-primary-300 font-medium tracking-wider uppercase">{stat.label}</div>
</div>
</div>
))}
</div>
</div>
</div>
<div className="max-w-7xl mx-auto px-6 py-12 w-full flex-1">
{}
<div className="mb-32">
<div className="text-center mb-16">
<span className="inline-block py-1 px-3 rounded-full bg-black/5 text-black font-bold text-xs tracking-widest uppercase mb-4">2025 Roadmap</span>
<h2 className="text-4xl md:text-6xl font-black text-primary-900 tracking-tight mb-6">
AI å…¨æ ˆå¼€å‘ <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">å®æˆ˜è·¯çº¿</span>
</h2>
<p className="text-xl text-primary-500 max-w-3xl mx-auto leading-relaxed">
ä» Prompt Engineering åˆ° Agent è½åœ°ï¼Œæˆ‘ä»¬ä¸è®²æ¦‚å¿µï¼Œåªè®²ä»£ç ã€‚
<br className="hidden md:block"/>
è¿™æ˜¯ä¸€æ¡é€šå¾€ <span className="font-bold text-primary-900">Next-Gen Developer</span> çš„å®Œæ•´è¿›åŒ–è·¯å¾„ã€‚
</p>
</div>
{}
<div className="relative max-w-7xl mx-auto px-4 md:px-0">
{}
<div className="flex flex-col md:flex-row justify-center gap-4 mb-16">
{AI_SYLLABUS.map((phase, idx) => {
const isActive = activePhase === idx;
return (
<button
key={idx}
onClick={() => setActivePhase(idx)}
className={`relative group px-8 py-4 rounded-2xl transition-all duration-300 border ${
isActive
? 'bg-white border-primary-200 shadow-xl scale-105 z-10'
: 'bg-white/50 border-transparent hover:bg-white hover:border-primary-100 hover:shadow-lg'
}`}
>
<div className="flex items-center gap-3">
<div className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors ${
isActive ? `bg-gradient-to-r ${phase.color} text-white` : 'bg-primary-100 text-primary-400 group-hover:bg-primary-200'
}`}>
<span className="font-black text-lg">{idx + 1}</span>
</div>
<div className="text-left">
<div className={`text-xs font-bold uppercase tracking-wider mb-0.5 ${isActive ? 'text-primary-500' : 'text-primary-400'}`}>
Phase {idx + 1}
</div>
<div className={`text-lg font-bold ${isActive ? 'text-primary-900' : 'text-primary-600'}`}>
{phase.phase.split(': ')[1]}
</div>
</div>
</div>
{isActive && (
<div className={`absolute -bottom-1 left-1/2 -translate-x-1/2 w-1/2 h-1 bg-gradient-to-r ${phase.color} rounded-t-full`}></div>
)}
</button>
);
})}
</div>
{}
<div className="relative min-h-[500px]">
{AI_SYLLABUS.map((phase, phaseIdx) => (
<div
key={phaseIdx}
className={`transition-all duration-500 absolute inset-0 ${
activePhase === phaseIdx
? 'opacity-100 translate-y-0 z-10 relative'
: 'opacity-0 translate-y-8 z-0 absolute pointer-events-none'
}`}
>
<div className="grid grid-cols-1 md:grid-cols-3 gap-6">
{phase.items.map((item, itemIdx) => {
const globalIdx = phaseIdx * 3 + itemIdx + 1;
return (
<div key={itemIdx} className="group relative bg-white rounded-2xl p-6 border border-primary-100 shadow-[0_2px_10px_rgba(0,0,0,0.02)] hover:shadow-[0_20px_40px_-10px_rgba(0,0,0,0.1)] transition-all duration-300 hover:-translate-y-1 flex flex-col h-full">
{}
<div className={`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${phase.color} opacity-0 group-hover:opacity-100 transition-opacity rounded-t-2xl`}></div>
{}
<div className="flex items-start justify-between mb-6">
<div className={`shrink-0 w-12 h-12 rounded-xl bg-primary-50 flex items-center justify-center group-hover:scale-110 transition-transform duration-300`}>
<div className={`${phase.color.split(' ')[0].replace('from-', 'text-')}`}>
{item.icon}
</div>
</div>
<div className="text-4xl font-black text-primary-100 select-none">
{globalIdx.toString().padStart(2, '0')}
</div>
</div>
{}
<div className="mb-6">
<h4 className="text-xl font-bold text-primary-900 mb-2 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-primary-900 group-hover:to-primary-700 transition-colors">
{item.title}
</h4>
<p className="text-sm text-primary-500 leading-relaxed min-h-[40px]">
{item.desc}
</p>
</div>
{}
<div className="space-y-3 flex-1">
{item.submodules.map((module, mIdx) => (
<div key={mIdx} className="bg-primary-50/50 rounded-lg p-3 border border-primary-100/50 group-hover:bg-white group-hover:border-primary-200 group-hover:shadow-sm transition-all">
<div className="font-bold text-xs text-primary-800 mb-1 flex items-center gap-1.5">
<span className={`w-1 h-1 rounded-full bg-gradient-to-r ${phase.color}`}></span>
{module.name}
</div>
<div className="text-[11px] text-primary-500 leading-relaxed pl-2.5 border-l border-primary-200">
{module.content}
</div>
</div>
))}
</div>
</div>
);
})}
</div>
</div>
))}
</div>
</div>
</div>
{}
<div className="mb-24">
<div className="flex items-center justify-between mb-8">
<h2 className="text-2xl font-bold text-primary-900 flex items-center gap-2">
<span className="w-1.5 h-8 bg-accent-copper rounded-full"></span>
1V1 æ·±åº¦é™ªè·‘
</h2>
<div className="px-3 py-1 bg-accent-copper/10 text-accent-copper rounded-full text-xs font-bold">
äº¦å¸ˆäº¦å‹
</div>
</div>
<div className="bg-primary-900 rounded-[2.5rem] p-8 md:p-12 text-white relative shadow-2xl shadow-primary-900/20 group/container overflow-hidden isolate border border-primary-800">
{}
<div className="absolute inset-0 overflow-hidden rounded-[2.5rem] pointer-events-none -z-10">
<div className="absolute inset-0 bg-[linear-gradient(to_right,#ffffff05_1px,transparent_1px),linear-gradient(to_bottom,#ffffff05_1px,transparent_1px)] bg-[size:24px_24px]"></div>
<div className="absolute top-0 right-0 w-[500px] h-[500px] bg-accent-blue/20 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/3"></div>
<div className="absolute bottom-0 left-0 w-[400px] h-[400px] bg-primary-500/20 rounded-full blur-[100px] translate-y-1/3 -translate-x-1/4"></div>
</div>
<div className="relative z-10">
<div className="flex flex-col gap-16">
{}
<div className="text-center max-w-4xl mx-auto">
<h3 className="text-3xl md:text-5xl font-black mb-8 leading-tight">
åˆ«ä¸€ä¸ªäººæ­»ç£•äº†<br/>
<span className="text-transparent bg-clip-text bg-gradient-to-r from-accent-gold to-accent-copper">
æ‰¾ä¸ªâ€œè€å¸æœºâ€å¸¦å¸¦ä½ 
</span>
</h3>
<p className="text-primary-200 mb-10 leading-relaxed text-lg md:px-12">
ä¸æè™šå¤´å·´è„‘çš„ PPTã€‚ä¸€å¯¹ä¸€ï¼Œæ‰‹æŠŠæ‰‹ï¼Œå¸®ä½ çœ‹çœ‹ä»£ç å“ªå†™å¾—çƒ‚ï¼Œç®€å†å“ªå¹å¾—å‡ï¼Œé¢è¯•å“ªå®¹æ˜“æŒ‚ã€‚åƒæœ‹å‹ä¸€æ ·èŠèŠæŠ€æœ¯ï¼Œé¡ºä¾¿æŠŠ Offer æ‹¿äº†ã€‚
</p>
<button onClick={() => setShowQRCode(true)} className="bg-gradient-to-r from-accent-gold to-accent-copper hover:from-accent-copper hover:to-accent-gold text-primary-900 font-bold py-4 px-12 rounded-full shadow-lg hover:shadow-accent-gold/20 transition-all transform hover:-translate-y-1 text-lg">
é¢„çº¦ 1V1 å’¨è¯¢
</button>
</div>
</div>
</div>
</div>
</div>
{}
<div className="mb-24">
<div className="text-center mb-16">
<span className="inline-block py-1 px-3 rounded-full bg-accent-blue/10 text-accent-blue font-bold text-xs tracking-widest uppercase mb-4">Mentors</span>
<h2 className="text-3xl md:text-5xl font-black text-primary-900 tracking-tight mb-6">
ä¸€çº¿å¤§å‚ <span className="text-transparent bg-clip-text bg-gradient-to-r from-accent-blue to-cyan-500">èµ„æ·±å¯¼å¸ˆ</span>
</h2>
<p className="text-xl text-primary-500 max-w-3xl mx-auto leading-relaxed">
ä»–ä»¬æ‹¥æœ‰ä¸°å¯Œçš„å®æˆ˜ç»éªŒä¸é¢è¯•å®˜è§†è§’ï¼Œæ‹’ç»ç…§æœ¬å®£ç§‘ï¼Œåªæ•™ä½ åœ¨å·¥ä½œä¸­çœŸæ­£ç”¨å¾—ä¸Šçš„ç¡¬æ ¸æŠ€æœ¯ã€‚
</p>
</div>
<div className="grid grid-cols-1 md:grid-cols-3 gap-6">
{[
{
name: "å¼ çœŸäºº",
role: "èµ„æ·±å‰ç«¯æŠ€æœ¯ä¸“å®¶",
desc: "æ›¾å°±èŒäºé˜¿é‡Œç­‰ä¸€çº¿äº’è”ç½‘å…¬å¸ï¼Œä¸»å¯¼è¿‡å¤§å‹ç”µå•†æ´»åŠ¨çš„å‰ç«¯æ¶æ„è®¾è®¡ã€‚æ“…é•¿æ€§èƒ½ä¼˜åŒ–ä¸å·¥ç¨‹åŒ–ä½“ç³»å»ºè®¾ã€‚",
tags: ["æ¶æ„è®¾è®¡", "æ€§èƒ½ä¼˜åŒ–", "å·¥ç¨‹åŒ–"],
avatar: "/img/0.png"
},
{
name: "è¢è€å¸ˆ",
role: "å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ",
desc: "å¤šå¹´ Node.js å…¨æ ˆå¼€å‘ç»éªŒï¼Œæ‹¥æœ‰ä¸°å¯Œçš„æœåŠ¡ç«¯è½åœ°ä¸å¾®æœåŠ¡æ²»ç†å®è·µã€‚çƒ­è¡·äºå¼€æºç¤¾åŒºä¸æŠ€æœ¯åˆ†äº«ã€‚",
tags: ["Node.js", "å…¨æ ˆå¼€å‘", "é¢è¯•æŒ‡å¯¼"],
avatar: "/img/1.png"
},
{
name: "å¼ºå“¥",
role: "é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ",
desc: "ä¸“æ³¨äº React ç”Ÿæ€ä¸è·¨ç«¯å¼€å‘æ–¹æ¡ˆã€‚å–„äºå°†å¤æ‚çš„æŠ€æœ¯åŸç†æŠ½ä¸å‰¥èŒ§ï¼Œå¸®åŠ©å­¦å‘˜å»ºç«‹æ¸…æ™°çš„çŸ¥è¯†ä½“ç³»ã€‚",
tags: ["React æºç ", "è·¨ç«¯å¼€å‘", "å¯è§†åŒ–"],
avatar: "/img/3.png"
}
].map((mentor, i) => (
<div key={i} className="group relative bg-white rounded-2xl p-6 border border-primary-100 shadow-sm hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
<div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary-100 to-primary-50 rounded-t-2xl group-hover:from-accent-blue group-hover:to-cyan-500 transition-colors"></div>
<div className="flex items-center gap-4 mb-6">
<div className="w-16 h-16 rounded-full bg-primary-50 flex items-center justify-center text-3xl shadow-inner group-hover:scale-110 transition-transform overflow-hidden">
<img src={mentor.avatar} alt={mentor.name} className="w-full h-full object-cover" />
</div>
<div>
<h3 className="text-xl font-bold text-primary-900">{mentor.name}</h3>
<div className="text-xs font-bold text-accent-blue bg-accent-blue/10 px-2 py-1 rounded-md inline-block mt-1">
{mentor.role}
</div>
</div>
</div>
<p className="text-primary-600 text-sm leading-relaxed mb-6 min-h-[60px]">
{mentor.desc}
</p>
<div className="flex flex-wrap gap-2">
{mentor.tags.map((tag, tIdx) => (
<span key={tIdx} className="text-[10px] font-medium px-2 py-1 rounded-full bg-primary-50 text-primary-500 border border-primary-100">
#{tag}
</span>
))}
</div>
</div>
))}
</div>
</div>
{}
<div className="mb-24">
<div className="flex flex-col md:flex-row md:items-end justify-between mb-12 gap-4">
<div>
<h2 className="text-3xl md:text-4xl font-black text-primary-900 tracking-tight mb-2">
æ ¸å¿ƒç‰¹è®­è¥
</h2>
<p className="text-primary-500 text-lg">å®æˆ˜é©±åŠ¨ï¼Œç»“æœå¯¼å‘ï¼Œæ‹’ç»çº¸ä¸Šè°ˆå…µ</p>
</div>
<div className="inline-flex items-center gap-2 px-3 py-1 bg-accent-copper/10 text-accent-copper rounded-full text-xs font-bold border border-accent-copper/20 animate-pulse">
ğŸ”¥ ç«çƒ­æŠ¥åä¸­
</div>
</div>
<div className="grid grid-cols-1 md:grid-cols-2 gap-8">
{}
<div className="group relative bg-white rounded-[2rem] p-8 shadow-[0_2px_10px_rgba(0,0,0,0.04)] hover:shadow-[0_20px_40px_rgba(0,0,0,0.08)] transition-all duration-500 border border-primary-100 overflow-hidden flex flex-col h-full">
<div className="absolute top-0 right-0 w-64 h-64 bg-accent-blue/10 rounded-full blur-3xl translate-x-1/3 -translate-y-1/3 group-hover:bg-accent-blue/20 transition-colors"></div>
<div className="relative z-10 flex-1">
<div className="w-14 h-14 rounded-2xl bg-accent-blue text-white flex items-center justify-center mb-6 shadow-lg shadow-accent-blue/20 group-hover:scale-110 transition-transform duration-300">
<Briefcase className="w-8 h-8" />
</div>
<h3 className="text-2xl font-bold text-primary-900 mb-3 group-hover:text-accent-blue transition-colors">é¢è¯•çªå‡»è®­ç»ƒåŒå­¦è¥</h3>
<p className="text-primary-500 leading-relaxed mb-8">
é’ˆå¯¹å¤§å‚é¢è¯•çš„é«˜é¢‘è€ƒç‚¹ä¸æ½œè§„åˆ™ã€‚ä»ç®€å†ä¼˜åŒ–åˆ°æ¨¡æ‹Ÿé¢è¯•ï¼Œæˆ‘ä»¬ä¸æ•™ä½ èƒŒé¢˜ï¼Œæ•™ä½ å¦‚ä½•åƒèµ„æ·±å·¥ç¨‹å¸ˆä¸€æ ·æ€è€ƒä¸è¡¨è¾¾ã€‚
</p>
<div className="space-y-4 mb-8">
{[
{ title: "ç®€å†ä¼˜åŒ–", desc: "æŒ–æ˜äº®ç‚¹ï¼Œè§„é¿å‘ç‚¹", icon: <FileText className="w-5 h-5 text-accent-blue" /> },
{ title: "æ¨¡æ‹Ÿé¢è¯•", desc: "1:1 è¿˜åŸçœŸå®åœºæ™¯", icon: <MessageCircle className="w-5 h-5 text-accent-blue" /> },
{ title: "å­¦ä¹ è®¡åˆ’", desc: "æ‹’ç»ç›²ç›®åˆ·é¢˜", icon: <Calendar className="w-5 h-5 text-accent-blue" /> },
{ title: "å…¨ç¨‹é™ªè·‘", desc: "äº¦å¸ˆäº¦å‹ï¼Œæœ‰é—®å¿…ç­”", icon: <Target className="w-5 h-5 text-accent-blue" /> }
].map((item, i) => (
<div key={i} className="flex items-center gap-4 p-3 rounded-xl bg-primary-50 group-hover:bg-accent-blue/5 transition-colors">
<div className="p-2 bg-white rounded-lg shadow-sm text-accent-blue">{item.icon}</div>
<div>
<div className="font-bold text-primary-800 text-sm">{item.title}</div>
<div className="text-xs text-primary-400">{item.desc}</div>
</div>
</div>
))}
</div>
</div>
<div className="relative z-10 mt-auto pt-6 border-t border-primary-100">
<button onClick={() => setShowQRCode(true)} className="w-full flex items-center justify-between group/btn">
<span className="font-bold text-primary-900 group-hover/btn:text-accent-blue transition-colors">æŸ¥çœ‹è¯¾ç¨‹å¤§çº²</span>
<div className="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center group-hover/btn:bg-accent-blue group-hover/btn:text-white transition-all">
<svg className="w-5 h-5 transform group-hover/btn:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
</div>
</button>
</div>
</div>
{}
<div className="group relative bg-white rounded-[2rem] p-8 shadow-[0_2px_10px_rgba(0,0,0,0.04)] hover:shadow-[0_20px_40px_rgba(0,0,0,0.08)] transition-all duration-500 border border-primary-100 overflow-hidden flex flex-col h-full">
<div className="absolute top-0 right-0 w-64 h-64 bg-accent-copper/10 rounded-full blur-3xl translate-x-1/3 -translate-y-1/3 group-hover:bg-accent-copper/20 transition-colors"></div>
<div className="relative z-10 flex-1">
<div className="w-14 h-14 rounded-2xl bg-accent-copper text-white flex items-center justify-center mb-6 shadow-lg shadow-accent-copper/20 group-hover:scale-110 transition-transform duration-300">
<Rocket className="w-8 h-8" />
</div>
<h3 className="text-2xl font-bold text-primary-900 mb-3 group-hover:text-accent-copper transition-colors">å‰ç«¯ç ´å£åŒå­¦è¥</h3>
<p className="text-primary-500 leading-relaxed mb-8">
å‘Šåˆ«â€œåªä¼šå†™ä¸šåŠ¡â€ï¼Œä»é›¶ç¼–å†™ä½ çš„è„šæ‰‹æ¶ï¼Œäº²æ‰‹æ­å»º Next.js å…¨æ ˆåº”ç”¨ï¼Œå¹¶é…ç½® CI/CDã€ç›‘æ§ä¸åŸŸåï¼Œå®Œæˆä¸€æ¬¡å¯¹â€œå¼€å‘-éƒ¨ç½²-è¿ç»´â€å…¨é“¾è·¯çš„å½»åº•æŒæ§ã€‚
</p>
<div className="space-y-4 mb-8">
{[
{ title: "è‡ªç ”è„šæ‰‹æ¶", desc: "ä»é›¶æ‰“é€  CLI å·¥å…·", icon: <Code2 className="w-5 h-5 text-accent-copper" /> },
{ title: "Next.js å…¨æ ˆ", desc: "ç‹¬ç«‹å¼€å‘å®Œæ•´åº”ç”¨", icon: <Layers className="w-5 h-5 text-accent-copper" /> },
{ title: "CI/CD & è¿ç»´", desc: "è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸ç›‘æ§", icon: <Shield className="w-5 h-5 text-accent-copper" /> }
].map((item, i) => (
<div key={i} className="flex items-center gap-4 p-3 rounded-xl bg-primary-50 group-hover:bg-accent-copper/5 transition-colors">
<div className="p-2 bg-white rounded-lg shadow-sm text-accent-copper">{item.icon}</div>
<div>
<div className="font-bold text-primary-800 text-sm">{item.title}</div>
<div className="text-xs text-primary-400">{item.desc}</div>
</div>
</div>
))}
</div>
</div>
<div className="relative z-10 mt-auto pt-6 border-t border-primary-100">
<button onClick={() => setShowQRCode(true)} className="w-full flex items-center justify-between group/btn">
<span className="font-bold text-primary-900 group-hover/btn:text-accent-copper transition-colors">æŸ¥çœ‹è¯¾ç¨‹å¤§çº²</span>
<div className="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center group-hover/btn:bg-accent-copper group-hover/btn:text-white transition-all">
<svg className="w-5 h-5 transform group-hover/btn:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
</div>
</button>
</div>
</div>
</div>
</div>
</div>
{}
<footer className="bg-white border-t border-primary-100 py-12 mt-auto shrink-0">
<div className="max-w-7xl mx-auto px-6 text-center">
<p className="text-primary-400 font-medium mb-4">å¤§å‰ç«¯åŒå­¦è¥ Â· é™ªä¼´ä½ çš„æ¯ä¸€æ¬¡æŠ€æœ¯æˆé•¿</p>
<p className="text-primary-300 text-sm">Â© 2025 Big Frontend Camp. All rights reserved.</p>
</div>
</footer>
{}
{showQRCode && (
<div className="fixed inset-0 z-50 flex items-center justify-center p-4">
<div
className="absolute inset-0 bg-primary-900/80 backdrop-blur-sm"
onClick={() => setShowQRCode(false)}
></div>
<div className="relative bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full animate-modal-in transform transition-all">
<button
onClick={() => setShowQRCode(false)}
className="absolute top-4 right-4 text-primary-400 hover:text-primary-600"
>
<svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
</svg>
</button>
<div className="text-center">
<h3 className="text-xl font-bold text-primary-900 mb-2">æ‰«ç åŠ å…¥äº¤æµç¾¤</h3>
<p className="text-primary-500 text-sm mb-6">ä¸ 10000+ å°ä¼™ä¼´ä¸€èµ·æˆé•¿</p>
<div className="w-48 h-48 mx-auto bg-white rounded-xl mb-6 flex items-center justify-center border-2 border-dashed border-primary-200 overflow-hidden relative group">
{}
{!qrError ? (
<img
src="/temp/group_qr.jpg"
alt="å¤§å‰ç«¯åŒå­¦è¥äº¤æµç¾¤äºŒç»´ç "
onError={() => setQrError(true)}
className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
/>
) : (
<div className="flex flex-col items-center justify-center w-full h-full bg-primary-50 text-primary-400 p-4 text-center">
<div className="w-8 h-8 mb-2 rounded-full bg-primary-100 flex items-center justify-center">
<svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
</div>
<span className="text-xs font-medium">å›¾ç‰‡æœªæ‰¾åˆ°</span>
<span className="text-[10px] mt-1 opacity-70 break-all">public/temp/group_qr.jpg</span>
</div>
)}
</div>
<div className="bg-primary-50 rounded-lg p-3 text-xs text-primary-700">
<p>ğŸ’¡ è¿›ç¾¤æš—å·ï¼š<span className="font-bold">å¤§å‰ç«¯</span></p>
{}
</div>
</div>
</div>
</div>
)}
{}
<div className="fixed bottom-8 right-8 z-40 flex flex-col gap-3 items-center">
{}
<button
onClick={scrollToTop}
className={`flex items-center justify-center w-14 h-14 rounded-2xl shadow-[0_8px_30px_rgba(0,0,0,0.12)] transition-all duration-500 cubic-bezier(0.34, 1.56, 0.64, 1) ${
showScrollTop
? 'translate-y-0 opacity-100 scale-100'
: 'translate-y-10 opacity-0 scale-75 pointer-events-none'
} bg-white text-primary-900 border border-primary-100 hover:bg-primary-50 hover:shadow-[0_20px_40px_-10px_rgba(0,0,0,0.1)] hover:scale-110 hover:-translate-y-1 group overflow-hidden`}
aria-label="Back to top"
>
<span className="relative z-10 font-black text-xs tracking-widest group-hover:tracking-[0.25em] transition-all duration-300">
TOP
</span>
</button>
{}
<button
onClick={() => setShowQRCode(true)}
className="flex items-center justify-center w-14 h-14 rounded-2xl shadow-[0_8px_30px_rgba(0,0,0,0.2)] bg-primary-900 text-accent-gold border border-white/10 hover:shadow-[0_20px_40px_-10px_rgba(0,0,0,0.4)] hover:scale-110 hover:-translate-y-1 transition-all duration-300 group overflow-hidden relative"
aria-label="Join Group"
>
{}
<div className="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] bg-gradient-to-r from-transparent via-white/10 to-transparent z-0" />
<MessageCircle className="w-7 h-7 relative z-10 group-hover:rotate-12 transition-transform duration-300" strokeWidth={2} />
</button>
</div>
</div>
);
};
export default StudentCamp;
// File: apps\web\src\components\UserAvatar.tsx
import React, { useMemo } from 'react';
interface UserAvatarProps {
user?: {
name?: string | null;
email?: string | null;
image?: string | null;
} | null;
size?: 'sm' | 'md' | 'lg' | 'xl' | '2xl';
className?: string;
onClick?: () => void;
}
const AVATAR_GRADIENTS = [
'bg-gradient-to-br from-primary-800 to-primary-600',
'bg-gradient-to-br from-primary-900 to-accent-copper',
'bg-gradient-to-br from-primary-800 to-accent-gold',
'bg-gradient-to-br from-primary-700 to-accent-sage',
'bg-gradient-to-br from-primary-700 to-accent-blue',
'bg-gradient-to-br from-neutral-dark to-neutral-medium',
'bg-gradient-to-br from-primary-600 to-accent-copper',
'bg-gradient-to-br from-primary-600 to-accent-sage',
];
const SIZE_CLASSES = {
sm: 'w-8 h-8 text-xs',
md: 'w-9 h-9 text-sm',
lg: 'w-12 h-12 text-lg',
xl: 'w-16 h-16 text-xl',
'2xl': 'w-24 h-24 text-4xl',
};
export const UserAvatar: React.FC<UserAvatarProps> = ({
user,
size = 'md',
className = '',
onClick
}) => {
const gradientClass = useMemo(() => {
const identifier = user?.email || user?.name || 'default';
let hash = 0;
for (let i = 0; i < identifier.length; i++) {
hash = identifier.charCodeAt(i) + ((hash << 5) - hash);
}
const index = Math.abs(hash) % AVATAR_GRADIENTS.length;
return AVATAR_GRADIENTS[index];
}, [user?.email, user?.name]);
const initial = useMemo(() => {
if (!user) return null;
if (user.name) return user.name.charAt(0).toUpperCase();
if (user.email) return user.email.charAt(0).toUpperCase();
return 'U';
}, [user]);
const sizeClass = SIZE_CLASSES[size];
if (!user) {
return (
<div
onClick={onClick}
className={`
${sizeClass}
rounded-full
flex items-center justify-center
shadow-sm
overflow-hidden
relative
transition-all duration-200
bg-primary-50 text-primary-300
hover:bg-primary-100 hover:text-primary-400
${className}
`}
>
<div className="absolute inset-0 rounded-full ring-1 ring-inset ring-black/5 pointer-events-none z-20" />
<svg xmlns="http:
<path fillRule="evenodd" d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z" clipRule="evenodd" />
</svg>
</div>
);
}
return (
<div
onClick={onClick}
className={`
${sizeClass}
rounded-full
flex items-center justify-center
font-bold text-white shadow-md
overflow-hidden
relative
transition-all duration-200
${className}
${!user?.image ? gradientClass : 'bg-neutral-light'}
`}
>
{}
<div className="absolute inset-0 rounded-full ring-1 ring-inset ring-black/5 dark:ring-white/10 pointer-events-none z-20" />
{user?.image ? (
<img
src={user.image}
alt={user.name || "User"}
className="w-full h-full object-cover"
/>
) : (
<>
{}
<div className="absolute inset-0 opacity-10 pointer-events-none"
style={{
backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http:
}}
/>
{}
<div className="absolute inset-0 shadow-[inset_0_2px_4px_rgba(255,255,255,0.3),inset_0_-2px_4px_rgba(0,0,0,0.1)] pointer-events-none" />
{}
<span className="relative z-10 drop-shadow-sm select-none font-sans tracking-tight">
{initial}
</span>
</>
)}
</div>
);
};
// File: apps\web\src\components\UserProfileModal.tsx
import React, { useState, useEffect } from 'react';
import { User } from 'lucide-react';
import { UserAvatar } from '@/components/UserAvatar';
interface UserProfileModalProps {
isOpen: boolean;
onClose: () => void;
user: {
id: string;
name?: string;
email?: string;
image?: string;
};
onUpdate: () => void;
}
export const UserProfileModal: React.FC<UserProfileModalProps> = ({ isOpen, onClose, user, onUpdate }) => {
const [name, setName] = useState(user.name || '');
const [image, setImage] = useState(user.image || '');
const [loading, setLoading] = useState(false);
useEffect(() => {
if (isOpen) {
setName(user.name || '');
setImage(user.image || '');
}
}, [isOpen, user]);
if (!isOpen) return null;
const handleSubmit = async (e: React.FormEvent) => {
e.preventDefault();
setLoading(true);
try {
const response = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http:
method: 'PATCH',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ name, image }),
});
if (response.ok) {
onUpdate();
onClose();
window.location.reload();
} else {
console.error('Failed to update profile');
}
} catch (error) {
console.error('Error updating profile:', error);
} finally {
setLoading(false);
}
};
return (
<div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
{}
<div
className="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity duration-300"
onClick={onClose}
/>
{}
<div className="relative w-full max-w-md bg-white/95 backdrop-blur-2xl border border-white/50 rounded-2xl shadow-2xl p-8 transform transition-all duration-300 scale-100">
{}
<div className="absolute -top-20 -right-20 w-40 h-40 bg-purple-200 rounded-full blur-3xl opacity-30 mix-blend-multiply animate-blob" />
<div className="absolute -bottom-20 -left-20 w-40 h-40 bg-blue-200 rounded-full blur-3xl opacity-30 mix-blend-multiply animate-blob animation-delay-2000" />
<div className="relative z-10">
<h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
<User className="w-6 h-6 text-primary-600" />
ä¸ªäººä¿¡æ¯è®¾ç½®
</h2>
<form onSubmit={handleSubmit} className="space-y-6">
{}
<div className="flex flex-col items-center gap-4">
<div className="rounded-full border-4 border-white shadow-lg overflow-hidden relative group">
<UserAvatar
user={{ image: image || null, name: name || user.name, email: user.email }}
size="2xl"
/>
</div>
<div className="w-full">
<label className="block text-sm font-medium text-gray-700 mb-1">å¤´åƒé“¾æ¥</label>
<input
type="url"
value={image}
onChange={(e) => setImage(e.target.value)}
placeholder="è¯·è¾“å…¥å¤´åƒå›¾ç‰‡URL"
className="w-full px-4 py-2 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
/>
</div>
</div>
{}
<div>
<label className="block text-sm font-medium text-gray-700 mb-1">ç”¨æˆ·å</label>
<input
type="text"
value={name}
onChange={(e) => setName(e.target.value)}
placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
className="w-full px-4 py-2 bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all"
required
/>
</div>
{}
<div className="flex gap-3 pt-4">
<button
type="button"
onClick={onClose}
className="flex-1 px-4 py-2 rounded-xl border border-gray-200 text-gray-600 hover:bg-gray-50 transition-colors font-medium"
>
å–æ¶ˆ
</button>
<button
type="submit"
disabled={loading}
className="flex-1 px-4 py-2 rounded-xl bg-gradient-to-r from-primary-600 to-primary-500 text-white shadow-lg shadow-primary-500/30 hover:shadow-primary-500/40 hover:-translate-y-0.5 transition-all duration-300 font-medium disabled:opacity-70 disabled:cursor-not-allowed"
>
{loading ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ä¿®æ”¹'}
</button>
</div>
</form>
</div>
</div>
</div>
);
};
// File: apps\web\src\lib\auth-client.ts
import { createAuthClient } from "better-auth/react";
export const authClient = createAuthClient({
baseURL: process.env.NEXT_PUBLIC_BETTER_AUTH_URL,
});
export const { signIn, signUp, useSession, signOut } = authClient;
// File: apps\web\src\lib\request.ts
import axios from 'axios';
const apiInstance = axios.create({
baseURL: process.env.NEXT_PUBLIC_API_URL || 'http:
timeout: 10000,
withCredentials: true,
});
apiInstance.interceptors.response.use(
(response) => response.data,
(error) => Promise.reject(error)
);
export const api = {
get: <T = any>(url: string, config?: any) => apiInstance.get<T, T>(url, config),
post: <T = any>(url: string, data?: any, config?: any) => apiInstance.post<T, T>(url, data, config),
put: <T = any>(url: string, data?: any, config?: any) => apiInstance.put<T, T>(url, data, config),
patch: <T = any>(url: string, data?: any, config?: any) => apiInstance.patch<T, T>(url, data, config),
delete: <T = any>(url: string, config?: any) => apiInstance.delete<T, T>(url, config),
};
const requestInstance = axios.create({
timeout: 10000,
});
requestInstance.interceptors.response.use(
(response) => response.data,
(error) => Promise.reject(error)
);
export const request = {
get: <T = any>(url: string, config?: any) => requestInstance.get<T, T>(url, config),
post: <T = any>(url: string, data?: any, config?: any) => requestInstance.post<T, T>(url, data, config),
};
// File: apps\web\src\lib\server-utils.ts
export async function getGreetingConfig() {
try {
const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/system/config`, {
next: { revalidate: 60 }
});
if (!res.ok) return {};
const data = await res.json();
return data.reduce((acc: any, item: any) => {
acc[item.key] = item.value;
return acc;
}, {});
} catch (error) {
console.error('Failed to fetch greeting config:', error);
return {};
}
}
// File: apps\admin\src\lib\request.ts
import axios from 'axios';
import { message } from 'antd';
const request = axios.create({
baseURL: import.meta.env.VITE_API_URL || 'http:
timeout: 10000,
});
request.interceptors.request.use(
(config) => {
return config;
},
(error) => {
return Promise.reject(error);
}
);
request.interceptors.response.use(
(response) => {
return response.data;
},
(error) => {
const msg = error.response?.data?.message || error.message || 'è¯·æ±‚å¤±è´¥';
message.error(msg);
return Promise.reject(error);
}
);
const http = {
get: <T = any>(url: string, config?: any) => request.get<T, T>(url, config),
post: <T = any>(url: string, data?: any, config?: any) => request.post<T, T>(url, data, config),
put: <T = any>(url: string, data?: any, config?: any) => request.put<T, T>(url, data, config),
patch: <T = any>(url: string, data?: any, config?: any) => request.patch<T, T>(url, data, config),
delete: <T = any>(url: string, config?: any) => request.delete<T, T>(url, config),
};
export default http;
// File: apps\admin\src\main.tsx
import React from "react";
import ReactDOM from "react-dom/client";
import { RouterProvider } from "react-router-dom";
import { router } from "./router";
import { ConfigProvider } from "antd";
import zhCN from "antd/locale/zh_CN";
import "antd/dist/reset.css";
ReactDOM.createRoot(document.getElementById("root")!).render(
<React.StrictMode>
<ConfigProvider
locale={zhCN}
theme={{
token: {
colorPrimary: '#1677ff',
borderRadius: 6,
fontFamily: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif",
},
}}
>
<RouterProvider router={router} />
</ConfigProvider>
</React.StrictMode>,
);
// File: apps\admin\src\router.tsx
import React from "react";
import { createBrowserRouter, Navigate } from "react-router-dom";
import { AppLayout } from "./ui/AppLayout";
import { DashboardPage } from "./ui/pages/DashboardPage";
import { UsersPage } from "./ui/pages/UsersPage";
import { QuestionsPage } from "./ui/pages/QuestionsPage";
import { CategoriesPage } from "./ui/pages/CategoriesPage";
import { QuestionEditorPage } from "./ui/pages/QuestionEditorPage";
import { HotQuestionsConfigPage } from "./ui/pages/HotQuestionsConfigPage";
import { GreetingConfigPage } from "./ui/pages/GreetingConfigPage";
export const router = createBrowserRouter([
{
path: "/",
element: <AppLayout />,
children: [
{ index: true, element: <Navigate to="/dashboard" replace /> },
{ path: "dashboard", element: <DashboardPage /> },
{ path: "users", element: <UsersPage /> },
{ path: "questions", element: <QuestionsPage /> },
{ path: "questions/categories", element: <CategoriesPage /> },
{ path: "questions/hot-config", element: <HotQuestionsConfigPage /> },
{ path: "questions/create", element: <QuestionEditorPage /> },
{ path: "questions/edit/:id", element: <QuestionEditorPage /> },
{ path: "system/greeting", element: <GreetingConfigPage /> },
],
},
]);
// File: apps\admin\src\ui\AppLayout.tsx
import React, { useMemo } from "react";
import { Link, Outlet, useLocation } from "react-router-dom";
import { Layout, Menu, theme, Typography, Avatar, Dropdown, Space, Breadcrumb } from "antd";
import {
DashboardOutlined,
TeamOutlined,
UserOutlined,
LogoutOutlined,
SettingOutlined,
BellOutlined,
FileTextOutlined
} from "@ant-design/icons";
const { Header, Sider, Content } = Layout;
export function AppLayout() {
const location = useLocation();
const {
token: { colorBgContainer, borderRadiusLG, colorPrimary },
} = theme.useToken();
const selectedKeys = useMemo(() => {
if (location.pathname === "/questions" || location.pathname.startsWith("/questions/edit") || location.pathname === "/questions/create") return ["questions-list"];
if (location.pathname === "/questions/categories") return ["questions-categories"];
if (location.pathname === "/questions/hot-config") return ["questions-hot-config"];
if (location.pathname.startsWith("/users")) return ["users"];
return ["dashboard"];
}, [location.pathname]);
const openKeys = useMemo(() => {
if (location.pathname.startsWith("/questions")) return ["questions"];
return [];
}, [location.pathname]);
const breadcrumbItems = useMemo(() => {
const items = [{ title: 'é¦–é¡µ' }];
if (location.pathname.startsWith("/dashboard")) items.push({ title: 'ä»ªè¡¨ç›˜' });
if (location.pathname.startsWith("/users")) items.push({ title: 'ç”¨æˆ·ç®¡ç†' });
if (location.pathname.startsWith("/questions")) {
items.push({ title: 'é¢˜åº“ç®¡ç†' });
if (location.pathname === "/questions/categories") items.push({ title: 'åˆ†ç±»ç®¡ç†' });
else if (location.pathname === "/questions/hot-config") items.push({ title: 'çƒ­é—¨é…ç½®' });
else if (location.pathname === "/questions/create") items.push({ title: 'å½•å…¥é¢˜ç›®' });
else if (location.pathname.startsWith("/questions/edit")) items.push({ title: 'ç¼–è¾‘é¢˜ç›®' });
else items.push({ title: 'é¢˜ç›®åˆ—è¡¨' });
}
return items;
}, [location.pathname]);
return (
<Layout style={{ minHeight: "100vh" }}>
<Sider
breakpoint="lg"
collapsedWidth="0"
width={240}
theme="light"
style={{
boxShadow: '2px 0 8px 0 rgba(29,35,41,.05)',
zIndex: 10
}}
>
<div style={{
height: 64,
display: 'flex',
alignItems: 'center',
justifyContent: 'center',
margin: 0,
borderBottom: '1px solid rgba(5, 5, 5, 0.06)',
}}>
<div style={{
width: 32,
height: 32,
background: 'linear-gradient(135deg, #00B96B 0%, #1677FF 100%)',
borderRadius: 8,
marginRight: 10,
display: 'flex',
alignItems: 'center',
justifyContent: 'center',
color: '#fff',
fontWeight: 800,
fontSize: 20,
boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
}}>G</div>
<Typography.Title level={4} style={{ margin: 0, letterSpacing: 0.5, fontSize: 18, fontWeight: 700 }}>
GreatFed<span style={{ color: '#1677FF' }}>Camp</span>
</Typography.Title>
</div>
<Menu
theme="light"
mode="inline"
selectedKeys={selectedKeys}
defaultOpenKeys={openKeys}
style={{ borderRight: 0, padding: '0 8px' }}
items={[
{
key: "dashboard",
icon: <DashboardOutlined />,
label: <Link to="/dashboard">ä»ªè¡¨ç›˜</Link>,
},
{
key: "users",
icon: <TeamOutlined />,
label: <Link to="/users">ç”¨æˆ·ç®¡ç†</Link>,
},
{
key: "questions",
icon: <FileTextOutlined />,
label: "é¢˜åº“ç®¡ç†",
children: [
{ key: "questions-list", label: <Link to="/questions">é¢˜ç›®åˆ—è¡¨</Link> },
{ key: "questions-categories", label: <Link to="/questions/categories">åˆ†ç±»ç®¡ç†</Link> },
{ key: "questions-hot-config", label: <Link to="/questions/hot-config">çƒ­é—¨é…ç½®</Link> },
]
},
{
key: "system",
icon: <SettingOutlined />,
label: "ç³»ç»Ÿè®¾ç½®",
children: [
{ key: "system-greeting", label: <Link to="/system/greeting">æ ‡è¯­è®¾ç½®</Link> },
]
}
]}
/>
</Sider>
<Layout style={{ background: '#f0f2f5' }}>
<Header style={{
padding: '0 24px',
background: colorBgContainer,
display: 'flex',
alignItems: 'center',
justifyContent: 'space-between',
boxShadow: '0 1px 4px rgba(0,21,41,.08)',
zIndex: 9
}}>
<Breadcrumb items={breadcrumbItems} />
<Space size="large">
<BellOutlined style={{ fontSize: 18, cursor: 'pointer' }} />
<Dropdown
menu={{
items: [
{ key: 'profile', icon: <UserOutlined />, label: 'ä¸ªäººä¸­å¿ƒ' },
{ type: 'divider' },
{ key: 'logout', icon: <LogoutOutlined />, label: 'é€€å‡ºç™»å½•', danger: true },
]
}}
>
<Space style={{ cursor: 'pointer' }}>
<Avatar
style={{
backgroundColor: '#1677FF',
verticalAlign: 'middle',
boxShadow: '0 2px 4px rgba(22, 119, 255, 0.2)'
}}
icon={<UserOutlined />}
/>
<Typography.Text strong>Admin User</Typography.Text>
</Space>
</Dropdown>
</Space>
</Header>
<Content style={{ margin: '24px 24px 0', minHeight: 280 }}>
<Outlet />
</Content>
<Layout.Footer style={{ textAlign: 'center', color: '#888' }}>
GreatFedCamp Â©{new Date().getFullYear()} Created by Trae AI
</Layout.Footer>
</Layout>
</Layout>
);
}
// File: apps\admin\src\ui\pages\CategoriesPage.tsx
import React, { useState, useEffect, useCallback } from 'react';
import { Table, Button, Form, Input, Card, Modal, message, Popconfirm, Space } from 'antd';
import { PlusOutlined, DeleteOutlined, EditOutlined } from '@ant-design/icons';
import http from '../../lib/request';
interface Category {
id: string;
name: string;
}
export const CategoriesPage: React.FC = () => {
const [categories, setCategories] = useState<Category[]>([]);
const [loading, setLoading] = useState(false);
const [modalVisible, setModalVisible] = useState(false);
const [editingCategory, setEditingCategory] = useState<Category | null>(null);
const [form] = Form.useForm();
const fetchCategories = useCallback(async () => {
setLoading(true);
try {
const res = await http.get<Category[]>('/questions/categories');
setCategories(res);
} catch (error) {
console.error(error);
} finally {
setLoading(false);
}
}, []);
useEffect(() => {
fetchCategories();
}, [fetchCategories]);
const handleSubmit = async (values: { name: string }) => {
try {
if (editingCategory) {
message.warning('æš‚ä¸æ”¯æŒä¿®æ”¹åˆ†ç±»ï¼Œè¯·åˆ é™¤åé‡æ–°åˆ›å»º');
} else {
await http.post('/questions/categories', values);
message.success('åˆ›å»ºæˆåŠŸ');
}
setModalVisible(false);
form.resetFields();
setEditingCategory(null);
fetchCategories();
} catch (error) {
console.error(error);
}
};
const handleDelete = async (id: string) => {
try {
await http.delete(`/questions/categories/${id}`);
message.success('åˆ é™¤æˆåŠŸ');
fetchCategories();
} catch (error) {
console.error(error);
message.error('åˆ é™¤å¤±è´¥');
}
};
const columns = [
{
title: 'åˆ†ç±»åç§°',
dataIndex: 'name',
key: 'name',
},
{
title: 'ID',
dataIndex: 'id',
key: 'id',
width: 240,
},
{
title: 'æ“ä½œ',
key: 'action',
width: 150,
render: (_: any, record: Category) => (
<Space size="middle">
{}
<Popconfirm title="ç¡®å®šåˆ é™¤å—?" onConfirm={() => handleDelete(record.id)}>
<Button type="text" danger icon={<DeleteOutlined />} />
</Popconfirm>
</Space>
),
},
];
return (
<div style={{ padding: 24 }}>
<Card
title="åˆ†ç±»ç®¡ç†"
extra={
<Button
type="primary"
icon={<PlusOutlined />}
onClick={() => {
setEditingCategory(null);
form.resetFields();
setModalVisible(true);
}}
>
æ–°å»ºåˆ†ç±»
</Button>
}
>
<Table
columns={columns}
dataSource={categories}
rowKey="id"
loading={loading}
pagination={false}
/>
</Card>
<Modal
title={editingCategory ? "ç¼–è¾‘åˆ†ç±»" : "æ–°å»ºåˆ†ç±»"}
open={modalVisible}
onCancel={() => {
setModalVisible(false);
setEditingCategory(null);
form.resetFields();
}}
onOk={() => form.submit()}
>
<Form form={form} onFinish={handleSubmit} layout="vertical">
<Form.Item
name="name"
label="åˆ†ç±»åç§°"
rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†ç±»åç§°' }]}
>
<Input placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°" />
</Form.Item>
</Form>
</Modal>
</div>
);
};
// File: apps\admin\src\ui\pages\DashboardPage.tsx
import React, { useEffect, useState } from "react";
import { Card, Col, Row, Statistic, Typography, Spin, List, Avatar, Space, Tag, theme } from "antd";
import { UserOutlined, RiseOutlined, SafetyCertificateOutlined } from "@ant-design/icons";
import request from '../../lib/request';
interface DashboardStats {
totalUsers: number;
newUsersToday: number;
activeSessions: number;
recentUsers: Array<{
id: string;
name: string;
email: string;
createdAt: string;
image?: string;
}>;
}
export function DashboardPage() {
const {
token: { colorPrimary },
} = theme.useToken();
const [loading, setLoading] = useState(true);
const [stats, setStats] = useState<DashboardStats>({
totalUsers: 0,
newUsersToday: 0,
activeSessions: 0,
recentUsers: []
});
useEffect(() => {
request.get<DashboardStats>('/users/stats')
.then(data => {
setStats(data);
})
.catch(err => {
console.error('Failed to fetch stats:', err);
})
.finally(() => {
setLoading(false);
});
}, []);
return (
<div style={{ padding: 0 }}>
{loading ? (
<div style={{ textAlign: 'center', padding: 50 }}>
<Spin size="large" />
</div>
) : (
<Space direction="vertical" size="large" style={{ width: '100%' }}>
<Row gutter={[24, 24]}>
<Col xs={24} sm={8}>
<Card bordered={false} hoverable>
<Statistic
title="æ€»ç”¨æˆ·æ•°"
value={stats.totalUsers}
prefix={<UserOutlined style={{ color: colorPrimary }} />}
/>
</Card>
</Col>
<Col xs={24} sm={8}>
<Card bordered={false} hoverable>
<Statistic
title="ä»Šæ—¥æ–°å¢"
value={stats.newUsersToday}
prefix={<RiseOutlined style={{ color: '#52c41a' }} />}
valueStyle={{ color: stats.newUsersToday > 0 ? '#52c41a' : undefined }}
/>
</Card>
</Col>
<Col xs={24} sm={8}>
<Card bordered={false} hoverable>
<Statistic
title="æ´»è·ƒä¼šè¯"
value={stats.activeSessions}
prefix={<SafetyCertificateOutlined style={{ color: '#faad14' }} />}
/>
</Card>
</Col>
</Row>
<Card title="æœ€æ–°æ³¨å†Œç”¨æˆ·" bordered={false}>
<List
itemLayout="horizontal"
dataSource={stats.recentUsers}
renderItem={(user) => (
<List.Item>
<List.Item.Meta
avatar={<Avatar src={user.image} icon={<UserOutlined />} style={{ backgroundColor: colorPrimary }} />}
title={<Typography.Text strong>{user.name || user.email.split('@')[0]}</Typography.Text>}
description={
<Space>
<Tag>{user.email}</Tag>
<Typography.Text type="secondary" style={{ fontSize: 12 }}>
æ³¨å†Œäº {new Date(user.createdAt).toLocaleString()}
</Typography.Text>
</Space>
}
/>
</List.Item>
)}
/>
</Card>
</Space>
)}
</div>
);
}
// File: apps\admin\src\ui\pages\GreetingConfigPage.tsx
import React, { useEffect, useState } from 'react';
import { Card, Form, Input, Button, message, Typography, Space, Divider } from 'antd';
import { SaveOutlined } from '@ant-design/icons';
import http from '../../lib/request';
const { Title, Text } = Typography;
interface SystemConfig {
key: string;
value: string;
description?: string;
}
const GREETING_KEYS = [
{ key: 'greeting_0_7', label: 'å‡Œæ™¨ (00:00 - 07:00)', default: 'å¤œæ·±éœ²é‡ï¼Œæ„¿ä½ å¥½æ¢¦ç›¸ä¼´' },
{ key: 'greeting_7_9', label: 'æ¸…æ™¨ (07:00 - 09:00)', default: 'æœé˜³åˆå‡ï¼Œä»Šå¤©çš„ä½ ä¹Ÿå¾ˆæ£’' },
{ key: 'greeting_9_12', label: 'ä¸Šåˆ (09:00 - 12:00)', default: 'é˜³å…‰æ­£å¥½ï¼Œç”¨ä»£ç ç¼–ç»‡æœªæ¥' },
{ key: 'greeting_12_14', label: 'ä¸­åˆ (12:00 - 14:00)', default: 'èŒ¶ä½™é¥­åï¼Œç»™è‡ªå·±ä¸€æ®µæ”¾ç©ºæ—¶å…‰' },
{ key: 'greeting_14_18', label: 'ä¸‹åˆ (14:00 - 18:00)', default: 'åˆåé™è°§ï¼Œçµæ„Ÿåœ¨æŒ‡å°–æµæ·Œ' },
{ key: 'greeting_18_24', label: 'æ™šä¸Š (18:00 - 24:00)', default: 'å¸ä¸‹ç–²æƒ«ï¼Œäº«å—å±äºä½ çš„å®é™å¤œæ™š' },
];
export function GreetingConfigPage() {
const [form] = Form.useForm();
const [loading, setLoading] = useState(false);
useEffect(() => {
fetchConfig();
}, []);
const fetchConfig = async () => {
try {
setLoading(true);
const data = await http.get<SystemConfig[]>('/system/config');
const formValues: Record<string, string> = {};
GREETING_KEYS.forEach(item => {
formValues[item.key] = item.default;
});
if (Array.isArray(data)) {
data.forEach(item => {
if (item.key.startsWith('greeting_')) {
formValues[item.key] = item.value;
}
});
}
form.setFieldsValue(formValues);
} catch (error) {
console.error('Failed to fetch config:', error);
} finally {
setLoading(false);
}
};
const onFinish = async (values: Record<string, string>) => {
try {
setLoading(true);
const promises = Object.entries(values).map(([key, value]) => {
return http.post(`/system/config/${key}`, { value });
});
await Promise.all(promises);
message.success('æ ‡è¯­é…ç½®å·²æ›´æ–°');
} catch (error) {
console.error('Failed to save config:', error);
message.error('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
} finally {
setLoading(false);
}
};
return (
<Space direction="vertical" style={{ width: '100%' }} size="large">
<div>
<Title level={2}>æ ‡è¯­è®¾ç½®</Title>
<Text type="secondary">é…ç½®ä¸åŒæ—¶é—´æ®µåœ¨å¯¼èˆªæ æ˜¾ç¤ºçš„æ¬¢è¿æ ‡è¯­</Text>
</div>
<Card>
<Form
form={form}
layout="vertical"
onFinish={onFinish}
autoComplete="off"
>
{GREETING_KEYS.map((item) => (
<Form.Item
key={item.key}
label={item.label}
name={item.key}
rules={[{ required: true, message: 'è¯·è¾“å…¥æ ‡è¯­å†…å®¹' }]}
>
<Input placeholder={item.default} size="large" />
</Form.Item>
))}
<Divider />
<Form.Item>
<Button type="primary" htmlType="submit" icon={<SaveOutlined />} loading={loading} size="large">
ä¿å­˜é…ç½®
</Button>
</Form.Item>
</Form>
</Card>
</Space>
);
}
// File: apps\admin\src\ui\pages\HotQuestionsConfigPage.tsx
import React, { useEffect, useState } from 'react';
import { Card, Form, InputNumber, Button, message, Spin, Row, Col, Popconfirm, Alert } from 'antd';
import { DeleteOutlined } from '@ant-design/icons';
import http from '../../lib/request';
export const HotQuestionsConfigPage = () => {
const [form] = Form.useForm();
const [loading, setLoading] = useState(true);
const [submitting, setSubmitting] = useState(false);
const [clearing, setClearing] = useState(false);
const fetchConfig = async () => {
try {
setLoading(true);
const [limitRes, expandedLimitRes] = await Promise.all([
http.get('/system/config/hot_questions_limit'),
http.get('/system/config/hot_questions_expanded_limit')
]);
form.setFieldsValue({
limit: limitRes ? Number(limitRes) : 10,
expandedLimit: expandedLimitRes ? Number(expandedLimitRes) : 20
});
} catch (error) {
console.error(error);
message.error('è·å–é…ç½®å¤±è´¥');
} finally {
setLoading(false);
}
};
useEffect(() => {
fetchConfig();
}, []);
const handleSubmit = async (values: any) => {
try {
setSubmitting(true);
await Promise.all([
http.post('/system/config/hot_questions_limit', { value: String(values.limit) }),
http.post('/system/config/hot_questions_expanded_limit', { value: String(values.expandedLimit) })
]);
message.success('é…ç½®å·²æ›´æ–°');
} catch (error) {
console.error(error);
message.error('æ›´æ–°é…ç½®å¤±è´¥');
} finally {
setSubmitting(false);
}
};
const handleClearZeroHotScore = async () => {
try {
setClearing(true);
const res = await http.delete<{count: number}>('/questions/batch/zero-hot-score');
const count = res.count !== undefined ? res.count : res;
message.success(`å·²æˆåŠŸæ¸…ç† ${count} ä¸ªéçƒ­é—¨é¢˜ç›®`);
} catch (error) {
console.error(error);
message.error('æ¸…ç†å¤±è´¥');
} finally {
setClearing(false);
}
};
return (
<Card title="çƒ­é—¨é…ç½®" bordered={false}>
{loading ? (
<div style={{ textAlign: 'center', padding: '40px 0' }}>
<Spin size="large" />
</div>
) : (
<Form
form={form}
layout="vertical"
onFinish={handleSubmit}
initialValues={{ limit: 10, expandedLimit: 20 }}
>
<Row gutter={24}>
<Col span={8}>
<Form.Item
name="limit"
label="é»˜è®¤æ˜¾ç¤ºæ¡æ•°"
rules={[{ required: true, message: 'è¯·è¾“å…¥é»˜è®¤æ˜¾ç¤ºæ¡æ•°' }]}
tooltip="é¦–é¡µé»˜è®¤æ˜¾ç¤ºçš„é¢˜ç›®æ•°é‡"
>
<InputNumber min={1} max={50} style={{ width: '100%' }} />
</Form.Item>
</Col>
<Col span={8}>
<Form.Item
name="expandedLimit"
label="å±•å¼€åæ˜¾ç¤ºæ¡æ•°"
rules={[{ required: true, message: 'è¯·è¾“å…¥å±•å¼€åæ˜¾ç¤ºæ¡æ•°' }]}
tooltip="ç‚¹å‡»â€œæ›´å¤šçƒ­é—¨é¢˜ç›®â€åæ˜¾ç¤ºçš„æ€»æ•°é‡"
>
<InputNumber min={1} max={100} style={{ width: '100%' }} />
</Form.Item>
</Col>
<Col span={8}>
<Form.Item label=" ">
<Button type="primary" htmlType="submit" loading={submitting}>
ä¿å­˜æ›´æ”¹
</Button>
</Form.Item>
</Col>
</Row>
</Form>
)}
</Card>
);
};
// File: apps\admin\src\ui\pages\QuestionEditorPage.tsx
import React, { useState, useEffect, useCallback } from 'react';
import { Form, Input, Select, Button, Card, message, Space, Breadcrumb, Tabs, Upload, List, Tag, Tooltip, InputNumber } from 'antd';
import { useNavigate, useParams, Link } from 'react-router-dom';
import { InboxOutlined, FileMarkdownOutlined, DeleteOutlined, CheckCircleOutlined, CloseCircleOutlined, LoadingOutlined } from '@ant-design/icons';
import MDEditor from '@uiw/react-md-editor';
import http from '../../lib/request';
import type { UploadFile } from 'antd/es/upload/interface';
const { Dragger } = Upload;
interface Category {
id: string;
name: string;
}
export const QuestionEditorPage: React.FC = () => {
const navigate = useNavigate();
const { id } = useParams<{ id: string }>();
const [form] = Form.useForm();
const [categories, setCategories] = useState<Category[]>([]);
const [loading, setLoading] = useState(false);
const [submitting, setSubmitting] = useState(false);
const [solution, setSolution] = useState<string>('');
const [transcript, setTranscript] = useState<string>('');
const [activeTab, setActiveTab] = useState('single');
const [batchCategoryId, setBatchCategoryId] = useState<string>();
const [fileList, setFileList] = useState<UploadFile[]>([]);
const [uploading, setUploading] = useState(false);
const [uploadProgress, setUploadProgress] = useState<{ [key: string]: 'pending' | 'success' | 'error' }>({});
const isEdit = !!id;
const fetchCategories = useCallback(async () => {
try {
const res = await http.get<Category[]>('/questions/categories');
setCategories(res);
} catch (error) {
console.error(error);
}
}, []);
const fetchQuestion = useCallback(async () => {
if (!id) return;
setLoading(true);
try {
const res = await http.get<any>(`/questions/${id}`);
form.setFieldsValue(res);
setSolution(res.solution || '');
setTranscript(res.transcript || '');
} catch (error) {
console.error(error);
message.error('åŠ è½½é¢˜ç›®å¤±è´¥');
} finally {
setLoading(false);
}
}, [id, form]);
useEffect(() => {
fetchCategories();
if (isEdit) {
fetchQuestion();
}
}, [fetchCategories, fetchQuestion, isEdit]);
const handleSubmit = async (values: any) => {
setSubmitting(true);
try {
const data = { ...values, solution, transcript };
if (isEdit) {
await http.patch(`/questions/${id}`, data);
message.success('æ›´æ–°æˆåŠŸ');
} else {
await http.post('/questions', data);
message.success('åˆ›å»ºæˆåŠŸ');
}
navigate('/questions');
} catch (error) {
console.error(error);
message.error('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
} finally {
setSubmitting(false);
}
};
const handleBatchImport = async () => {
if (!batchCategoryId) {
message.error('è¯·å…ˆé€‰æ‹©é¢˜ç›®åˆ†ç±»');
return;
}
if (fileList.length === 0) {
message.error('è¯·å…ˆä¸Šä¼ MDæ–‡ä»¶');
return;
}
setUploading(true);
let successCount = 0;
let failCount = 0;
const newProgress = { ...uploadProgress };
const groups: Record<string, { solutionFile?: UploadFile, transcriptFile?: UploadFile }> = {};
const getNormalizedTitle = (filename: string) => {
return filename.replace(/\.md$/i, '')
.replace(/_é€å­—ç¨¿$/, '')
.replace(/^\d+_/, '');
};
for (const file of fileList) {
const normalizedTitle = getNormalizedTitle(file.name);
if (!groups[normalizedTitle]) {
groups[normalizedTitle] = {};
}
if (file.name.includes('é€å­—ç¨¿')) {
groups[normalizedTitle].transcriptFile = file;
} else {
groups[normalizedTitle].solutionFile = file;
}
}
for (const [title, files] of Object.entries(groups)) {
const { solutionFile, transcriptFile } = files;
const relatedUids = [solutionFile?.uid, transcriptFile?.uid].filter(Boolean) as string[];
if (relatedUids.every(uid => newProgress[uid] === 'success')) continue;
relatedUids.forEach(uid => newProgress[uid] = 'pending');
setUploadProgress({ ...newProgress });
try {
let solution = '';
let transcript = '';
let interviewerQuestion = '';
if (solutionFile) {
const fileObj = (solutionFile as any).originFileObj || solutionFile;
solution = await fileObj.text();
}
if (transcriptFile) {
const fileObj = (transcriptFile as any).originFileObj || transcriptFile;
const text = await fileObj.text();
const questionMatch = text.match(/##\s*é¢è¯•å®˜æé—®\s*([\s\S]*?)(?=(##|$))/);
if (questionMatch && questionMatch[1]) {
interviewerQuestion = questionMatch[1].trim().replace(/^"|"$/g, '').trim();
}
const transcriptMatch = text.match(/##\s*é¢è¯•.*é€å­—ç¨¿.*\s*([\s\S]*)/);
if (transcriptMatch && transcriptMatch[1]) {
transcript = transcriptMatch[1].trim().replace(/^"|"$/g, '').trim();
} else {
const simpleMatch = text.match(/##\s*.*é€å­—ç¨¿.*\s*([\s\S]*)/);
if (simpleMatch && simpleMatch[1]) {
transcript = simpleMatch[1].trim().replace(/^"|"$/g, '').trim();
}
}
}
await http.post('/questions', {
title,
categoryId: batchCategoryId,
solution,
transcript,
interviewerQuestion
});
relatedUids.forEach(uid => newProgress[uid] = 'success');
successCount++;
} catch (error) {
console.error(`Failed to import group ${title}`, error);
relatedUids.forEach(uid => newProgress[uid] = 'error');
failCount++;
}
setUploadProgress({ ...newProgress });
}
setUploading(false);
message.success(`å¯¼å…¥å®Œæˆ: æˆåŠŸ ${successCount}, å¤±è´¥ ${failCount}`);
if (failCount === 0) {
message.info('æ‰€æœ‰é¢˜ç›®å¯¼å…¥æˆåŠŸï¼Œå³å°†è·³è½¬åˆ—è¡¨é¡µ');
setTimeout(() => navigate('/questions'), 1500);
}
};
const renderSingleForm = () => (
<Form
form={form}
layout="vertical"
onFinish={handleSubmit}
style={{ height: '100%', display: 'flex', flexDirection: 'column', gap: 16 }}
>
<div style={{ display: 'flex', gap: 16 }}>
<Form.Item
name="title"
label="é¢˜ç›®åç§°"
rules={[{ required: true, message: 'è¯·è¾“å…¥é¢˜ç›®åç§°' }]}
style={{ flex: 2 }}
>
<Input placeholder="è¯·è¾“å…¥é¢˜ç›®åç§°" />
</Form.Item>
<Form.Item
name="categoryId"
label="é¢˜ç›®åˆ†ç±»"
rules={[{ required: true, message: 'è¯·é€‰æ‹©åˆ†ç±»' }]}
style={{ flex: 1 }}
>
<Select placeholder="è¯·é€‰æ‹©åˆ†ç±»">
{categories.map(c => (
<Select.Option key={c.id} value={c.id}>{c.name}</Select.Option>
))}
</Select>
</Form.Item>
<Form.Item
name="hotScore"
label="çƒ­é—¨æŒ‡æ•°"
initialValue={0}
style={{ width: 120 }}
tooltip="æ•°å€¼è¶Šå¤§è¶Šé å‰ï¼Œç”¨äºçƒ­é—¨é¢˜ç›®åˆ—è¡¨æ’åº"
>
<InputNumber min={0} placeholder="0" style={{ width: '100%' }} />
</Form.Item>
</div>
<Form.Item
name="videoUrl"
label="è§†é¢‘è®²è§£é“¾æ¥"
>
<Input placeholder="è¯·è¾“å…¥è§†é¢‘é“¾æ¥ (MP4/WebM æˆ– YouTube é“¾æ¥)" />
</Form.Item>
<Form.Item
name="interviewerQuestion"
label="é¢è¯•å®˜æé—®å†…å®¹"
style={{ marginBottom: 16 }}
>
<Input.TextArea
rows={3}
placeholder="è¯·è¾“å…¥é¢è¯•å®˜æé—®å†…å®¹ï¼ˆé€‰å¡«ï¼‰"
style={{ resize: 'vertical' }}
/>
</Form.Item>
<div style={{ flex: 1, display: 'flex', flexDirection: 'column', minHeight: 0 }}>
<Tabs
defaultActiveKey="solution"
style={{ height: '100%', display: 'flex', flexDirection: 'column' }}
items={[
{
key: 'solution',
label: 'é¢˜è§£ (Markdown)',
children: (
<div style={{ height: '100%', border: '1px solid #d9d9d9', borderRadius: 8, overflow: 'hidden' }}>
<MDEditor
value={solution}
onChange={(val) => setSolution(val || '')}
height="100%"
preview="live"
/>
</div>
),
},
{
key: 'transcript',
label: 'é¢è¯•å›ç­”é€å­—ç¨¿ (Markdown)',
children: (
<div style={{ height: '100%', border: '1px solid #d9d9d9', borderRadius: 8, overflow: 'hidden' }}>
<MDEditor
value={transcript}
onChange={(val) => setTranscript(val || '')}
height="100%"
preview="live"
/>
</div>
),
},
]}
/>
</div>
<div style={{ textAlign: 'right', paddingTop: 16, borderTop: '1px solid #f0f0f0' }}>
<Space>
<Button onClick={() => navigate('/questions')}>å–æ¶ˆ</Button>
<Button type="primary" htmlType="submit" loading={submitting}>
{isEdit ? 'ä¿å­˜æ›´æ–°' : 'ç«‹å³åˆ›å»º'}
</Button>
</Space>
</div>
</Form>
);
const renderBatchForm = () => (
<div style={{ height: '100%', display: 'flex', flexDirection: 'column', gap: 24 }}>
<div style={{ maxWidth: 600 }}>
<div style={{ marginBottom: 8, fontWeight: 500 }}>é€‰æ‹©ç»Ÿä¸€åˆ†ç±»ï¼š</div>
<Select
placeholder="è¯·é€‰æ‹©æ‰€æœ‰é¢˜ç›®çš„åˆ†ç±»"
style={{ width: '40%' }}
value={batchCategoryId}
onChange={setBatchCategoryId}
>
{categories.map(c => (
<Select.Option key={c.id} value={c.id}>{c.name}</Select.Option>
))}
</Select>
</div>
<div style={{ flex: 1, display: 'flex', flexDirection: 'column', minHeight: 0, gap: 16 }}>
<Dragger
multiple
directory={false}
accept=".md"
showUploadList={false}
beforeUpload={(file) => {
setFileList(prev => [...prev, file]);
return false;
}}
style={{ padding: 20 }}
>
<p className="ant-upload-drag-icon">
<InboxOutlined />
</p>
<p className="ant-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ Markdown æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ </p>
<p className="ant-upload-hint">
æ”¯æŒæ‰¹é‡ä¸Šä¼ ï¼Œè‡ªåŠ¨åŒ¹é…åŒåé¢˜ç›®æ–‡ä»¶ï¼ˆå¦‚ï¼šxxx.md å’Œ xxx_é€å­—ç¨¿.mdï¼‰
</p>
</Dragger>
<div style={{ flex: 1, overflow: 'auto', border: '1px solid #f0f0f0', borderRadius: 8, padding: 8 }}>
<List
dataSource={fileList}
renderItem={(file) => {
const status = uploadProgress[file.uid];
return (
<List.Item
actions={[
status === 'pending' && <LoadingOutlined />,
status === 'success' && <CheckCircleOutlined style={{ color: '#52c41a' }} />,
status === 'error' && <CloseCircleOutlined style={{ color: '#ff4d4f' }} />,
!status && (
<Button
type="text"
danger
icon={<DeleteOutlined />}
onClick={() => {
setFileList(prev => prev.filter(f => f.uid !== file.uid));
const newProgress = { ...uploadProgress };
delete newProgress[file.uid];
setUploadProgress(newProgress);
}}
/>
)
]}
>
<List.Item.Meta
avatar={<FileMarkdownOutlined style={{ fontSize: 24, color: '#1677ff' }} />}
title={file.name}
description={
<Space>
<Tag>{((file.size || 0) / 1024).toFixed(1)} KB</Tag>
{status === 'success' && <Tag color="success">å¯¼å…¥æˆåŠŸ</Tag>}
{status === 'error' && <Tag color="error">å¯¼å…¥å¤±è´¥</Tag>}
</Space>
}
/>
</List.Item>
);
}}
/>
</div>
</div>
<div style={{ textAlign: 'right', paddingTop: 16, borderTop: '1px solid #f0f0f0' }}>
<Space>
<Button onClick={() => navigate('/questions')}>å–æ¶ˆ</Button>
<Button
type="primary"
onClick={handleBatchImport}
loading={uploading}
disabled={fileList.length === 0 || !batchCategoryId}
>
å¼€å§‹æ‰¹é‡å¯¼å…¥ ({fileList.length} ä¸ªæ–‡ä»¶)
</Button>
</Space>
</div>
</div>
);
return (
<div style={{ padding: 24, height: '100%', display: 'flex', flexDirection: 'column' }}>
<div style={{ marginBottom: 16 }}>
<Breadcrumb
items={[
{ title: <Link to="/dashboard">é¦–é¡µ</Link> },
{ title: <Link to="/questions">é¢˜åº“ç®¡ç†</Link> },
{ title: isEdit ? 'ç¼–è¾‘é¢˜ç›®' : 'å½•å…¥é¢˜ç›®' },
]}
/>
</div>
<Card
title={isEdit ? "ç¼–è¾‘é¢˜ç›®" : "å½•å…¥é¢˜ç›®"}
tabList={!isEdit ? [
{ key: 'single', tab: 'å•ä¸ªå½•å…¥' },
{ key: 'batch', tab: 'æ‰¹é‡å½•å…¥' }
] : undefined}
activeTabKey={activeTab}
onTabChange={key => setActiveTab(key)}
loading={loading}
style={{ flex: 1, display: 'flex', flexDirection: 'column' }}
styles={{ body: { flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' } }}
>
{isEdit ? renderSingleForm() : (
activeTab === 'single' ? renderSingleForm() : renderBatchForm()
)}
</Card>
</div>
);
};
// File: apps\admin\src\ui\pages\QuestionsPage.tsx
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { Table, Button, Space, Card, message, Popconfirm, Modal, InputNumber, Input, Select, Radio } from 'antd';
import { PlusOutlined, DeleteOutlined, EditOutlined, ExclamationCircleOutlined, SearchOutlined, ClearOutlined, SwapOutlined } from '@ant-design/icons';
import { useNavigate } from 'react-router-dom';
import http from '../../lib/request';
interface Category {
id: string;
name: string;
}
interface Question {
id: string;
title: string;
content?: string;
solution?: string;
transcript?: string;
interviewerQuestion?: string;
categoryId: string;
category?: Category;
hotScore?: number;
}
const HotScoreEditor: React.FC<{ id: string; score: number; onUpdate: (id: string, score: number) => Promise<void> }> = ({ id, score, onUpdate }) => {
const [value, setValue] = useState(score);
useEffect(() => {
setValue(score);
}, [score]);
const handleBlur = () => {
if (value !== score) {
onUpdate(id, value);
}
};
return (
<InputNumber
value={value}
onChange={(val) => setValue(val || 0)}
onBlur={handleBlur}
min={0}
style={{ width: 80 }}
/>
);
};
export const QuestionsPage: React.FC = () => {
const navigate = useNavigate();
const [questions, setQuestions] = useState<Question[]>([]);
const [loading, setLoading] = useState(false);
const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
const [searchText, setSearchText] = useState('');
const [clearing, setClearing] = useState(false);
const [isCleanModalOpen, setIsCleanModalOpen] = useState(false);
const [cleanType, setCleanType] = useState<'hotScore' | 'category'>('hotScore');
const [cleanThreshold, setCleanThreshold] = useState(0);
const [categories, setCategories] = useState<Category[]>([]);
const [selectedCategoryToClean, setSelectedCategoryToClean] = useState<string | null>(null);
const [selectedCategory, setSelectedCategory] = useState<string | null>(null);
const [isMoveModalOpen, setIsMoveModalOpen] = useState(false);
const [targetCategory, setTargetCategory] = useState<string | null>(null);
const [moving, setMoving] = useState(false);
const fetchCategories = useCallback(async () => {
try {
const res = await http.get<Category[]>('/questions/categories');
setCategories(res);
} catch (error) {
console.error(error);
}
}, []);
const fetchQuestions = useCallback(async () => {
setLoading(true);
try {
const res = await http.get<Question[]>('/questions');
setQuestions(res);
} catch (error) {
console.error(error);
} finally {
setLoading(false);
}
}, []);
useEffect(() => {
fetchQuestions();
fetchCategories();
}, [fetchQuestions, fetchCategories]);
const handleDelete = async (id: string) => {
try {
await http.delete(`/questions/${id}`);
message.success('åˆ é™¤æˆåŠŸ');
fetchQuestions();
} catch (error) {
console.error(error);
}
};
const handleUpdateHotScore = async (id: string, score: number) => {
try {
await http.patch(`/questions/${id}`, { hotScore: score });
message.success('çƒ­é—¨æŒ‡æ•°å·²æ›´æ–°');
fetchQuestions();
} catch (error) {
console.error(error);
message.error('æ›´æ–°å¤±è´¥');
}
};
const handleConfirmClean = async () => {
try {
setClearing(true);
let res: { count: number } | any;
if (cleanType === 'hotScore') {
res = await http.delete<{ count: number }>(`/questions/batch/by-score?threshold=${cleanThreshold}`);
} else {
if (!selectedCategoryToClean) return;
res = await http.delete<{ count: number }>(`/questions/batch/by-category?categoryId=${selectedCategoryToClean}`);
}
const count = res.count !== undefined ? res.count : res;
message.success(`å·²æˆåŠŸæ¸…ç† ${count} ä¸ªé¢˜ç›®`);
fetchQuestions();
setIsCleanModalOpen(false);
setSelectedCategoryToClean(null);
setCleanThreshold(0);
} catch (error) {
console.error(error);
message.error('æ¸…ç†å¤±è´¥');
} finally {
setClearing(false);
}
};
const handleBatchDelete = () => {
if (selectedRowKeys.length === 0) return;
Modal.confirm({
title: 'ç¡®è®¤æ‰¹é‡åˆ é™¤',
icon: <ExclamationCircleOutlined />,
content: `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedRowKeys.length} ä¸ªé¢˜ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,
onOk: async () => {
try {
setLoading(true);
await Promise.all(selectedRowKeys.map((id) => http.delete(`/questions/${id}`)));
message.success('æ‰¹é‡åˆ é™¤æˆåŠŸ');
setSelectedRowKeys([]);
fetchQuestions();
} catch (error) {
console.error(error);
message.error('åˆ é™¤è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
} finally {
setLoading(false);
}
},
});
};
const handleConfirmMove = async () => {
if (!targetCategory) return;
try {
setMoving(true);
await Promise.all(selectedRowKeys.map((id) => http.patch(`/questions/${id}`, { categoryId: targetCategory })));
message.success(`å·²æˆåŠŸç§»åŠ¨ ${selectedRowKeys.length} ä¸ªé¢˜ç›®`);
setSelectedRowKeys([]);
fetchQuestions();
setIsMoveModalOpen(false);
setTargetCategory(null);
} catch (error) {
console.error(error);
message.error('ç§»åŠ¨å¤±è´¥');
} finally {
setMoving(false);
}
};
const onSelectChange = (newSelectedRowKeys: React.Key[]) => {
setSelectedRowKeys(newSelectedRowKeys);
};
const rowSelection = {
selectedRowKeys,
onChange: onSelectChange,
};
const filteredQuestions = useMemo(() => {
let result = questions;
if (selectedCategory) {
result = result.filter(q => q.categoryId === selectedCategory);
}
if (searchText) {
result = result.filter(q =>
q.title.toLowerCase().includes(searchText.toLowerCase()) ||
q.category?.name.toLowerCase().includes(searchText.toLowerCase())
);
}
return result;
}, [questions, searchText, selectedCategory]);
const columns = [
{
title: 'åºå·',
key: 'index',
width: 80,
render: (_: unknown, __: Question, index: number) => index + 1,
},
{
title: 'ID',
dataIndex: 'id',
key: 'id',
width: 100,
render: (id: string) => <span title={id} style={{ fontFamily: 'monospace' }}>{id.substring(0, 6)}</span>,
},
{
title: 'é¢˜ç›®',
dataIndex: 'title',
key: 'title',
},
{
title: 'åˆ†ç±»',
dataIndex: ['category', 'name'],
key: 'category',
width: 150,
},
{
title: 'çƒ­é—¨æŒ‡æ•°',
dataIndex: 'hotScore',
key: 'hotScore',
width: 120,
sorter: (a: Question, b: Question) => (a.hotScore || 0) - (b.hotScore || 0),
render: (score: number, record: Question) => (
<HotScoreEditor
id={record.id}
score={score || 0}
onUpdate={handleUpdateHotScore}
/>
),
},
{
title: 'æ“ä½œ',
key: 'action',
width: 150,
render: (_: unknown, record: Question) => (
<Space size="middle">
<Button
type="text"
icon={<EditOutlined />}
onClick={() => navigate(`/questions/edit/${record.id}`)}
/>
<Popconfirm title="ç¡®å®šåˆ é™¤å—?" onConfirm={() => handleDelete(record.id)}>
<Button type="text" danger icon={<DeleteOutlined />} />
</Popconfirm>
</Space>
),
},
];
return (
<div style={{ padding: 24 }}>
<Modal
title="æ‰¹é‡æ¸…ç†é¢˜ç›®"
open={isCleanModalOpen}
onOk={handleConfirmClean}
onCancel={() => setIsCleanModalOpen(false)}
confirmLoading={clearing}
okText="ç¡®è®¤æ¸…ç†"
cancelText="å–æ¶ˆ"
okButtonProps={{
danger: true,
disabled: cleanType === 'category' && !selectedCategoryToClean
}}
>
<div style={{ marginBottom: 20 }}>
<Radio.Group
value={cleanType}
onChange={e => setCleanType(e.target.value)}
buttonStyle="solid"
>
<Radio.Button value="hotScore">æŒ‰çƒ­åº¦æ¸…ç†</Radio.Button>
<Radio.Button value="category">æŒ‰åˆ†ç±»æ¸…ç†</Radio.Button>
</Radio.Group>
</div>
{cleanType === 'hotScore' ? (
<>
<p>å°†åˆ é™¤çƒ­é—¨æŒ‡æ•°å°äºç­‰äºä»¥ä¸‹æ•°å€¼çš„æ‰€æœ‰é¢˜ç›®ï¼š</p>
<InputNumber
value={cleanThreshold}
onChange={(val) => setCleanThreshold(val || 0)}
min={0}
style={{ width: '100%' }}
/>
</>
) : (
<>
<p>è¯·é€‰æ‹©è¦æ¸…ç©ºçš„é¢˜ç›®åˆ†ç±»ï¼š</p>
<Select
style={{ width: '100%' }}
placeholder="é€‰æ‹©åˆ†ç±»"
value={selectedCategoryToClean}
onChange={setSelectedCategoryToClean}
options={categories.map(c => ({ label: c.name, value: c.id }))}
/>
</>
)}
<p style={{ marginTop: 8, color: '#ff4d4f', fontSize: 12 }}>
<ExclamationCircleOutlined /> æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚
</p>
</Modal>
<Modal
title="æ‰¹é‡ç§»åŠ¨åˆ†ç±»"
open={isMoveModalOpen}
onOk={handleConfirmMove}
onCancel={() => setIsMoveModalOpen(false)}
confirmLoading={moving}
okText="ç¡®è®¤ç§»åŠ¨"
cancelText="å–æ¶ˆ"
okButtonProps={{ disabled: !targetCategory }}
>
<p>è¯·é€‰æ‹©è¦ç§»åŠ¨åˆ°çš„ç›®æ ‡åˆ†ç±»ï¼š</p>
<Select
style={{ width: '100%' }}
placeholder="é€‰æ‹©ç›®æ ‡åˆ†ç±»"
value={targetCategory}
onChange={setTargetCategory}
options={categories.map(c => ({ label: c.name, value: c.id }))}
/>
</Modal>
<Card
title="é¢˜ç›®åˆ—è¡¨"
extra={
<Space>
<Select
style={{ width: 150 }}
placeholder="ç­›é€‰åˆ†ç±»"
allowClear
value={selectedCategory}
onChange={setSelectedCategory}
options={categories.map(c => ({ label: c.name, value: c.id }))}
/>
<Input
placeholder="æœç´¢é¢˜ç›®"
prefix={<SearchOutlined />}
value={searchText}
onChange={e => setSearchText(e.target.value)}
style={{ width: 200 }}
allowClear
/>
{selectedRowKeys.length > 0 && (
<>
<Button
icon={<SwapOutlined />}
onClick={() => setIsMoveModalOpen(true)}
>
æ‰¹é‡ç§»åŠ¨ ({selectedRowKeys.length})
</Button>
<Button
danger
icon={<DeleteOutlined />}
onClick={handleBatchDelete}
>
æ‰¹é‡åˆ é™¤ ({selectedRowKeys.length})
</Button>
</>
)}
<Button
icon={<DeleteOutlined />}
loading={clearing}
onClick={() => {
setCleanType('hotScore');
setCleanThreshold(0);
setSelectedCategoryToClean(null);
setIsCleanModalOpen(true);
}}
>
æ‰¹é‡æ¸…ç†
</Button>
<Button
type="primary"
icon={<PlusOutlined />}
onClick={() => navigate('/questions/create')}
>
å½•å…¥é¢˜ç›®
</Button>
</Space>
}
>
<Table
rowSelection={rowSelection}
columns={columns}
dataSource={filteredQuestions}
rowKey="id"
loading={loading}
pagination={{
showSizeChanger: true,
showQuickJumper: true,
showTotal: (total) => `å…± ${total} æ¡`,
}}
/>
</Card>
</div>
);
};
// File: apps\admin\src\ui\pages\UsersPage.tsx
import React, { useState, useEffect } from "react";
import { Button, Space, Table, Typography, message, Popconfirm } from "antd";
import http from "../../lib/request";
type UserRow = {
id: string;
email: string;
name?: string;
createdAt: string;
emailVerified: boolean;
accounts?: { providerId: string }[];
};
export function UsersPage() {
const [dataSource, setDataSource] = useState<UserRow[]>([]);
const [loading, setLoading] = useState(false);
useEffect(() => {
fetchUsers();
}, []);
const fetchUsers = async () => {
setLoading(true);
try {
const res = await http.get<UserRow[]>("/users");
setDataSource(res);
} catch (error) {
console.error(error);
message.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥");
} finally {
setLoading(false);
}
};
const handleDelete = async (id: string) => {
try {
await http.delete(`/users/${id}`);
message.success("åˆ é™¤æˆåŠŸ");
fetchUsers();
} catch (error) {
console.error(error);
message.error("åˆ é™¤å¤±è´¥");
}
};
return (
<div>
<Space style={{ width: "100%", justifyContent: "space-between" }}>
<Typography.Title level={3} style={{ marginTop: 0 }}>
ç”¨æˆ·
</Typography.Title>
<Button type="primary">æ–°å¢ç”¨æˆ·</Button>
</Space>
<Table<UserRow>
loading={loading}
rowKey="id"
style={{ marginTop: 16 }}
dataSource={dataSource}
columns={[
{ title: "ID", dataIndex: "id", width: 100, ellipsis: true },
{ title: "ç”¨æˆ·å", dataIndex: "name" },
{
title: "æ³¨å†Œæ¸ é“",
dataIndex: "accounts",
render: (accounts: { providerId: string }[]) => {
if (!accounts || accounts.length === 0) return <Typography.Text type="secondary">æœªçŸ¥</Typography.Text>;
const providerMap: Record<string, string> = {
'credential': 'é‚®ç®±æ³¨å†Œ',
'email': 'é‚®ç®±æ³¨å†Œ',
'github': 'GitHub',
'google': 'Google',
};
const providers = Array.from(new Set(accounts.map(a => a.providerId)));
return providers.map(p => providerMap[p] || p).join(", ");
}
},
{ title: "é‚®ç®±", dataIndex: "email" },
{
title: "é‚®ç®±éªŒè¯",
dataIndex: "emailVerified",
render: (verified: boolean) => verified ? "å·²éªŒè¯" : "æœªéªŒè¯"
},
{
title: "åˆ›å»ºæ—¶é—´",
dataIndex: "createdAt",
render: (date: string) => new Date(date).toLocaleString()
},
{
title: "æ“ä½œ",
key: "action",
render: (_, record) => (
<Popconfirm
title="ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿ"
description="åˆ é™¤åæ— æ³•æ¢å¤"
onConfirm={() => handleDelete(record.id)}
okText="ç¡®å®š"
cancelText="å–æ¶ˆ"
>
<Button type="link" danger>
åˆ é™¤
</Button>
</Popconfirm>
),
},
]}
/>
</div>
);
}
// File: apps\api\src\app.module.ts
import { Module } from "@nestjs/common";
import { ConfigModule } from "@nestjs/config";
import { HealthController } from "./health/health.controller";
import { UsersModule } from "./users/users.module";
import { PrismaModule } from "./prisma/prisma.module";
import { AuthModule } from "./auth/auth.module";
import { QuestionsModule } from "./questions/questions.module";
import { FavoritesModule } from "./favorites/favorites.module";
import { SystemModule } from "./system/system.module";
import { NotesModule } from "./notes/notes.module";
@Module({
imports: [
ConfigModule.forRoot({ isGlobal: true }),
PrismaModule,
UsersModule,
AuthModule,
QuestionsModule,
FavoritesModule,
SystemModule,
NotesModule,
],
controllers: [HealthController],
})
export class AppModule {}
// File: apps\api\src\auth\auth.config.ts
import "dotenv/config";
import { PrismaClient } from "@prisma/client";
const prisma = new PrismaClient();
let authInstance: any;
const dynamicImport = new Function("specifier", "return import(specifier)");
export async function getAuth() {
console.log("âœ¨ [AuthConfig] Initializing new Better-Auth instance...");
const { betterAuth } = await dynamicImport("better-auth");
const { prismaAdapter } = await dynamicImport("better-auth/adapters/prisma");
const { APIError, createAuthMiddleware } = await dynamicImport("better-auth/api");
if (process.env.PROXY_HOST && process.env.PROXY_PORT) {
try {
const { setGlobalDispatcher, ProxyAgent } = await dynamicImport("undici");
const proxyUrl = `http:
const dispatcher = new ProxyAgent(proxyUrl);
setGlobalDispatcher(dispatcher);
console.log(`ğŸŒ Global Fetch Proxy Configured: ${proxyUrl}`);
} catch (error) {
console.warn("   âš ï¸ Failed to configure global proxy with undici:", error);
}
}
authInstance = betterAuth({
appName: "BigFedCamp",
logger: {
level: "debug",
disabled: false,
},
database: prismaAdapter(prisma, {
provider: "mongodb",
}),
baseURL: process.env.BETTER_AUTH_URL || "http:
databaseHooks: {
user: {
create: {
before: async (user: any) => {
console.log("ğŸ“ [DB Hook] Creating user, setting emailVerified=true");
return {
...user,
emailVerified: true
}
},
after: async (user: any) => {
console.log(`âœ… [DB Hook] User created: ${user.email}, ensuring emailVerified=true`);
if (!user.emailVerified) {
await prisma.user.update({
where: { id: user.id },
data: { emailVerified: true }
});
console.log("   ğŸ”„ Force updated emailVerified to true");
}
}
}
},
},
hooks: {
before: createAuthMiddleware(async (ctx: any) => {
if (ctx.path === "/sign-up/email") {
console.log("ğŸ›‘ [AuthHook] Intercepting SignUp...");
const body = ctx.body as any;
const email = body?.email;
const otp = body?.otp;
if (!email) return;
console.log(`   Checking OTP for ${email}: ${otp}`);
if (!otp) {
throw new APIError("BAD_REQUEST", { message: "Verification code is required" });
}
const validCode = await prisma.verificationCode.findFirst({
where: {
email,
code: otp,
expiresAt: { gt: new Date() }
}
});
if (!validCode) {
throw new APIError("BAD_REQUEST", { message: "Invalid or expired verification code" });
}
await prisma.verificationCode.delete({ where: { id: validCode.id } });
console.log("âœ… OTP Verified! Proceeding with registration.");
return {
context: {
...ctx,
otpVerified: true
}
};
}
}),
},
emailAndPassword: {
enabled: true,
autoSignIn: true,
requireEmailVerification: false,
},
plugins: [],
socialProviders: {
github: {
clientId: process.env.GITHUB_CLIENT_ID as string,
clientSecret: process.env.GITHUB_CLIENT_SECRET as string,
},
},
trustedOrigins: [
process.env.FRONTEND_URL || "http:
"http:
"http:
"http:
"http:
"https:
"https:
"https:
"http:
"http:
],
});
return authInstance;
}
// File: apps\api\src\auth\auth.controller.ts
import { All, Controller, Post, Body, Req, Res, HttpException, HttpStatus } from "@nestjs/common";
import { getAuth } from "./auth.config";
import { Request, Response } from "express";
import { PrismaClient } from "@prisma/client";
import * as nodemailer from "nodemailer";
import { SocksClient } from 'socks';
const dynamicImport = new Function("specifier", "return import(specifier)");
const prisma = new PrismaClient();
@Controller("api/auth")
export class AuthController {
@Post("send-otp")
async sendOtp(@Body() body: { email: string }, @Res() res: Response) {
const { email } = body;
if (!email) {
return res.status(400).json({ error: "Email is required" });
}
console.log(`ğŸ“¨ [SendOTP] Requesting OTP for ${email}`);
const code = Math.floor(100000 + Math.random() * 900000).toString();
const expiresAt = new Date(Date.now() + 10 * 60 * 1000);
try {
await prisma.verificationCode.create({
data: {
email,
code,
expiresAt
}
});
const smtpPort = Number(process.env.SMTP_PORT) || 587;
const isSecure = smtpPort === 465;
const transporterConfig: any = {
host: process.env.SMTP_HOST || "smtp.gmail.com",
port: smtpPort,
secure: isSecure,
auth: {
user: process.env.SMTP_USER,
pass: process.env.SMTP_PASS,
},
debug: true,
logger: true,
tls: {
rejectUnauthorized: false
},
connectionTimeout: 30000,
socketTimeout: 30000
};
const proxyHost = process.env.PROXY_HOST;
const proxyPort = process.env.PROXY_PORT;
if (proxyHost && proxyPort) {
console.log(`ğŸ“§ [SendOTP] Configuring Proxy via SocksClient: ${proxyHost}:${proxyPort}`);
transporterConfig.getSocket = (options: any, callback: any) => {
console.log(`ğŸ”Œ [SendOTP] establishing socks proxy connection to ${options.host}:${options.port}...`);
const socksOptions: any = {
proxy: {
host: proxyHost,
port: Number(proxyPort),
type: 5
},
command: 'connect',
destination: {
host: options.host,
port: options.port
}
};
SocksClient.createConnection(socksOptions)
.then((info) => {
console.log(`âœ… [SendOTP] Socks proxy connection established.`);
info.socket.once('close', (hadError) => {
if (hadError) {
console.log(`âš ï¸ [SendOTP] Proxy socket closed with error. If this happens immediately during handshake, your VPN likely blocks SMTP ports (465/587).`);
}
});
callback(null, { connection: info.socket });
})
.catch((err) => {
console.error(`âŒ [SendOTP] Socks proxy connection failed:`, err);
callback(err);
});
};
} else {
console.log(`âš ï¸ [SendOTP] No proxy configured (PROXY_HOST/PORT missing). Env: ${JSON.stringify(process.env.PROXY_HOST)}`);
}
const transporter = nodemailer.createTransport(transporterConfig);
await transporter.sendMail({
from: `"${process.env.SMTP_FROM_NAME || 'å¤§å‰ç«¯åŒå­¦è¥'}" <${process.env.SMTP_USER}>`,
to: email,
subject: "ã€å¤§å‰ç«¯åŒå­¦è¥ã€‘æ³¨å†ŒéªŒè¯ç ",
html: `
<div style="font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
<h2>æ³¨å†ŒéªŒè¯ç </h2>
<p>æ‚¨çš„éªŒè¯ç æ˜¯ï¼š</p>
<h1 style="color: #d97757; letter-spacing: 5px; background: #f5f5f5; padding: 10px; display: inline-block; border-radius: 5px;">${code}</h1>
<p>è¯¥éªŒè¯ç å°†åœ¨ 10 åˆ†é’Ÿåè¿‡æœŸã€‚</p>
<p style="color: #999; font-size: 12px;">å¦‚æœæ‚¨æ²¡æœ‰è¯·æ±‚æ­¤éªŒè¯ç ï¼Œè¯·å¿½ç•¥æ­¤é‚®ä»¶ã€‚</p>
</div>
`
});
console.log(`âœ… [SendOTP] Code sent to ${email}`);
return res.status(200).json({ success: true, message: "Verification code sent" });
} catch (error: any) {
console.error("âŒ [SendOTP] Failed:", error);
return res.status(500).json({ error: "Failed to send verification code", details: error.message });
}
}
@All("*splat")
async handleAuth(@Req() req: Request, @Res() res: Response) {
console.log(`ğŸ“¥ [AuthController] Request: ${req.method} ${req.url}`);
try {
const auth = await getAuth();
const { toNodeHandler } = await dynamicImport("better-auth/node");
return toNodeHandler(auth)(req, res);
} catch (error) {
console.error("âŒ [AuthController] Error handling auth request:", error);
res.status(500).json({ error: "Internal Server Error in Auth" });
}
}
}
// File: apps\api\src\auth\auth.module.ts
import { Module } from '@nestjs/common';
import { AuthController } from './auth.controller';
@Module({
controllers: [AuthController],
})
export class AuthModule {}
// File: apps\api\src\favorites\favorites.controller.ts
import { Controller, Post, Get, Param, Req, UnauthorizedException } from '@nestjs/common';
import { FavoritesService } from './favorites.service';
import { Request } from 'express';
import { getAuth } from '../auth/auth.config';
@Controller('favorites')
export class FavoritesController {
constructor(private readonly favoritesService: FavoritesService) {}
private async getUser(req: Request) {
const auth = await getAuth();
const session = await auth.api.getSession({
headers: req.headers,
});
if (!session) {
throw new UnauthorizedException('User not authenticated');
}
return session.user;
}
@Post(':questionId')
async toggleFavorite(@Param('questionId') questionId: string, @Req() req: Request) {
const user = await this.getUser(req);
return this.favoritesService.toggleFavorite(user.id, questionId);
}
@Get(':questionId/check')
async checkFavorite(@Param('questionId') questionId: string, @Req() req: Request) {
const user = await this.getUser(req);
return this.favoritesService.checkFavorite(user.id, questionId);
}
@Get()
async getFavorites(@Req() req: Request) {
const user = await this.getUser(req);
return this.favoritesService.getFavorites(user.id);
}
}
// File: apps\api\src\favorites\favorites.module.ts
import { Module } from '@nestjs/common';
import { FavoritesService } from './favorites.service';
import { FavoritesController } from './favorites.controller';
import { PrismaModule } from '../prisma/prisma.module';
import { QuestionsModule } from '../questions/questions.module';
@Module({
imports: [PrismaModule, QuestionsModule],
controllers: [FavoritesController],
providers: [FavoritesService],
})
export class FavoritesModule {}
// File: apps\api\src\favorites\favorites.service.ts
import { Injectable } from '@nestjs/common';
import { PrismaService } from '../prisma/prisma.service';
import { QuestionsService } from '../questions/questions.service';
@Injectable()
export class FavoritesService {
constructor(
private readonly prisma: PrismaService,
private readonly questionsService: QuestionsService
) {}
async toggleFavorite(userId: string, questionId: string) {
const existing = await this.prisma.favorite.findUnique({
where: {
userId_questionId: {
userId,
questionId,
},
},
});
let result;
if (existing) {
await this.prisma.favorite.delete({
where: {
id: existing.id,
},
});
result = { isFavorite: false };
} else {
await this.prisma.favorite.create({
data: {
userId,
questionId,
},
});
result = { isFavorite: true };
}
this.questionsService.updateHotScore(questionId).catch(err =>
console.error(`Failed to update hot score for ${questionId} after favorite toggle`, err)
);
return result;
}
async checkFavorite(userId: string, questionId: string) {
const existing = await this.prisma.favorite.findUnique({
where: {
userId_questionId: {
userId,
questionId,
},
},
});
return { isFavorite: !!existing };
}
async getFavorites(userId: string) {
return this.prisma.favorite.findMany({
where: {
userId,
},
include: {
question: {
include: {
category: true,
}
},
},
orderBy: {
createdAt: 'desc',
},
});
}
}
// File: apps\api\src\health\health.controller.ts
import { Controller, Get } from "@nestjs/common";
@Controller("health")
export class HealthController {
@Get()
health() {
return { ok: true };
}
}
// File: apps\api\src\main.ts
import "reflect-metadata";
import { ValidationPipe } from "@nestjs/common";
import { NestFactory } from "@nestjs/core";
import { AppModule } from "./app.module";
try {
const { setGlobalDispatcher, ProxyAgent } = require("undici");
if (process.env.PROXY_HOST && process.env.PROXY_PORT) {
const proxyUrl = `http:
const dispatcher = new ProxyAgent(proxyUrl);
setGlobalDispatcher(dispatcher);
console.log(`Global proxy set to ${proxyUrl}`);
}
} catch (error) {
console.warn("Failed to set global proxy with undici. If you are behind a proxy, GitHub login might fail.", error);
}
async function bootstrap() {
const app = await NestFactory.create(AppModule);
const allowedOrigins = [
"http:
"http:
"http:
"http:
"https:
"https:
"https:
"http:
"http:
...(process.env.ALLOWED_ORIGINS ? process.env.ALLOWED_ORIGINS.split(",") : []),
];
app.enableCors({
origin: allowedOrigins,
credentials: true,
});
app.use((req: any, res: any, next: any) => {
console.log(`ğŸŒ [Global] ${req.method} ${req.originalUrl}`);
next();
});
app.useGlobalPipes(new ValidationPipe({ whitelist: true, transform: true }));
const port = Number(process.env.PORT ?? 3002);
await app.listen(port);
}
void bootstrap();
// File: apps\api\src\notes\notes.controller.ts
import { Controller, Get, Post, Patch, Delete, Body, Param, Req, UnauthorizedException } from '@nestjs/common';
import { NotesService } from './notes.service';
import { Request } from 'express';
import { getAuth } from '../auth/auth.config';
@Controller('notes')
export class NotesController {
constructor(private readonly notesService: NotesService) {}
private async getUser(req: Request) {
const auth = await getAuth();
const session = await auth.api.getSession({
headers: req.headers,
});
if (!session) {
throw new UnauthorizedException('User not authenticated');
}
return session.user;
}
@Get()
async getNotes(@Req() req: Request) {
const user = await this.getUser(req);
return this.notesService.getUserNotes(user.id);
}
@Post()
async createNote(@Req() req: Request, @Body() body: { content: string }) {
const user = await this.getUser(req);
return this.notesService.createNote(user.id, body.content);
}
@Patch(':id')
async updateNote(
@Req() req: Request,
@Param('id') id: string,
@Body() body: { content: string }
) {
const user = await this.getUser(req);
return this.notesService.updateNote(user.id, id, body.content);
}
@Delete(':id')
async deleteNote(@Req() req: Request, @Param('id') id: string) {
const user = await this.getUser(req);
return this.notesService.deleteNote(user.id, id);
}
}
// File: apps\api\src\notes\notes.module.ts
import { Module } from '@nestjs/common';
import { NotesController } from './notes.controller';
import { NotesService } from './notes.service';
@Module({
controllers: [NotesController],
providers: [NotesService],
exports: [NotesService],
})
export class NotesModule {}
// File: apps\api\src\notes\notes.service.ts
import { Injectable } from '@nestjs/common';
import { PrismaService } from '../prisma/prisma.service';
import * as crypto from 'crypto';
@Injectable()
export class NotesService {
private readonly algorithm = 'aes-256-cbc';
private readonly key = crypto.scryptSync(
process.env.ENCRYPTION_KEY || 'default-secret-key-please-change-in-production',
'salt',
32
);
constructor(private prisma: PrismaService) {}
private encrypt(text: string): { content: string; iv: string } {
const iv = crypto.randomBytes(16);
const cipher = crypto.createCipheriv(this.algorithm, this.key, iv);
let encrypted = cipher.update(text, 'utf8', 'hex');
encrypted += cipher.final('hex');
return { content: encrypted, iv: iv.toString('hex') };
}
private decrypt(encrypted: string, ivHex: string): string {
const iv = Buffer.from(ivHex, 'hex');
const decipher = crypto.createDecipheriv(this.algorithm, this.key, iv);
let decrypted = decipher.update(encrypted, 'hex', 'utf8');
decrypted += decipher.final('utf8');
return decrypted;
}
async getUserNotes(userId: string) {
const notes = await this.prisma.note.findMany({
where: { userId },
orderBy: { updatedAt: 'desc' },
});
return notes.map(note => ({
...note,
content: this.decrypt(note.content, note.iv),
}));
}
async createNote(userId: string, content: string) {
const { content: encryptedContent, iv } = this.encrypt(content);
return this.prisma.note.create({
data: {
userId,
content: encryptedContent,
iv: iv,
},
});
}
async updateNote(userId: string, noteId: string, content: string) {
const { content: encryptedContent, iv } = this.encrypt(content);
return this.prisma.note.update({
where: { id: noteId, userId },
data: {
content: encryptedContent,
iv: iv,
},
});
}
async deleteNote(userId: string, noteId: string) {
return this.prisma.note.delete({
where: { id: noteId, userId },
});
}
}
// File: apps\api\src\prisma\prisma.module.ts
import { Module, Global } from '@nestjs/common';
import { PrismaService } from './prisma.service';
@Global()
@Module({
providers: [PrismaService],
exports: [PrismaService],
})
export class PrismaModule {}
// File: apps\api\src\prisma\prisma.service.ts
import { Injectable, OnModuleInit, OnModuleDestroy } from '@nestjs/common';
import { PrismaClient } from '@prisma/client';
@Injectable()
export class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy {
async onModuleInit() {
await this.$connect();
}
async onModuleDestroy() {
await this.$disconnect();
}
}
// File: apps\api\src\questions\dto\create-question.dto.ts
import { IsNotEmpty, IsOptional, IsString, IsNumber } from "class-validator";
export class CreateQuestionCategoryDto {
@IsString()
@IsNotEmpty()
name!: string;
@IsString()
@IsOptional()
description?: string;
}
export class CreateQuestionDto {
@IsString()
@IsNotEmpty()
title!: string;
@IsString()
@IsOptional()
content?: string;
@IsString()
@IsOptional()
solution?: string;
@IsString()
@IsOptional()
transcript?: string;
@IsString()
@IsOptional()
interviewerQuestion?: string;
@IsString()
@IsNotEmpty()
categoryId!: string;
@IsNumber()
@IsOptional()
hotScore?: number;
@IsString()
@IsOptional()
videoUrl?: string;
}
// File: apps\api\src\questions\questions.controller.ts
import { Controller, Get, Post, Body, Patch, Param, Delete, Query } from '@nestjs/common';
import { QuestionsService } from './questions.service';
import { CreateQuestionDto, CreateQuestionCategoryDto } from './dto/create-question.dto';
@Controller('questions')
export class QuestionsController {
constructor(private readonly questionsService: QuestionsService) {}
@Post('categories')
createCategory(@Body() createCategoryDto: CreateQuestionCategoryDto) {
return this.questionsService.createCategory(createCategoryDto);
}
@Delete('categories/:id')
removeCategory(@Param('id') id: string) {
return this.questionsService.removeCategory(id);
}
@Get('categories')
findAllCategories() {
return this.questionsService.findAllCategories();
}
@Post()
create(@Body() createQuestionDto: CreateQuestionDto) {
return this.questionsService.createQuestion(createQuestionDto);
}
@Get()
findAll() {
return this.questionsService.findAllQuestions();
}
@Get(':id')
findOne(@Param('id') id: string) {
return this.questionsService.findOneQuestion(id);
}
@Patch(':id')
update(@Param('id') id: string, @Body() updateQuestionDto: Partial<CreateQuestionDto>) {
return this.questionsService.updateQuestion(id, updateQuestionDto);
}
@Delete('batch/by-score')
removeByScore(@Query('threshold') threshold: string) {
const limit = parseInt(threshold, 10) || 0;
return this.questionsService.removeQuestionsByHotScoreThreshold(limit);
}
@Delete('batch/by-category')
removeByCategory(@Query('categoryId') categoryId: string) {
return this.questionsService.removeQuestionsByCategory(categoryId);
}
@Delete(':id')
remove(@Param('id') id: string) {
return this.questionsService.removeQuestion(id);
}
}
// File: apps\api\src\questions\questions.module.ts
import { Module } from '@nestjs/common';
import { QuestionsService } from './questions.service';
import { QuestionsController } from './questions.controller';
import { PrismaModule } from '../prisma/prisma.module';
@Module({
imports: [PrismaModule],
controllers: [QuestionsController],
providers: [QuestionsService],
exports: [QuestionsService],
})
export class QuestionsModule {}
// File: apps\api\src\questions\questions.service.ts
import { Injectable } from '@nestjs/common';
import { PrismaService } from '../prisma/prisma.service';
import { CreateQuestionDto, CreateQuestionCategoryDto } from './dto/create-question.dto';
@Injectable()
export class QuestionsService {
constructor(private prisma: PrismaService) {}
async createCategory(data: CreateQuestionCategoryDto) {
return this.prisma.questionCategory.create({
data,
});
}
async removeCategory(id: string) {
const count = await this.prisma.question.count({
where: { categoryId: id },
});
if (count > 0) {
throw new Error('Cannot delete category with associated questions');
}
return this.prisma.questionCategory.delete({
where: { id },
});
}
async findAllCategories() {
try {
const categories = await this.prisma.questionCategory.findMany();
if (categories.length === 0) {
return this.getMockCategories();
}
return categories;
} catch (error) {
console.error("Failed to fetch categories from DB, falling back to mock data:", error);
return this.getMockCategories();
}
}
private getMockCategories() {
return [
{ id: "mock-cat-1", name: "HTML" },
{ id: "mock-cat-2", name: "CSS" },
{ id: "mock-cat-3", name: "JavaScript" },
{ id: "mock-cat-4", name: "React" },
{ id: "mock-cat-5", name: "Vue" },
{ id: "mock-cat-6", name: "Performance" },
];
}
async createQuestion(data: CreateQuestionDto) {
return this.prisma.question.create({
data,
});
}
async findAllQuestions() {
try {
const questions = await this.prisma.question.findMany({
include: {
category: true,
},
orderBy: [
{ hotScore: 'desc' },
{ createdAt: 'desc' },
],
});
if (questions.length === 0) {
return this.getMockQuestions();
}
return questions;
} catch (error) {
console.error("Failed to fetch questions from DB, falling back to mock data:", error);
return this.getMockQuestions();
}
}
private getMockQuestions() {
return [
{
id: "mock-q-1",
title: "What is a closure in JavaScript?",
categoryId: "mock-cat-3",
category: { id: "mock-cat-3", name: "JavaScript" },
content: "Explain the concept of closure.",
solution: "A closure is the combination of a function bundled together (enclosed) with references to its surrounding state (the lexical environment).",
transcript: null
},
{
id: "mock-q-2",
title: "Explain CSS Box Model",
categoryId: "mock-cat-2",
category: { id: "mock-cat-2", name: "CSS" },
content: "What are the components of the box model?",
solution: "Content, Padding, Border, Margin.",
transcript: null
},
{
id: "mock-q-3",
title: "React useEffect dependency array",
categoryId: "mock-cat-4",
category: { id: "mock-cat-4", name: "React" },
content: "When does useEffect run?",
solution: "It runs after render. Dependencies control when it re-runs.",
transcript: null
},
];
}
async findOneQuestion(id: string) {
if (id.startsWith("mock-q-")) {
const mockQuestions = this.getMockQuestions();
return mockQuestions.find(q => q.id === id);
}
try {
this.incrementViewCount(id).catch(err => console.error(`Failed to increment view count for ${id}`, err));
return await this.prisma.question.findUnique({
where: { id },
include: {
category: true,
},
});
} catch (error) {
console.error(`Failed to fetch question ${id} from DB:`, error);
throw error;
}
}
async incrementViewCount(id: string) {
try {
const question = await this.prisma.question.update({
where: { id },
data: { viewCount: { increment: 1 } },
});
await this.updateHotScore(id);
} catch (error) {
console.error(`Error incrementing view count for ${id}:`, error);
}
}
async updateHotScore(id: string) {
try {
const question = await this.prisma.question.findUnique({
where: { id },
include: {
_count: {
select: { favorites: true },
},
},
});
if (!question) return;
const views = question.viewCount || 0;
const favorites = question['_count']?.favorites || 0;
const score = views + (favorites * 10);
await this.prisma.question.update({
where: { id },
data: { hotScore: score },
});
} catch (error) {
console.error(`Error updating hot score for ${id}:`, error);
}
}
async updateQuestion(id: string, data: Partial<CreateQuestionDto>) {
return this.prisma.question.update({
where: { id },
data,
});
}
async removeQuestion(id: string) {
return this.prisma.question.delete({
where: { id },
});
}
private async deleteQuestionsByIds(ids: string[]) {
if (ids.length === 0) {
return { count: 0 };
}
return this.prisma.$transaction(async (tx) => {
await tx.favorite.deleteMany({
where: {
questionId: { in: ids },
},
});
return tx.question.deleteMany({
where: {
id: { in: ids },
},
});
});
}
async removeQuestionsByHotScoreThreshold(threshold: number) {
const questions = await this.prisma.question.findMany({
where: { hotScore: { lte: threshold } },
select: { id: true },
});
const ids = questions.map(q => q.id);
return this.deleteQuestionsByIds(ids);
}
async removeQuestionsByCategory(categoryId: string) {
const questions = await this.prisma.question.findMany({
where: { categoryId },
select: { id: true },
});
const ids = questions.map(q => q.id);
return this.deleteQuestionsByIds(ids);
}
}
// File: apps\api\src\system\dto\update-config.dto.ts
import { IsString, IsNotEmpty } from 'class-validator';
export class UpdateConfigDto {
@IsString()
@IsNotEmpty()
value!: string;
}
// File: apps\api\src\system\system.controller.ts
import { Controller, Get, Post, Body, Param } from '@nestjs/common';
import { SystemService } from './system.service';
import { UpdateConfigDto } from './dto/update-config.dto';
@Controller('system')
export class SystemController {
constructor(private readonly systemService: SystemService) {}
@Get('config')
getAllConfigs() {
return this.systemService.getAllConfigs();
}
@Get('config/:key')
getConfig(@Param('key') key: string) {
return this.systemService.getConfig(key);
}
@Post('config/:key')
setConfig(@Param('key') key: string, @Body() dto: UpdateConfigDto) {
return this.systemService.setConfig(key, dto.value);
}
}
// File: apps\api\src\system\system.module.ts
import { Module } from '@nestjs/common';
import { SystemController } from './system.controller';
import { SystemService } from './system.service';
import { PrismaModule } from '../prisma/prisma.module';
@Module({
imports: [PrismaModule],
controllers: [SystemController],
providers: [SystemService],
})
export class SystemModule {}
// File: apps\api\src\system\system.service.ts
import { Injectable } from '@nestjs/common';
import { PrismaService } from '../prisma/prisma.service';
@Injectable()
export class SystemService {
constructor(private prisma: PrismaService) {}
async getConfig(key: string) {
const config = await this.prisma.systemConfig.findUnique({
where: { key },
});
return config ? config.value : null;
}
async getAllConfigs() {
return this.prisma.systemConfig.findMany();
}
async setConfig(key: string, value: string) {
return this.prisma.systemConfig.upsert({
where: { key },
update: { value },
create: { key, value },
});
}
}
// File: apps\api\src\users\dto\create-user.dto.ts
import { IsEmail } from "class-validator";
export class CreateUserDto {
@IsEmail()
email!: string;
}
// File: apps\api\src\users\users.controller.ts
import { Body, Controller, Get, Post, Delete, Param, Patch } from "@nestjs/common";
import { CreateUserDto } from "./dto/create-user.dto";
import { UsersService } from "./users.service";
@Controller("users")
export class UsersController {
constructor(private readonly usersService: UsersService) {}
@Get('stats')
getStats() {
return this.usersService.getDashboardStats();
}
@Get()
findAll() {
return this.usersService.findAll();
}
@Post()
create(@Body() dto: CreateUserDto) {
return this.usersService.create(dto);
}
@Patch(':id')
update(@Param('id') id: string, @Body() body: { name?: string; image?: string }) {
return this.usersService.update(id, body);
}
@Delete(':id')
remove(@Param('id') id: string) {
return this.usersService.remove(id);
}
}
// File: apps\api\src\users\users.module.ts
import { Module } from "@nestjs/common";
import { UsersController } from "./users.controller";
import { UsersService } from "./users.service";
@Module({
controllers: [UsersController],
providers: [UsersService],
})
export class UsersModule {}
// File: apps\api\src\users\users.service.ts
import { Injectable } from "@nestjs/common";
import { PrismaService } from "../prisma/prisma.service";
import { CreateUserDto } from "./dto/create-user.dto";
@Injectable()
export class UsersService {
constructor(private readonly prisma: PrismaService) {}
async create(dto: CreateUserDto) {
return this.prisma.user.create({
data: {
email: dto.email,
name: dto.email.split("@")[0],
emailVerified: false,
},
});
}
async update(id: string, data: { name?: string; image?: string }) {
return this.prisma.user.update({
where: { id },
data,
});
}
async remove(id: string) {
return this.prisma.user.delete({
where: { id },
});
}
async findAll() {
const users = await this.prisma.user.findMany({
orderBy: { createdAt: "desc" },
include: {
accounts: {
select: {
providerId: true
}
}
}
});
if (users.length === 0) {
return [
{
id: "mock-1",
name: "Alice Admin",
email: "alice@example.com",
createdAt: new Date(),
emailVerified: true,
image: null,
accounts: [{ providerId: "credential" }]
},
{
id: "mock-2",
name: "Bob User",
email: "bob@example.com",
createdAt: new Date(Date.now() - 86400000),
emailVerified: true,
image: null,
accounts: [{ providerId: "github" }]
},
{
id: "mock-3",
name: "Charlie Dev",
email: "charlie@example.com",
createdAt: new Date(Date.now() - 172800000),
emailVerified: false,
image: null,
accounts: [{ providerId: "credential" }]
},
];
}
return users;
}
async getDashboardStats() {
const now = new Date();
const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
const [totalUsers, newUsersToday, activeSessions, recentUsers] = await Promise.all([
this.prisma.user.count(),
this.prisma.user.count({
where: {
createdAt: {
gte: startOfDay,
},
},
}),
this.prisma.session.count({
where: {
expiresAt: {
gt: now,
},
},
}),
this.prisma.user.findMany({
take: 5,
orderBy: {
createdAt: 'desc',
},
select: {
id: true,
name: true,
email: true,
createdAt: true,
image: true,
}
})
]);
if (totalUsers === 0) {
return {
totalUsers: 128,
newUsersToday: 12,
activeSessions: 45,
recentUsers: [
{ id: "mock-1", name: "Alice Admin", email: "alice@example.com", createdAt: new Date(), image: null },
{ id: "mock-2", name: "Bob User", email: "bob@example.com", createdAt: new Date(Date.now() - 86400000), image: null },
{ id: "mock-3", name: "Charlie Dev", email: "charlie@example.com", createdAt: new Date(Date.now() - 172800000), image: null },
{ id: "mock-4", name: "David Designer", email: "david@example.com", createdAt: new Date(Date.now() - 259200000), image: null },
{ id: "mock-5", name: "Eve Engineer", email: "eve@example.com", createdAt: new Date(Date.now() - 345600000), image: null },
]
};
}
return {
totalUsers,
newUsersToday,
activeSessions,
recentUsers,
};
}
}
